<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>íŒ€í”Œë ˆì´ ìœ í˜• ë°ì´í„° ìˆ˜ì§‘ê¸°</title>
  
  <!-- PWA ë©”íƒ€ íƒœê·¸ -->
  <meta name="theme-color" content="#6366f1">
  <meta name="description" content="íŒ€í”Œ ìœ í˜• í•™ìŠµ ë°ì´í„° ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ">
  <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIuybreaKtSDrjIDsi5zrs7Trk5wiLAogICJzaG9ydF9uYW1lIjogIuybreaKtSDrjIDsi5zrs7Trk5wiLAogICJzdGFydF91cmwiOiAiLyIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiI2ZmZmZmZiIsCiAgInRoZW1lX2NvbG9yIjogIiM2MzY2ZjEiLAogICJpY29ucyI6IFsKICAgIHsKICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lJSGRwWkhSb1BTSXhNakFpSUdobGFXZG9kRDBpTVRJd0lqNDhjbVZqZENCM2FXUjBhRDBpTVRJd0lpQm9aV2xuYUhROUlqRXlNQ0lnWm1sc2JEMGlJell6TmpabU1TSXZQand2YzNablBnPT0iLAogICAgICAic2l6ZXMiOiAiMTkyeDE5MiIsCiAgICAgICJ0eXBlIjogImltYWdlL3N2Zyt4bWwiCiAgICB9CiAgXQp9">
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    /* ë¡œê·¸ì¸ í™”ë©´ */
    .auth-container {
      max-width: 400px;
      margin: 100px auto;
      background: white;
      padding: 40px;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    
    .auth-container h1 {
      color: #6366f1;
      margin-bottom: 30px;
      text-align: center;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 8px;
      color: #374151;
      font-weight: 500;
    }
    
    .form-group input {
      width: 100%;
      padding: 12px;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      font-size: 14px;
      transition: border-color 0.3s;
    }
    
    .form-group input:focus {
      outline: none;
      border-color: #6366f1;
    }
    
    .btn {
      width: 100%;
      padding: 12px;
      background: #6366f1;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.3s;
    }
    
    .btn:hover {
      background: #4f46e5;
    }
    
    .auth-switch {
      text-align: center;
      margin-top: 20px;
      color: #6b7280;
    }
    
    .auth-switch a {
      color: #6366f1;
      text-decoration: none;
      font-weight: 600;
    }
    
    /* ëŒ€ì‹œë³´ë“œ */
    .dashboard {
      display: none;
    }
    
    .dashboard.active {
      display: block;
    }
    
    .header {
      background: white;
      padding: 20px 30px;
      border-radius: 15px;
      margin-bottom: 30px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .header h1 {
      color: #6366f1;
      font-size: 24px;
    }
    
    .header-info {
      display: flex;
      gap: 20px;
      align-items: center;
    }
    
    .user-email {
      color: #6b7280;
      font-size: 14px;
    }
    
    .btn-logout {
      padding: 8px 16px;
      background: #ef4444;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
    }
    
    .btn-logout:hover {
      background: #dc2626;
    }
    
    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .stat-card {
      background: white;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    
    .stat-label {
      color: #6b7280;
      font-size: 14px;
      margin-bottom: 8px;
    }
    
    .stat-value {
      font-size: 32px;
      font-weight: 700;
      color: #1f2937;
    }
    
    .stat-card.pending .stat-value {
      color: #f59e0b;
    }
    
    .stat-card.approved .stat-value {
      color: #10b981;
    }
    
    .stat-card.rejected .stat-value {
      color: #ef4444;
    }
    
    /* íƒ­ ë„¤ë¹„ê²Œì´ì…˜ */
    .tabs {
      background: white;
      border-radius: 15px;
      padding: 0;
      margin-bottom: 30px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      overflow: hidden;
    }
    
    .tab-nav {
      display: flex;
      border-bottom: 2px solid #e5e7eb;
    }
    
    .tab-btn {
      flex: 1;
      padding: 20px;
      background: none;
      border: none;
      font-size: 16px;
      font-weight: 600;
      color: #6b7280;
      cursor: pointer;
      transition: all 0.3s;
      position: relative;
    }
    
    .tab-btn:hover {
      background: #f9fafb;
    }
    
    .tab-btn.active {
      color: #6366f1;
    }
    
    .tab-btn.active::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      right: 0;
      height: 3px;
      background: #6366f1;
    }
    
    .tab-badge {
      background: #e5e7eb;
      color: #6b7280;
      padding: 2px 8px;
      border-radius: 10px;
      font-size: 12px;
      margin-left: 6px;
    }
    
    .tab-btn.active .tab-badge {
      background: #6366f1;
      color: white;
    }
    
    .tab-content {
      padding: 30px;
    }
    
    .tab-pane {
      display: none;
    }
    
    .tab-pane.active {
      display: block;
    }
    
    /* ë„êµ¬ ëª¨ìŒ */
    .toolbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding: 15px;
      background: #f9fafb;
      border-radius: 10px;
    }
    
    .checkbox-all {
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
    }
    
    .checkbox-all input {
      width: 18px;
      height: 18px;
      cursor: pointer;
    }
    
    .checkbox-all label {
      font-weight: 600;
      color: #374151;
      cursor: pointer;
    }
    
    .toolbar-actions {
      display: flex;
      gap: 10px;
    }
    
    .btn-delete-selected {
      padding: 8px 16px;
      background: #ef4444;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      display: none;
    }
    
    .btn-delete-selected.visible {
      display: block;
    }
    
    .btn-delete-selected:hover {
      background: #dc2626;
    }
    
    /* ë‚ ì§œ ê·¸ë£¹ */
    .date-group {
      margin-bottom: 25px;
    }
    
    .date-header {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px;
      background: #f3f4f6;
      border-radius: 8px;
      margin-bottom: 12px;
    }
    
    .date-header input {
      width: 18px;
      height: 18px;
      cursor: pointer;
    }
    
    .date-title {
      font-weight: 600;
      color: #374151;
      flex: 1;
    }
    
    .date-count {
      color: #6b7280;
      font-size: 14px;
    }
    
    /* í•­ëª© */
    .item {
      background: #f9fafb;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 12px;
      border-left: 4px solid #6366f1;
      display: flex;
      gap: 12px;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .item:hover {
      background: #f3f4f6;
      transform: translateX(4px);
    }
    
    .item.approved {
      border-left-color: #10b981;
    }
    
    .item.rejected {
      border-left-color: #ef4444;
    }
    
    .item.keyword-item {
      border-left-color: #8b5cf6;
      background: #faf5ff;
    }
    
    .item-checkbox {
      display: flex;
      align-items: start;
      padding-top: 4px;
    }
    
    .item-checkbox input {
      width: 18px;
      height: 18px;
      cursor: pointer;
    }
    
    .item-content-wrapper {
      flex: 1;
    }
    
    .item-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
    }
    
    .item-title {
      font-size: 15px;
      font-weight: 600;
      color: #1f2937;
      line-height: 1.4;
    }
    
    .item-meta {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      margin-top: 6px;
    }
    
    .meta-tag {
      background: white;
      color: #6b7280;
      padding: 3px 8px;
      border-radius: 4px;
      font-size: 11px;
    }
    
    .item-preview {
      color: #6b7280;
      font-size: 13px;
      margin-top: 8px;
      line-height: 1.5;
      overflow: hidden;
      text-overflow: ellipsis;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
    }
    
    /* ì˜µì…˜ ë²„íŠ¼ë“¤ (ê²°ì • í•„ìš” íƒ­ìš©) */
    .item-options {
      display: flex;
      gap: 8px;
      margin-top: 12px;
      flex-wrap: wrap;
    }
    
    .option-btn {
      padding: 6px 12px;
      border: 2px solid #e5e7eb;
      background: white;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
      transition: all 0.3s;
    }
    
    .option-btn:hover {
      border-color: #6366f1;
      background: #f0f0ff;
    }
    
    .option-btn.approve {
      border-color: #10b981;
      color: #10b981;
    }
    
    .option-btn.approve:hover {
      background: #d1fae5;
    }
    
    .option-btn.reject {
      border-color: #ef4444;
      color: #ef4444;
    }
    
    .option-btn.reject:hover {
      background: #fee2e2;
    }
    
    .percentage-badge {
      background: #6366f1;
      color: white;
      padding: 2px 5px;
      border-radius: 3px;
      font-size: 10px;
      font-weight: 600;
      margin-left: 4px;
    }
    
    /* ìƒì„¸ë³´ê¸° ëª¨ë‹¬ */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      padding: 20px;
      overflow-y: auto;
    }
    
    .modal.active {
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .modal-content {
      background: white;
      border-radius: 15px;
      max-width: 600px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    
    .modal-header {
      padding: 25px;
      border-bottom: 2px solid #e5e7eb;
      display: flex;
      justify-content: space-between;
      align-items: start;
    }
    
    .modal-title {
      font-size: 20px;
      font-weight: 700;
      color: #1f2937;
      line-height: 1.4;
      flex: 1;
      padding-right: 20px;
    }
    
    .modal-close {
      background: #f3f4f6;
      border: none;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 18px;
      color: #6b7280;
    }
    
    .modal-close:hover {
      background: #e5e7eb;
    }
    
    .modal-body {
      padding: 25px;
    }
    
    .modal-section {
      margin-bottom: 20px;
    }
    
    .modal-label {
      font-size: 12px;
      font-weight: 600;
      color: #6b7280;
      text-transform: uppercase;
      margin-bottom: 8px;
    }
    
    .modal-text {
      color: #374151;
      font-size: 14px;
      line-height: 1.6;
    }
    
    .modal-link {
      color: #6366f1;
      text-decoration: none;
      word-break: break-all;
    }
    
    .modal-link:hover {
      text-decoration: underline;
    }
    
    .modal-status {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      border-radius: 6px;
      font-weight: 600;
      font-size: 14px;
    }
    
    .modal-status.approved {
      background: #d1fae5;
      color: #10b981;
    }
    
    .modal-status.rejected {
      background: #fee2e2;
      color: #ef4444;
    }
    
    .modal-footer {
      padding: 20px 25px;
      border-top: 2px solid #e5e7eb;
      display: flex;
      gap: 10px;
    }
    
    .modal-btn {
      flex: 1;
      padding: 12px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .modal-btn-primary {
      background: #6366f1;
      color: white;
    }
    
    .modal-btn-primary:hover {
      background: #4f46e5;
    }
    
    .modal-btn-danger {
      background: #ef4444;
      color: white;
    }
    
    .modal-btn-danger:hover {
      background: #dc2626;
    }
    
    .modal-btn-secondary {
      background: #f3f4f6;
      color: #374151;
    }
    
    .modal-btn-secondary:hover {
      background: #e5e7eb;
    }
    
    /* ë¹ˆ ìƒíƒœ */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #6b7280;
    }
    
    .empty-state-icon {
      font-size: 64px;
      margin-bottom: 16px;
      opacity: 0.5;
    }
    
    .empty-state-text {
      font-size: 16px;
    }
    
    /* ì•Œë¦¼ ê¶Œí•œ ë°°ë„ˆ */
    .notification-banner {
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
      color: white;
      padding: 15px 25px;
      border-radius: 12px;
      margin-bottom: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    
    .notification-banner.hidden {
      display: none;
    }
    
    .notification-text {
      font-size: 14px;
      font-weight: 500;
    }
    
    .btn-enable-notifications {
      padding: 8px 16px;
      background: white;
      color: #f59e0b;
      border: none;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
    }
    
    .btn-enable-notifications:hover {
      background: #fef3c7;
    }
    
    /* ë°˜ì‘í˜• */
    @media (max-width: 768px) {
      body {
        padding: 10px;
      }
      
      .header {
        flex-direction: column;
        gap: 15px;
      }
      
      .header-info {
        flex-direction: column;
        width: 100%;
      }
      
      .stats {
        grid-template-columns: 1fr;
      }
      
      .tab-nav {
        flex-direction: column;
      }
      
      .tab-btn {
        border-bottom: 1px solid #e5e7eb;
      }
      
      .tab-btn.active::after {
        left: 0;
        right: auto;
        width: 4px;
        height: 100%;
        bottom: 0;
      }
      
      .toolbar {
        flex-direction: column;
        gap: 12px;
      }
      
      .toolbar-actions {
        width: 100%;
      }
      
      .btn-delete-selected {
        width: 100%;
      }
      
      .modal-footer {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <!-- ë¡œê·¸ì¸/íšŒì›ê°€ì… -->
  <div id="authContainer" class="auth-container">
    <h1>íŒ€í”Œë ˆì´ ìœ í˜• ë°ì´í„° ìˆ˜ì§‘ê¸°</h1>
    <div id="loginForm">
      <div class="form-group">
        <label>ì´ë©”ì¼</label>
        <input type="email" id="loginEmail" placeholder="your@email.com">
      </div>
      <div class="form-group">
        <label>ë¹„ë°€ë²ˆí˜¸</label>
        <input type="password" id="loginPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
      </div>
      <button class="btn" onclick="login()">ë¡œê·¸ì¸</button>
      <div class="auth-switch">
        ê³„ì •ì´ ì—†ìœ¼ì‹ ê°€ìš”? <a href="#" onclick="toggleAuth(); return false;">íšŒì›ê°€ì…</a>
      </div>
    </div>
    
    <div id="signupForm" style="display: none;">
      <div class="form-group">
        <label>ì´ë©”ì¼</label>
        <input type="email" id="signupEmail" placeholder="your@email.com">
      </div>
      <div class="form-group">
        <label>ë¹„ë°€ë²ˆí˜¸</label>
        <input type="password" id="signupPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
      </div>
      <button class="btn" onclick="signup()">íšŒì›ê°€ì…</button>
      <div class="auth-switch">
        ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”? <a href="#" onclick="toggleAuth(); return false;">ë¡œê·¸ì¸</a>
      </div>
    </div>
  </div>

  <!-- ëŒ€ì‹œë³´ë“œ -->
  <div id="dashboard" class="dashboard">
    <div class="container">
      <!-- í—¤ë” -->
      <div class="header">
        <h1>íŒ€í”Œë ˆì´ ìœ í˜• ë°ì´í„° ìˆ˜ì§‘ê¸°</h1>
        <div class="header-info">
          <span class="user-email" id="userEmail"></span>
          <button class="btn-logout" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
      </div>

      <!-- ì•Œë¦¼ ê¶Œí•œ ë°°ë„ˆ -->
      <div id="notificationBanner" class="notification-banner hidden">
        <div class="notification-text">
          ğŸ”” ìƒˆë¡œìš´ ê²°ì • í•­ëª©ì´ ìƒê¸°ë©´ ì•Œë¦¼ì„ ë°›ìœ¼ì‹œê² ìŠµë‹ˆê¹Œ?
        </div>
        <button class="btn-enable-notifications" onclick="requestNotificationPermission()">
          ì•Œë¦¼ í—ˆìš©
        </button>
      </div>

      <!-- í†µê³„ -->
      <div class="stats">
        <div class="stat-card">
          <div class="stat-label">ì´ ìˆ˜ì§‘</div>
          <div class="stat-value" id="statTotal">0</div>
        </div>
        <div class="stat-card pending">
          <div class="stat-label">ê²°ì • ëŒ€ê¸°</div>
          <div class="stat-value" id="statPending">0</div>
        </div>
        <div class="stat-card approved">
          <div class="stat-label">ìŠ¹ì¸í•¨</div>
          <div class="stat-value" id="statApproved">0</div>
        </div>
        <div class="stat-card rejected">
          <div class="stat-label">ê±°ì ˆí•¨</div>
          <div class="stat-value" id="statRejected">0</div>
        </div>
      </div>

      <!-- íƒ­ -->
      <div class="tabs">
        <div class="tab-nav">
          <button class="tab-btn active" data-tab="pending">
            ê²°ì • í•„ìš”
            <span class="tab-badge" id="pendingCount">0</span>
          </button>
          <button class="tab-btn" data-tab="approved">
            ìŠ¹ì¸í•¨
            <span class="tab-badge" id="approvedCount">0</span>
          </button>
          <button class="tab-btn" data-tab="rejected">
            ê±°ì ˆí•¨
            <span class="tab-badge" id="rejectedCount">0</span>
          </button>
        </div>
        
        <div class="tab-content">
          <!-- ê²°ì • í•„ìš” -->
          <div class="tab-pane active" id="pendingPane">
            <div id="pendingItems"></div>
          </div>
          
          <!-- ìŠ¹ì¸í•¨ -->
          <div class="tab-pane" id="approvedPane">
            <div class="toolbar">
              <div class="checkbox-all">
                <input type="checkbox" id="approvedCheckAll" onchange="toggleCheckAll('approved')">
                <label for="approvedCheckAll">ì „ì²´ ì„ íƒ</label>
              </div>
              <div class="toolbar-actions">
                <button class="btn-delete-selected" id="approvedDeleteBtn" onclick="deleteSelected('approved')">
                  ğŸ—‘ï¸ ì„ íƒ ì‚­ì œ
                </button>
              </div>
            </div>
            <div id="approvedItems"></div>
          </div>
          
          <!-- ê±°ì ˆí•¨ -->
          <div class="tab-pane" id="rejectedPane">
            <div class="toolbar">
              <div class="checkbox-all">
                <input type="checkbox" id="rejectedCheckAll" onchange="toggleCheckAll('rejected')">
                <label for="rejectedCheckAll">ì „ì²´ ì„ íƒ</label>
              </div>
              <div class="toolbar-actions">
                <button class="btn-delete-selected" id="rejectedDeleteBtn" onclick="deleteSelected('rejected')">
                  ğŸ—‘ï¸ ì„ íƒ ì‚­ì œ
                </button>
              </div>
            </div>
            <div id="rejectedItems"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ìƒì„¸ë³´ê¸° ëª¨ë‹¬ -->
  <div id="detailModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title" id="modalTitle"></h2>
        <button class="modal-close" onclick="closeModal()">âœ•</button>
      </div>
      <div class="modal-body">
        <div class="modal-section">
          <div class="modal-label">ìƒíƒœ</div>
          <div id="modalStatus"></div>
        </div>
        <div class="modal-section">
          <div class="modal-label">ë©”íƒ€ ì •ë³´</div>
          <div id="modalMeta"></div>
        </div>
        <div class="modal-section" id="modalDescSection" style="display: none;">
          <div class="modal-label">ë‚´ìš©</div>
          <div class="modal-text" id="modalDescription"></div>
        </div>
        <div class="modal-section" id="modalLinkSection" style="display: none;">
          <div class="modal-label">ë§í¬</div>
          <a class="modal-link" id="modalLink" target="_blank"></a>
        </div>
      </div>
      <div class="modal-footer" id="modalFooter"></div>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

  <script>
    // Firebase ì„¤ì •
    const firebaseConfig = {
      apiKey: "AIzaSyAmv5MlHGbzrZBw8lsMxt4vXYTwcetRcxI",
      authDomain: "tpt-learning-49601.firebaseapp.com",
      projectId: "tpt-learning-49601",
      storageBucket: "tpt-learning-49601.firebasestorage.app",
      messagingSenderId: "602423446232",
      appId: "1:602423446232:web:48ebe5af774affda7225ad"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    let currentUser = null;
    let unsubscribe = null;
    let currentData = null;
    let selectedItems = { approved: new Set(), rejected: new Set() };
    let currentModalItem = null;
    let currentModalType = null;
    let lastPendingCount = 0;

    // ì¸ì¦ ìƒíƒœ ê°ì§€
    auth.onAuthStateChanged(user => {
      if (user) {
        currentUser = user;
        document.getElementById('authContainer').style.display = 'none';
        document.getElementById('dashboard').classList.add('active');
        document.getElementById('userEmail').textContent = user.email;
        loadDashboard();
        checkNotificationPermission();
      } else {
        currentUser = null;
        document.getElementById('authContainer').style.display = 'block';
        document.getElementById('dashboard').classList.remove('active');
        if (unsubscribe) unsubscribe();
      }
    });

    // íƒ­ ì „í™˜
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const tab = btn.dataset.tab;
        
        // ë²„íŠ¼ í™œì„±í™”
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        
        // íŒ¨ë„ í‘œì‹œ
        document.querySelectorAll('.tab-pane').forEach(p => p.classList.remove('active'));
        document.getElementById(tab + 'Pane').classList.add('active');
      });
    });

    // ë¡œê·¸ì¸/íšŒì›ê°€ì… í† ê¸€
    function toggleAuth() {
      const login = document.getElementById('loginForm');
      const signup = document.getElementById('signupForm');
      if (login.style.display === 'none') {
        login.style.display = 'block';
        signup.style.display = 'none';
      } else {
        login.style.display = 'none';
        signup.style.display = 'block';
      }
    }

    // ë¡œê·¸ì¸
    async function login() {
      const email = document.getElementById('loginEmail').value;
      const password = document.getElementById('loginPassword').value;
      
      try {
        await auth.signInWithEmailAndPassword(email, password);
      } catch (error) {
        alert('ë¡œê·¸ì¸ ì‹¤íŒ¨: ' + error.message);
      }
    }

    // íšŒì›ê°€ì…
    async function signup() {
      const email = document.getElementById('signupEmail').value;
      const password = document.getElementById('signupPassword').value;
      
      try {
        const userCredential = await auth.createUserWithEmailAndPassword(email, password);
        await db.collection('users').doc(userCredential.user.uid).set({
          email: email,
          createdAt: firebase.firestore.FieldValue.serverTimestamp(),
          stats: { total: 0, pending: 0, approved: 0, rejected: 0 },
          approvalQueue: [],
          approvedItems: [],
          rejectedItems: [],
          activities: []
        });
      } catch (error) {
        alert('íšŒì›ê°€ì… ì‹¤íŒ¨: ' + error.message);
      }
    }

    // ë¡œê·¸ì•„ì›ƒ
    function logout() {
      auth.signOut();
    }

    // ëŒ€ì‹œë³´ë“œ ë¡œë“œ
    function loadDashboard() {
      const userDocRef = db.collection('users').doc(currentUser.uid);
      
      unsubscribe = userDocRef.onSnapshot(doc => {
        if (!doc.exists) {
          userDocRef.set({
            email: currentUser.email,
            stats: { total: 0, pending: 0, approved: 0, rejected: 0 },
            approvalQueue: [],
            approvedItems: [],
            rejectedItems: [],
            activities: []
          });
          return;
        }
        
        const data = doc.data();
        currentData = data;
        
        // í†µê³„ ì—…ë°ì´íŠ¸
        document.getElementById('statTotal').textContent = data.stats?.total || 0;
        document.getElementById('statPending').textContent = data.stats?.pending || 0;
        document.getElementById('statApproved').textContent = data.stats?.approved || 0;
        document.getElementById('statRejected').textContent = data.stats?.rejected || 0;
        
        // íƒ­ ì¹´ìš´íŠ¸
        document.getElementById('pendingCount').textContent = (data.approvalQueue || []).length;
        document.getElementById('approvedCount').textContent = (data.approvedItems || []).length;
        document.getElementById('rejectedCount').textContent = (data.rejectedItems || []).length;
        
        // ë Œë”ë§
        renderPendingItems(data.approvalQueue || []);
        renderApprovedItems(data.approvedItems || []);
        renderRejectedItems(data.rejectedItems || []);
        
        // ì•Œë¦¼ ì²´í¬
        checkForNewPending(data.approvalQueue || []);
      });
    }

    // ê²°ì • í•„ìš” ë Œë”ë§
    function renderPendingItems(items) {
      const container = document.getElementById('pendingItems');
      
      if (items.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">âœ…</div>
            <div class="empty-state-text">ëª¨ë“  í•­ëª©ì„ ì²˜ë¦¬í–ˆìŠµë‹ˆë‹¤!</div>
          </div>
        `;
        return;
      }
      
      container.innerHTML = items.map((item, index) => {
        const isKeyword = item.type === 'keyword';
        
        return `
          <div class="item ${isKeyword ? 'keyword-item' : ''}" onclick="event.stopPropagation()">
            <div class="item-content-wrapper">
              <div class="item-header">
                <div class="item-title">${isKeyword ? 'ğŸ”‘ ' : ''}${item.title || item.content}</div>
              </div>
              <div class="item-meta">
                ${item.source ? `<span class="meta-tag">${item.source === 'blog' ? 'ğŸ“ ë¸”ë¡œê·¸' : 'ğŸ“° ë‰´ìŠ¤'}</span>` : ''}
                ${item.keyword ? `<span class="meta-tag">${item.keyword}</span>` : ''}
                ${item.priority === 'primary' ? '<span class="meta-tag">1ì°¨</span>' : item.priority === 'secondary' ? '<span class="meta-tag">2ì°¨</span>' : ''}
                ${item.frequency ? `<span class="meta-tag">ë¹ˆë„: ${item.frequency}íšŒ</span>` : ''}
              </div>
              ${item.description ? `<div class="item-preview">${item.description}</div>` : ''}
              ${item.link ? `<a href="${item.link}" target="_blank" class="item-link" onclick="event.stopPropagation()">ğŸ”— ì›ë¬¸ ë³´ê¸°</a>` : ''}
              <div class="item-options">
                ${item.options ? item.options.map(opt => `
                  <button class="option-btn ${isKeyword ? '' : 'approve'}" onclick="event.stopPropagation(); ${isKeyword ? `handleKeywordDecision(${index}, '${opt.value || opt.label}')` : `handleClassification(${index}, '${opt.label}')`}">
                    ${opt.label}
                    ${opt.percentage ? `<span class="percentage-badge">${opt.percentage}%</span>` : ''}
                  </button>
                `).join('') : ''}
                ${!isKeyword ? `<button class="option-btn reject" onclick="event.stopPropagation(); handleReject(${index})">âŒ ê±°ì ˆ</button>` : ''}
              </div>
            </div>
          </div>
        `;
      }).join('');
    }

    // ìŠ¹ì¸í•¨ ë Œë”ë§
    function renderApprovedItems(items) {
      const container = document.getElementById('approvedItems');
      
      if (items.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">ğŸ“‹</div>
            <div class="empty-state-text">ìŠ¹ì¸í•œ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤</div>
          </div>
        `;
        return;
      }
      
      // ë‚ ì§œë³„ ê·¸ë£¹í•‘
      const grouped = groupByDate(items);
      
      container.innerHTML = Object.keys(grouped).sort((a, b) => new Date(b) - new Date(a)).map(date => {
        const dateItems = grouped[date];
        return `
          <div class="date-group">
            <div class="date-header">
              <input type="checkbox" onchange="toggleDateGroup('approved', '${date}', this.checked)">
              <span class="date-title">${formatDate(date)}</span>
              <span class="date-count">${dateItems.length}ê°œ</span>
            </div>
            ${dateItems.map((item, index) => renderItem(item, 'approved', item.originalIndex)).join('')}
          </div>
        `;
      }).join('');
      
      updateDeleteButton('approved');
    }

    // ê±°ì ˆí•¨ ë Œë”ë§
    function renderRejectedItems(items) {
      const container = document.getElementById('rejectedItems');
      
      if (items.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">ğŸ“‹</div>
            <div class="empty-state-text">ê±°ì ˆí•œ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤</div>
          </div>
        `;
        return;
      }
      
      // ë‚ ì§œë³„ ê·¸ë£¹í•‘
      const grouped = groupByDate(items);
      
      container.innerHTML = Object.keys(grouped).sort((a, b) => new Date(b) - new Date(a)).map(date => {
        const dateItems = grouped[date];
        return `
          <div class="date-group">
            <div class="date-header">
              <input type="checkbox" onchange="toggleDateGroup('rejected', '${date}', this.checked)">
              <span class="date-title">${formatDate(date)}</span>
              <span class="date-count">${dateItems.length}ê°œ</span>
            </div>
            ${dateItems.map((item, index) => renderItem(item, 'rejected', item.originalIndex)).join('')}
          </div>
        `;
      }).join('');
      
      updateDeleteButton('rejected');
    }

    // ê°œë³„ í•­ëª© ë Œë”ë§
    function renderItem(item, type, index) {
      const id = `${type}-${index}`;
      const isChecked = selectedItems[type].has(index);
      
      return `
        <div class="item ${type}" onclick="showDetail('${type}', ${index})">
          <div class="item-checkbox">
            <input type="checkbox" ${isChecked ? 'checked' : ''} 
                   onchange="event.stopPropagation(); toggleItem('${type}', ${index}, this.checked)"
                   onclick="event.stopPropagation()">
          </div>
          <div class="item-content-wrapper">
            <div class="item-title">${item.title || item.content}</div>
            <div class="item-meta">
              ${item.source ? `<span class="meta-tag">${item.source === 'blog' ? 'ğŸ“ ë¸”ë¡œê·¸' : 'ğŸ“° ë‰´ìŠ¤'}</span>` : ''}
              ${item.keyword ? `<span class="meta-tag">${item.keyword}</span>` : ''}
              ${item.selectedType ? `<span class="meta-tag">ìœ í˜•: ${item.selectedType}</span>` : ''}
              ${item.selectedOption ? `<span class="meta-tag">${item.selectedOption === 'primary' ? '1ì°¨' : item.selectedOption === 'secondary' ? '2ì°¨' : 'ì œì™¸'}</span>` : ''}
            </div>
            ${item.description ? `<div class="item-preview">${item.description}</div>` : ''}
          </div>
        </div>
      `;
    }

    // ë‚ ì§œë³„ ê·¸ë£¹í•‘
    function groupByDate(items) {
      const grouped = {};
      items.forEach((item, index) => {
        item.originalIndex = index;
        const timestamp = item.decidedAt?.toMillis ? item.decidedAt.toMillis() : new Date(item.decidedAt || Date.now()).getTime();
        const date = new Date(timestamp).toISOString().split('T')[0];
        if (!grouped[date]) grouped[date] = [];
        grouped[date].push(item);
      });
      return grouped;
    }

    // ë‚ ì§œ í¬ë§·
    function formatDate(dateStr) {
      const date = new Date(dateStr);
      const today = new Date();
      const yesterday = new Date(today);
      yesterday.setDate(yesterday.getDate() - 1);
      
      if (dateStr === today.toISOString().split('T')[0]) return 'ì˜¤ëŠ˜';
      if (dateStr === yesterday.toISOString().split('T')[0]) return 'ì–´ì œ';
      
      return `${date.getMonth() + 1}ì›” ${date.getDate()}ì¼`;
    }

    // ì²´í¬ë°•ìŠ¤ í† ê¸€
    function toggleItem(type, index, checked) {
      if (checked) {
        selectedItems[type].add(index);
      } else {
        selectedItems[type].delete(index);
      }
      updateDeleteButton(type);
    }

    // ì „ì²´ ì„ íƒ
    function toggleCheckAll(type) {
      const checked = document.getElementById(type + 'CheckAll').checked;
      selectedItems[type].clear();
      
      if (checked) {
        const items = type === 'approved' ? currentData.approvedItems : currentData.rejectedItems;
        items.forEach((_, index) => selectedItems[type].add(index));
      }
      
      if (type === 'approved') {
        renderApprovedItems(currentData.approvedItems || []);
      } else {
        renderRejectedItems(currentData.rejectedItems || []);
      }
    }

    // ë‚ ì§œ ê·¸ë£¹ ì„ íƒ
    function toggleDateGroup(type, date, checked) {
      const items = type === 'approved' ? currentData.approvedItems : currentData.rejectedItems;
      items.forEach((item, index) => {
        const timestamp = item.decidedAt?.toMillis ? item.decidedAt.toMillis() : new Date(item.decidedAt || Date.now()).getTime();
        const itemDate = new Date(timestamp).toISOString().split('T')[0];
        if (itemDate === date) {
          if (checked) {
            selectedItems[type].add(index);
          } else {
            selectedItems[type].delete(index);
          }
        }
      });
      
      if (type === 'approved') {
        renderApprovedItems(currentData.approvedItems || []);
      } else {
        renderRejectedItems(currentData.rejectedItems || []);
      }
    }

    // ì‚­ì œ ë²„íŠ¼ ì—…ë°ì´íŠ¸
    function updateDeleteButton(type) {
      const btn = document.getElementById(type + 'DeleteBtn');
      if (selectedItems[type].size > 0) {
        btn.classList.add('visible');
        btn.textContent = `ğŸ—‘ï¸ ${selectedItems[type].size}ê°œ ì‚­ì œ`;
      } else {
        btn.classList.remove('visible');
      }
    }

    // ì„ íƒ ì‚­ì œ
    async function deleteSelected(type) {
      if (selectedItems[type].size === 0) return;
      
      if (!confirm(`${selectedItems[type].size}ê°œ í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
      
      const userDocRef = db.collection('users').doc(currentUser.uid);
      const items = type === 'approved' ? currentData.approvedItems : currentData.rejectedItems;
      
      // ì„ íƒë˜ì§€ ì•Šì€ í•­ëª©ë§Œ ìœ ì§€
      const newItems = items.filter((_, index) => !selectedItems[type].has(index));
      
      const field = type === 'approved' ? 'approvedItems' : 'rejectedItems';
      await userDocRef.update({
        [field]: newItems,
        [`stats.${type}`]: newItems.length
      });
      
      selectedItems[type].clear();
      document.getElementById(type + 'CheckAll').checked = false;
    }

    // ìƒì„¸ë³´ê¸° ëª¨ë‹¬
    function showDetail(type, index) {
      const items = type === 'approved' ? currentData.approvedItems : 
                    type === 'rejected' ? currentData.rejectedItems :
                    currentData.approvalQueue;
      const item = items[index];
      
      currentModalItem = item;
      currentModalType = type;
      
      document.getElementById('modalTitle').textContent = item.title || item.content;
      
      // ìƒíƒœ
      if (type === 'approved') {
        document.getElementById('modalStatus').innerHTML = `
          <span class="modal-status approved">âœ… ìŠ¹ì¸í•¨</span>
        `;
      } else if (type === 'rejected') {
        document.getElementById('modalStatus').innerHTML = `
          <span class="modal-status rejected">âŒ ê±°ì ˆí•¨</span>
        `;
      } else {
        document.getElementById('modalStatus').innerHTML = `
          <span class="modal-status" style="background: #fef3c7; color: #f59e0b;">â³ ê²°ì • ëŒ€ê¸°</span>
        `;
      }
      
      // ë©”íƒ€
      let metaHtml = '<div class="item-meta">';
      if (item.source) metaHtml += `<span class="meta-tag">${item.source === 'blog' ? 'ğŸ“ ë¸”ë¡œê·¸' : 'ğŸ“° ë‰´ìŠ¤'}</span>`;
      if (item.keyword) metaHtml += `<span class="meta-tag">í‚¤ì›Œë“œ: ${item.keyword}</span>`;
      if (item.priority) metaHtml += `<span class="meta-tag">${item.priority === 'primary' ? '1ì°¨ í‚¤ì›Œë“œ' : '2ì°¨ í‚¤ì›Œë“œ'}</span>`;
      if (item.selectedType) metaHtml += `<span class="meta-tag">ìœ í˜•: ${item.selectedType}</span>`;
      if (item.frequency) metaHtml += `<span class="meta-tag">ë¹ˆë„: ${item.frequency}íšŒ</span>`;
      metaHtml += '</div>';
      document.getElementById('modalMeta').innerHTML = metaHtml;
      
      // ì„¤ëª…
      if (item.description) {
        document.getElementById('modalDescSection').style.display = 'block';
        document.getElementById('modalDescription').textContent = item.description;
      } else {
        document.getElementById('modalDescSection').style.display = 'none';
      }
      
      // ë§í¬
      if (item.link) {
        document.getElementById('modalLinkSection').style.display = 'block';
        const linkEl = document.getElementById('modalLink');
        linkEl.href = item.link;
        linkEl.textContent = item.link;
      } else {
        document.getElementById('modalLinkSection').style.display = 'none';
      }
      
      // í‘¸í„° ë²„íŠ¼
      let footerHtml = '';
      if (type === 'approved') {
        footerHtml = `
          <button class="modal-btn modal-btn-primary" onclick="reconsiderItem('approved', ${index})">
            ğŸ”„ ë‹¤ì‹œ ê²€í† 
          </button>
          <button class="modal-btn modal-btn-secondary" onclick="changeDecision(${index}, 'rejected')">
            â†”ï¸ ê±°ì ˆë¡œ ë³€ê²½
          </button>
          <button class="modal-btn modal-btn-danger" onclick="deleteSingleItem('approved', ${index})">
            ğŸ—‘ï¸ ì‚­ì œ
          </button>
          <button class="modal-btn modal-btn-secondary" onclick="closeModal()">
            ë‹«ê¸°
          </button>
        `;
     } else if (type === 'rejected') {
        footerHtml = `
          <button class="modal-btn modal-btn-primary" onclick="reconsiderItem('rejected', ${index})">
            ğŸ”„ ë‹¤ì‹œ ê²€í† 
          </button>
          <button class="modal-btn modal-btn-secondary" onclick="changeDecision(${index}, 'approved')">
            â†”ï¸ ìŠ¹ì¸ìœ¼ë¡œ ë³€ê²½
          </button>
          <button class="modal-btn modal-btn-danger" onclick="deleteSingleItem('rejected', ${index})">
            ğŸ—‘ï¸ ì‚­ì œ
          </button>
          <button class="modal-btn modal-btn-secondary" onclick="closeModal()">
            ë‹«ê¸°
          </button>
        `;
      } else {
        footerHtml = `
          <button class="modal-btn modal-btn-secondary" onclick="closeModal()">
            ë‹«ê¸°
          </button>
        `;
      }
      
      document.getElementById('modalFooter').innerHTML = footerHtml;
      
      document.getElementById('detailModal').classList.add('active');
    }

    function closeModal() {
      document.getElementById('detailModal').classList.remove('active');
    }

    // ê²°ì • ë³€ê²½
    async function changeDecision(index, newType) {
      const oldType = currentModalType;
      const userDocRef = db.collection('users').doc(currentUser.uid);
      
      const oldItems = oldType === 'approved' ? currentData.approvedItems : currentData.rejectedItems;
      const newItems = newType === 'approved' ? currentData.approvedItems || [] : currentData.rejectedItems || [];
      
      const item = oldItems[index];
      
      // ê¸°ì¡´ ë°°ì—´ì—ì„œ ì œê±°
      const updatedOldItems = [...oldItems];
      updatedOldItems.splice(index, 1);
      
      // ìƒˆ ë°°ì—´ì— ì¶”ê°€
      const updatedNewItems = [{
        ...item,
        decision: newType,
        decidedAt: firebase.firestore.Timestamp.now()
      }, ...newItems];
      
      await userDocRef.update({
        [oldType === 'approved' ? 'approvedItems' : 'rejectedItems']: updatedOldItems,
        [newType === 'approved' ? 'approvedItems' : 'rejectedItems']: updatedNewItems,
        [`stats.${oldType}`]: updatedOldItems.length,
        [`stats.${newType}`]: updatedNewItems.length
      });
      
      closeModal();
    }

// ì¬ê²€í†  (approved/rejected â†’ approvalQueue)
    async function reconsiderItem(type, index) {
      const userDocRef = db.collection('users').doc(currentUser.uid);
      
      const items = type === 'approved' ? currentData.approvedItems : currentData.rejectedItems;
      const item = items[index];
      
      // decision, decidedAt, selectedType ì œê±°í•˜ê³  ì›ë˜ í˜•íƒœë¡œ
      const { decision, decidedAt, selectedType, selectedOption, ...originalItem } = item;
      
      // ì˜µì…˜ ì¬êµ¬ì„±
      if (!originalItem.options && originalItem.category) {
        // ê¸°ì¡´ì— ìŠ¹ì¸/ê±°ì ˆí–ˆë˜ í•­ëª©ì´ë©´ ê¸°ë³¸ ì˜µì…˜ ì¶”ê°€
        originalItem.options = [
          { label: 'ë¬´ì„ìŠ¹ì°¨í˜•', percentage: 85 },
          { label: 'í˜‘ë ¥í˜•', percentage: 70 }
        ];
        originalItem.type = 'classification';
        originalItem.title = 'ì¬ê²€í† : ìœ í˜• ê²°ì •';
      }
      
      // ê¸°ì¡´ ë°°ì—´ì—ì„œ ì œê±°
      const updatedItems = [...items];
      updatedItems.splice(index, 1);
      
      // approvalQueueì— ì¶”ê°€
      const newQueue = [originalItem, ...(currentData.approvalQueue || [])];
      
      await userDocRef.update({
        [type === 'approved' ? 'approvedItems' : 'rejectedItems']: updatedItems,
        approvalQueue: newQueue,
        [`stats.${type}`]: updatedItems.length,
        'stats.pending': newQueue.length
      });
      
      closeModal();
    }
    
    // ê°œë³„ ì‚­ì œ
    async function deleteSingleItem(type, index) {
      if (!confirm('ì´ í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
      
      const userDocRef = db.collection('users').doc(currentUser.uid);
      const items = type === 'approved' ? currentData.approvedItems : currentData.rejectedItems;
      
      const newItems = [...items];
      newItems.splice(index, 1);
      
      await userDocRef.update({
        [type === 'approved' ? 'approvedItems' : 'rejectedItems']: newItems,
        [`stats.${type}`]: newItems.length
      });
      
      closeModal();
    }

    // ë¶„ë¥˜ ìŠ¹ì¸
    async function handleClassification(index, selectedType) {
      const userDocRef = db.collection('users').doc(currentUser.uid);
      
      const item = currentData.approvalQueue[index];
      const newQueue = [...currentData.approvalQueue];
      newQueue.splice(index, 1);
      
      const approvedItems = [{
        ...item,
        decision: 'approved',
        selectedType,
        decidedAt: firebase.firestore.Timestamp.now()
      }, ...(currentData.approvedItems || [])];
      
      await userDocRef.update({
        approvalQueue: newQueue,
        approvedItems,
        'stats.pending': newQueue.length,
        'stats.approved': approvedItems.length
      });
    }

    // í‚¤ì›Œë“œ ìŠ¹ì¸
    async function handleKeywordDecision(index, selectedOption) {
      const userDocRef = db.collection('users').doc(currentUser.uid);
      
      const item = currentData.approvalQueue[index];
      const newQueue = [...currentData.approvalQueue];
      newQueue.splice(index, 1);
      
      const decision = selectedOption === 'exclude' ? 'rejected' : 'approved';
      
      if (decision === 'approved') {
        const approvedItems = [{
          ...item,
          decision,
          selectedOption,
          decidedAt: firebase.firestore.Timestamp.now()
        }, ...(currentData.approvedItems || [])];
        
        await userDocRef.update({
          approvalQueue: newQueue,
          approvedItems,
          'stats.pending': newQueue.length,
          'stats.approved': approvedItems.length
        });
      } else {
        const rejectedItems = [{
          ...item,
          decision,
          selectedOption,
          decidedAt: firebase.firestore.Timestamp.now()
        }, ...(currentData.rejectedItems || [])];
        
        await userDocRef.update({
          approvalQueue: newQueue,
          rejectedItems,
          'stats.pending': newQueue.length,
          'stats.rejected': rejectedItems.length
        });
      }
    }

    // ê±°ì ˆ
    async function handleReject(index) {
      const userDocRef = db.collection('users').doc(currentUser.uid);
      
      const item = currentData.approvalQueue[index];
      const newQueue = [...currentData.approvalQueue];
      newQueue.splice(index, 1);
      
      const rejectedItems = [{
        ...item,
        decision: 'rejected',
        decidedAt: firebase.firestore.Timestamp.now()
      }, ...(currentData.rejectedItems || [])];
      
      await userDocRef.update({
        approvalQueue: newQueue,
        rejectedItems,
        'stats.pending': newQueue.length,
        'stats.rejected': rejectedItems.length
      });
    }

    // ì•Œë¦¼ ê¶Œí•œ í™•ì¸
    function checkNotificationPermission() {
      if (!('Notification' in window)) return;
      
      if (Notification.permission === 'default') {
        document.getElementById('notificationBanner').classList.remove('hidden');
      } else if (Notification.permission === 'granted') {
        document.getElementById('notificationBanner').classList.add('hidden');
      }
    }

    // ì•Œë¦¼ ê¶Œí•œ ìš”ì²­
    async function requestNotificationPermission() {
      if (!('Notification' in window)) {
        alert('ì´ ë¸Œë¼ìš°ì €ëŠ” ì•Œë¦¼ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
        return;
      }
      
      const permission = await Notification.requestPermission();
      
      if (permission === 'granted') {
        document.getElementById('notificationBanner').classList.add('hidden');
        new Notification('ì•Œë¦¼ ì„¤ì • ì™„ë£Œ!', {
          body: 'ìƒˆë¡œìš´ ê²°ì • í•­ëª©ì´ ìƒê¸°ë©´ ì•Œë¦¼ì„ ë°›ìŠµë‹ˆë‹¤.',
          icon: 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAiIGhlaWdodD0iMTIwIj48cmVjdCB3aWR0aD0iMTIwIiBoZWlnaHQ9IjEyMCIgZmlsbD0iIzYzNjZmMSIvPjwvc3ZnPg=='
        });
      }
    }

    // ìƒˆ í•­ëª© ì•Œë¦¼
    function checkForNewPending(queue) {
      const currentCount = queue.length;
      
      if (lastPendingCount > 0 && currentCount > lastPendingCount && Notification.permission === 'granted') {
        const diff = currentCount - lastPendingCount;
        new Notification('ìƒˆë¡œìš´ ê²°ì •ì´ í•„ìš”í•©ë‹ˆë‹¤!', {
          body: `${diff}ê°œì˜ ìƒˆë¡œìš´ í•­ëª©ì´ ëŒ€ê¸°ì¤‘ì…ë‹ˆë‹¤.`,
          icon: 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAiIGhlaWdodD0iMTIwIj48cmVjdCB3aWR0aD0iMTIwIiBoZWlnaHQ9IjEyMCIgZmlsbD0iIzYzNjZmMSIvPjwvc3ZnPg==',
          tag: 'new-pending'
        });
      }
      
      lastPendingCount = currentCount;
    }

    // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
    document.getElementById('detailModal').addEventListener('click', (e) => {
      if (e.target.id === 'detailModal') {
        closeModal();
      }
    });

    // PWA ì„œë¹„ìŠ¤ ì›Œì»¤
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('data:text/javascript;base64,')
        .catch(err => console.log('SW registration failed'));
    }
  </script>
</body>
</html>
