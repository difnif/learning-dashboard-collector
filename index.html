<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#6366f1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Learning Dashboard">
    <title>Learning Dashboard</title>
    
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIkxlYXJuaW5nIERhc2hib2FyZCIsCiAgInNob3J0X25hbWUiOiAiTGVhcm5pbmciLAogICJzdGFydF91cmwiOiAiLiIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiI2ZmZmZmZiIsCiAgInRoZW1lX2NvbG9yIjogIiM2MzY2ZjEiLAogICJpY29ucyI6IFsKICAgIHsKICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lJSGRwWkhSb1BTSXhNakFpSUdobGFXZG9kRDBpTVRJd0lqNDhjbVZqZENCM2FXUjBhRDBpTVRJd0lpQm9aV2xuYUhROUlqRXlNQ0lnWm1sc2JEMGlJell6TmpabU1TSXZQanh3WVhSb0lHUTlJazB6TUNBMk1Fd3lNQ0F4TURCTU9UQWdOakJNTXpBZ05qQmFJaUJtYVd4c1BTSWpabVptSWk4K1BIUmxlSFFnZUQwaU5qQWlJSGs5SWpZd0lpQjBaWGgwTFdGdVkyaHZjajBpYldsa1pHeGxJaUJtYjI1MExYTnBlbVU5SWpJd0lpQm1hV3hzUFNJak5qTTJObVl4SWo0OFAzUmxlSFErUEM5MFpYaDBQand2YzNablBnPT0iLAogICAgICAic2l6ZXMiOiAiMTkyeDE5MiIsCiAgICAgICJ0eXBlIjogImltYWdlL3N2Zyt4bWwiCiAgICB9CiAgXQp9">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        /* ë¡œê·¸ì¸ í™”ë©´ */
        .auth-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .auth-box {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 400px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        .auth-title {
            font-size: 28px;
            color: #1f2937;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .auth-subtitle {
            color: #6b7280;
            font-size: 14px;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-group label {
            display: block;
            color: #374151;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .input-group input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 15px;
            transition: border 0.3s;
        }
        
        .input-group input:focus {
            outline: none;
            border-color: #6366f1;
        }
        
        .btn-auth {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .btn-auth:active {
            transform: scale(0.98);
        }
        
        .auth-switch {
            text-align: center;
            margin-top: 20px;
            color: #6b7280;
            font-size: 14px;
        }
        
        .auth-switch a {
            color: #6366f1;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
        }
        
        .error-message {
            background: #fee2e2;
            color: #991b1b;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
            display: none;
        }
        
        .error-message.show {
            display: block;
        }
        
        /* ëŒ€ì‹œë³´ë“œ */
        .dashboard {
            display: none;
            padding: 20px;
            padding-bottom: 80px;
        }
        
        .dashboard.show {
            display: block;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .header {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header-left h1 {
            font-size: 28px;
            color: #1f2937;
            margin-bottom: 5px;
        }
        
        .header-left .subtitle {
            color: #6b7280;
            font-size: 14px;
        }
        
        .header-right {
            text-align: right;
        }
        
        .user-email {
            color: #6b7280;
            font-size: 13px;
            margin-bottom: 8px;
        }
        
        .btn-logout {
            background: #fee2e2;
            color: #991b1b;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            text-align: center;
        }
        
        .stat-number {
            font-size: 32px;
            font-weight: bold;
            color: #6366f1;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 12px;
            color: #6b7280;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .section {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }
        
        .section-title {
            font-size: 20px;
            color: #1f2937;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .badge {
            background: #ef4444;
            color: white;
            font-size: 12px;
            padding: 4px 10px;
            border-radius: 12px;
            font-weight: bold;
        }
        
        .approval-item {
            background: #f9fafb;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid #6366f1;
        }
        
        .approval-item:last-child {
            margin-bottom: 0;
        }
        
        .approval-title {
            font-size: 16px;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 10px;
        }
        
        .approval-content {
            color: #6b7280;
            font-size: 14px;
            margin-bottom: 15px;
            line-height: 1.6;
        }
        
        .category-preview {
            background: #f3f4f6;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 13px;
            line-height: 1.8;
        }
        
        .approval-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
            min-width: 80px;
            position: relative;
        }
        
        .btn:active {
            transform: scale(0.95);
        }
        
        .btn-approve {
            background: #10b981;
            color: white;
        }
        
        .btn-reject {
            background: #ef4444;
            color: white;
        }
        
        .btn-alt {
            background: #f59e0b;
            color: white;
        }
        
        .btn-secondary {
            background: #e5e7eb;
            color: #1f2937;
        }
        
        .percentage {
            display: block;
            font-size: 11px;
            margin-top: 4px;
            opacity: 0.9;
            font-weight: 500;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #9ca3af;
        }
        
        .empty-state svg {
            width: 80px;
            height: 80px;
            margin-bottom: 20px;
            opacity: 0.3;
        }
        
        .toast {
            position: fixed;
            bottom: 90px;
            left: 50%;
            transform: translateX(-50%);
            background: #1f2937;
            color: white;
            padding: 15px 25px;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1000;
            max-width: 90%;
        }
        
        .toast.show {
            opacity: 1;
        }
        
        .bottom-nav {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            border-radius: 20px;
            padding: 15px 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            display: flex;
            gap: 30px;
            z-index: 100;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            color: #9ca3af;
            transition: color 0.3s;
            font-size: 12px;
        }
        
        .nav-item.active {
            color: #6366f1;
        }
        
        .nav-icon {
            font-size: 24px;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #6b7280;
        }
        
        @media (max-width: 600px) {
            .dashboard {
                padding: 15px;
                padding-bottom: 80px;
            }
            
            .header {
                padding: 20px;
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .header-right {
                text-align: center;
            }
            
            .stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .section {
                padding: 20px;
            }
            
            .approval-actions {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- ë¡œê·¸ì¸ í™”ë©´ -->
    <div id="authContainer" class="auth-container">
        <div class="auth-box">
            <div class="auth-title">ğŸ“ Learning Dashboard</div>
            <div class="auth-subtitle">ìë™ í•™ìŠµ ê´€ë¦¬ ì‹œìŠ¤í…œ</div>
            
            <div id="errorMessage" class="error-message"></div>
            
            <div id="loginForm">
                <div class="input-group">
                    <label>ì´ë©”ì¼</label>
                    <input type="email" id="loginEmail" placeholder="example@email.com">
                </div>
                <div class="input-group">
                    <label>ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" id="loginPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
                </div>
                <button class="btn-auth" onclick="login()">ë¡œê·¸ì¸</button>
                <div class="auth-switch">
                    ê³„ì •ì´ ì—†ìœ¼ì‹ ê°€ìš”? <a onclick="showSignup()">íšŒì›ê°€ì…</a>
                </div>
            </div>
            
            <div id="signupForm" style="display: none;">
                <div class="input-group">
                    <label>ì´ë©”ì¼</label>
                    <input type="email" id="signupEmail" placeholder="example@email.com">
                </div>
                <div class="input-group">
                    <label>ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" id="signupPassword" placeholder="ìµœì†Œ 6ì ì´ìƒ">
                </div>
                <div class="input-group">
                    <label>ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
                    <input type="password" id="signupPasswordConfirm" placeholder="ë¹„ë°€ë²ˆí˜¸ ì¬ì…ë ¥">
                </div>
                <button class="btn-auth" onclick="signup()">íšŒì›ê°€ì…</button>
                <div class="auth-switch">
                    ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”? <a onclick="showLogin()">ë¡œê·¸ì¸</a>
                </div>
            </div>
        </div>
    </div>

    <!-- ëŒ€ì‹œë³´ë“œ -->
    <div id="dashboard" class="dashboard">
        <div class="container">
            <!-- í—¤ë” -->
            <div class="header">
                <div class="header-left">
                    <h1>ğŸ“ Learning Dashboard</h1>
                    <p class="subtitle">ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: <span id="lastUpdate">ë°©ê¸ˆ ì „</span></p>
                </div>
                <div class="header-right">
                    <div class="user-email" id="userEmail"></div>
                    <button class="btn-logout" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
                </div>
            </div>
            
            <!-- í†µê³„ -->
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-number" id="statTotal">0</div>
                    <div class="stat-label">ì´ ìˆ˜ì§‘</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="statPending">0</div>
                    <div class="stat-label">ìŠ¹ì¸ ëŒ€ê¸°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="statApproved">0</div>
                    <div class="stat-label">ìŠ¹ì¸ë¨</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="statRejected">0</div>
                    <div class="stat-label">ê±°ì ˆë¨</div>
                </div>
            </div>
            
            <!-- ìŠ¹ì¸ í•„ìš” í•­ëª© -->
            <div class="section">
                <div class="section-title">
                    ğŸ”” ê²°ì • í•„ìš”
                    <span class="badge" id="pendingBadge">0</span>
                </div>
                <div id="approvalList">
                    <div class="loading">ë°ì´í„° ë¡œë”© ì¤‘...</div>
                </div>
            </div>
            
            <!-- ìµœê·¼ í™œë™ -->
            <div class="section">
                <div class="section-title">ğŸ“Š ìµœê·¼ í™œë™</div>
                <div id="recentActivity">
                    <div class="loading">ë°ì´í„° ë¡œë”© ì¤‘...</div>
                </div>
            </div>
        </div>
        
        <!-- í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
        <div class="bottom-nav">
            <div class="nav-item active" onclick="showTab('dashboard')">
                <div class="nav-icon">ğŸ“Š</div>
                <div>ëŒ€ì‹œë³´ë“œ</div>
            </div>
            <div class="nav-item" onclick="showTab('categories')">
                <div class="nav-icon">ğŸ“</div>
                <div>ì¹´í…Œê³ ë¦¬</div>
            </div>
            <div class="nav-item" onclick="showTab('settings')">
                <div class="nav-icon">âš™ï¸</div>
                <div>ì„¤ì •</div>
            </div>
        </div>
    </div>
    
    <!-- í† ìŠ¤íŠ¸ ì•Œë¦¼ -->
    <div id="toast" class="toast"></div>
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, collection, doc, setDoc, getDoc, getDocs, updateDoc, deleteDoc, onSnapshot, query, orderBy, limit } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyAmv5MlHGbzrZBw8lsMxt4vXYTwcetRcxI",
            authDomain: "tpt-learning-49601.firebaseapp.com",
            projectId: "tpt-learning-49601",
            storageBucket: "tpt-learning-49601.firebasestorage.app",
            messagingSenderId: "602423446232",
            appId: "1:602423446232:web:48ebe5af774affda7225ad"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        window.auth = auth;
        window.db = db;
        window.firebaseModules = { createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, collection, doc, setDoc, getDoc, getDocs, updateDoc, deleteDoc, onSnapshot, query, orderBy, limit };
        
        // ì¸ì¦ ìƒíƒœ ê°ì§€
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                document.getElementById('authContainer').style.display = 'none';
                document.getElementById('dashboard').classList.add('show');
                document.getElementById('userEmail').textContent = user.email;
                
                await initializeDashboard(user.uid);
            } else {
                document.getElementById('authContainer').style.display = 'flex';
                document.getElementById('dashboard').classList.remove('show');
            }
        });
        
        // ëŒ€ì‹œë³´ë“œ ì´ˆê¸°í™”
        async function initializeDashboard(userId) {
            const userDocRef = doc(db, 'users', userId);
            const userDoc = await getDoc(userDocRef);
            
            // ì‹ ê·œ ì‚¬ìš©ìë©´ ì´ˆê¸° ë°ì´í„° ìƒì„±
            if (!userDoc.exists()) {
                const initialData = {
                    stats: {
                        total: 47,
                        pending: 3,
                        approved: 38,
                        rejected: 6
                    },
                    approvalQueue: [
                        {
                            id: 1,
                            type: 'category',
                            title: 'ìƒˆ ì¹´í…Œê³ ë¦¬ ì œì•ˆ',
                            content: '"ì •ì¹˜ > êµ­ë¯¼ì˜í˜" í•˜ìœ„ ì¹´í…Œê³ ë¦¬ë¥¼ ì¶”ê°€í•˜ì‹œê² ìŠµë‹ˆê¹Œ?',
                            description: 'ìµœê·¼ ìˆ˜ì§‘ëœ ì‚¬ë¡€ ì¤‘ êµ­ë¯¼ì˜í˜ ê´€ë ¨ ë‚´ìš©ì´ 15ê°œ ì´ìƒ ì¶•ì ë˜ì—ˆìŠµë‹ˆë‹¤.',
                            preview: 'ì •ì¹˜/\n  â”œâ”€ ëŒ€í†µë ¹\n  â”œâ”€ êµ­íšŒ\n  â””â”€ êµ­ë¯¼ì˜í˜/ â† ì‹ ê·œ\n      â”œâ”€ ë‹¹ëŒ€í‘œ\n      â””â”€ ì •ì±…',
                            options: ['ìœ„ê¸°ëŒ€ì‘ í•˜ìœ„ë¡œ', 'ì •ì¹˜ í•˜ìœ„ë¡œ', 'ë°˜ë ¤']
                        },
                        {
                            id: 2,
                            type: 'classification',
                            title: 'ëª¨í˜¸í•œ ë¶„ë¥˜: ìœ í˜• ê²°ì •',
                            content: 'ì¼ë¡  ë¨¸ìŠ¤í¬ íŠ¸ìœ„í„° ì¸ìˆ˜ ì‚¬ë¡€',
                            description: 'ì´ì‚¬íšŒ ë°˜ëŒ€ ë¬´ì‹œ, 440ì–µ ë‹¬ëŸ¬ ì¦‰ì‹œ ê²°ì •, ì§ì› 50% í•´ê³ ',
                            options: [
                                { label: 'ë…ë‹¨í˜•', percentage: 85 },
                                { label: 'ê³¼ê°í˜•', percentage: 60 },
                                { label: 'ë‘˜ ë‹¤', percentage: 75 }
                            ]
                        },
                        {
                            id: 3,
                            type: 'category',
                            title: 'ìƒˆ ì¹´í…Œê³ ë¦¬ ì œì•ˆ',
                            content: '"ê¸°ìˆ  > AI" í•˜ìœ„ ì¹´í…Œê³ ë¦¬ë¥¼ ì¶”ê°€í•˜ì‹œê² ìŠµë‹ˆê¹Œ?',
                            description: 'ChatGPT, Copilot ë“± AI ê´€ë ¨ ì‚¬ë¡€ê°€ 20ê°œ ì´ìƒ ìˆ˜ì§‘ë˜ì—ˆìŠµë‹ˆë‹¤.',
                            preview: 'ê¸°ìˆ /\n  â”œâ”€ ë°˜ë„ì²´\n  â”œâ”€ ì†Œí”„íŠ¸ì›¨ì–´\n  â””â”€ AI/ â† ì‹ ê·œ\n      â”œâ”€ LLM\n      â””â”€ ìƒì„±í˜• AI',
                            options: ['ê¸°ìˆ  í•˜ìœ„ë¡œ', 'ë³„ë„ ìµœìƒìœ„ë¡œ', 'ë°˜ë ¤']
                        }
                    ],
                    activities: [
                        { time: '5ë¶„ ì „', action: 'ìŠ¹ì¸', content: 'ì´ì¬ìš© ë„¤íŠ¸ì›Œí¬ ì™¸êµ ì‚¬ë¡€ (ê²½ì œ > ì‚¼ì„±)' },
                        { time: '12ë¶„ ì „', action: 'ìŠ¹ì¸', content: 'ì •ì˜ì„  í˜‘ë ¥ì‚¬ ìƒìƒ ì‚¬ë¡€ (ê²½ì œ > í˜„ëŒ€ì°¨)' },
                        { time: '25ë¶„ ì „', action: 'ê±°ì ˆ', content: 'ì¼ë°˜ì ì¸ ë¦¬ë”ì‹­ ê¸°ì‚¬' },
                        { time: '41ë¶„ ì „', action: 'ì¹´í…Œê³ ë¦¬', content: 'ê²½ì œ > ì‚¼ì„± í•˜ìœ„ ì¹´í…Œê³ ë¦¬ ìƒì„±' },
                        { time: '1ì‹œê°„ ì „', action: 'ìŠ¹ì¸', content: 'ì†í¥ë¯¼ íŒ€ì›Œí¬ ì‚¬ë¡€ (ìŠ¤í¬ì¸  > ì¶•êµ¬)' }
                    ],
                    createdAt: new Date().toISOString()
                };
                
                await setDoc(userDocRef, initialData);
            }
            
            // ì‹¤ì‹œê°„ ë°ì´í„° ë¦¬ìŠ¤ë„ˆ
            onSnapshot(userDocRef, (doc) => {
                if (doc.exists()) {
                    const data = doc.data();
                    updateUI(data);
                }
            });
        }
        
        window.initializeDashboard = initializeDashboard;
    </script>
    
    <script>
        // ë¡œê·¸ì¸/íšŒì›ê°€ì…
        function showLogin() {
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('signupForm').style.display = 'none';
            hideError();
        }
        
        function showSignup() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('signupForm').style.display = 'block';
            hideError();
        }
        
        function showError(message) {
            const errorEl = document.getElementById('errorMessage');
            errorEl.textContent = message;
            errorEl.classList.add('show');
        }
        
        function hideError() {
            document.getElementById('errorMessage').classList.remove('show');
        }
        
        async function login() {
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) {
                showError('ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            try {
                await window.firebaseModules.signInWithEmailAndPassword(window.auth, email, password);
            } catch (error) {
                if (error.code === 'auth/user-not-found') {
                    showError('ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê³„ì •ì…ë‹ˆë‹¤.');
                } else if (error.code === 'auth/wrong-password') {
                    showError('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                } else if (error.code === 'auth/invalid-email') {
                    showError('ìœ íš¨í•˜ì§€ ì•Šì€ ì´ë©”ì¼ í˜•ì‹ì…ë‹ˆë‹¤.');
                } else {
                    showError('ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
                }
            }
        }
        
        async function signup() {
            const email = document.getElementById('signupEmail').value.trim();
            const password = document.getElementById('signupPassword').value;
            const passwordConfirm = document.getElementById('signupPasswordConfirm').value;
            
            if (!email || !password || !passwordConfirm) {
                showError('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (password.length < 6) {
                showError('ë¹„ë°€ë²ˆí˜¸ëŠ” ìµœì†Œ 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }
            
            if (password !== passwordConfirm) {
                showError('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                return;
            }
            
            try {
                await window.firebaseModules.createUserWithEmailAndPassword(window.auth, email, password);
                showToast('íšŒì›ê°€ì… ì™„ë£Œ! ğŸ‰');
            } catch (error) {
                if (error.code === 'auth/email-already-in-use') {
                    showError('ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì´ë©”ì¼ì…ë‹ˆë‹¤.');
                } else if (error.code === 'auth/invalid-email') {
                    showError('ìœ íš¨í•˜ì§€ ì•Šì€ ì´ë©”ì¼ í˜•ì‹ì…ë‹ˆë‹¤.');
                } else {
                    showError('íšŒì›ê°€ì…ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
                }
            }
        }
        
        async function logout() {
            try {
                await window.firebaseModules.signOut(window.auth);
                showToast('ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤');
            } catch (error) {
                showToast('ë¡œê·¸ì•„ì›ƒì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
            }
        }
        
        // Enter í‚¤ ì§€ì›
        document.addEventListener('DOMContentLoaded', () => {
            const loginInputs = ['loginEmail', 'loginPassword'];
            loginInputs.forEach(id => {
                document.getElementById(id)?.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') login();
                });
            });
            
            const signupInputs = ['signupEmail', 'signupPassword', 'signupPasswordConfirm'];
            signupInputs.forEach(id => {
                document.getElementById(id)?.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') signup();
                });
            });
        });
        
        // UI ì—…ë°ì´íŠ¸
        function updateUI(data) {
            // í†µê³„ ì—…ë°ì´íŠ¸
            document.getElementById('statTotal').textContent = data.stats.total;
            document.getElementById('statPending').textContent = data.stats.pending;
            document.getElementById('statApproved').textContent = data.stats.approved;
            document.getElementById('statRejected').textContent = data.stats.rejected;
            document.getElementById('pendingBadge').textContent = data.approvalQueue.length;
            
            // ìŠ¹ì¸ ëª©ë¡ ì—…ë°ì´íŠ¸
            const approvalList = document.getElementById('approvalList');
            if (data.approvalQueue.length === 0) {
                approvalList.innerHTML = `
                    <div class="empty-state">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                        </svg>
                        <p>ëª¨ë“  í•­ëª©ì„ ì²˜ë¦¬í–ˆì–´ìš”! ğŸ‰</p>
                    </div>
                `;
            } else {
                approvalList.innerHTML = data.approvalQueue.map(item => {
                    let buttonsHtml = '';
                    
                    if (item.type === 'classification' && Array.isArray(item.options)) {
                        // í¼ì„¼í…Œì´ì§€ê°€ ìˆëŠ” ì˜µì…˜
                        buttonsHtml = item.options.map((option, index) => {
                            let btnClass = 'btn-secondary';
                            if (index === 0 && option.percentage >= 70) btnClass = 'btn-approve';
                            else if (index === 1 && option.percentage >= 70) btnClass = 'btn-alt';
                            
                            return `
                                <button class="btn ${btnClass}" onclick="handleApproval(${item.id}, '${option.label}')">
                                    ${option.label}
                                    <span class="percentage">${option.percentage}% ì í•©</span>
                                </button>
                            `;
                        }).join('');
                    } else {
                        // ì¼ë°˜ ì˜µì…˜
                        buttonsHtml = item.options.map((option, index) => {
                            let btnClass = 'btn-secondary';
                            if (index === 0) btnClass = 'btn-approve';
                            if (index === item.options.length - 1 && option === 'ë°˜ë ¤') btnClass = 'btn-reject';
                            if (index === 1 && item.options.length === 3) btnClass = 'btn-alt';
                            
                            return `<button class="btn ${btnClass}" onclick="handleApproval(${item.id}, '${option}')">${option}</button>`;
                        }).join('');
                    }
                    
                    return `
                        <div class="approval-item">
                            <div class="approval-title">${item.title}</div>
                            <div class="approval-content">${item.content}</div>
                            ${item.description ? `<div class="approval-content" style="font-size: 13px; margin-top: -10px;">${item.description}</div>` : ''}
                            ${item.preview ? `<div class="category-preview">${item.preview}</div>` : ''}
                            <div class="approval-actions">
                                ${buttonsHtml}
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            // ìµœê·¼ í™œë™ ì—…ë°ì´íŠ¸
            const recentActivity = document.getElementById('recentActivity');
            if (data.activities.length === 0) {
                recentActivity.innerHTML = '<div class="empty-state"><p>ì•„ì§ í™œë™ì´ ì—†ì–´ìš”</p></div>';
            } else {
                recentActivity.innerHTML = data.activities.map(activity => `
                    <div style="padding: 15px 0; border-bottom: 1px solid #f3f4f6;">
                        <div style="display: flex; justify-content: space-between; align-items: start;">
                            <div>
                                <span style="font-weight: 600; color: ${
                                    activity.action === 'ìŠ¹ì¸' ? '#10b981' : 
                                    activity.action === 'ê±°ì ˆ' ? '#ef4444' :
                                    activity.action === 'ì¹´í…Œê³ ë¦¬' ? '#6366f1' : '#f59e0b'
                                };">
                                    ${activity.action === 'ìŠ¹ì¸' ? 'âœ…' : activity.action === 'ê±°ì ˆ' ? 'âŒ' : activity.action === 'ì¹´í…Œê³ ë¦¬' ? 'ğŸ“' : 'ğŸ“Š'} ${activity.action}
                                </span>
                                <div style="color: #6b7280; margin-top: 4px; font-size: 14px;">${activity.content}</div>
                            </div>
                            <div style="color: #9ca3af; font-size: 12px; white-space: nowrap; margin-left: 10px;">${activity.time}</div>
                        </div>
                    </div>
                `).join('');
            }
            
            // ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ì‹œê°„
            document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });
        }
        
        // ìŠ¹ì¸ ì²˜ë¦¬
        async function handleApproval(itemId, decision) {
            const user = window.auth.currentUser;
            if (!user) return;
            
            const userDocRef = window.firebaseModules.doc(window.db, 'users', user.uid);
            const userDoc = await window.firebaseModules.getDoc(userDocRef);
            
            if (!userDoc.exists()) return;
            
            const data = userDoc.data();
            const item = data.approvalQueue.find(i => i.id === itemId);
            if (!item) return;
            
            // íì—ì„œ ì œê±°
            data.approvalQueue = data.approvalQueue.filter(i => i.id !== itemId);
            
            // í†µê³„ ì—…ë°ì´íŠ¸
            data.stats.pending--;
            if (decision === 'ë°˜ë ¤') {
                data.stats.rejected++;
            } else {
                data.stats.approved++;
            }
            
            // í™œë™ ì¶”ê°€
            const actionType = decision === 'ë°˜ë ¤' ? 'ê±°ì ˆ' : item.type === 'category' ? 'ì¹´í…Œê³ ë¦¬' : 'ìŠ¹ì¸';
            data.activities.unshift({
                time: 'ë°©ê¸ˆ',
                action: actionType,
                content: `${item.title} - ${decision}`
            });
            
            // ìµœëŒ€ 20ê°œë§Œ ìœ ì§€
            if (data.activities.length > 20) {
                data.activities = data.activities.slice(0, 20);
            }
            
            // Firestore ì—…ë°ì´íŠ¸
            await window.firebaseModules.updateDoc(userDocRef, data);
            
            showToast(`${actionType}í–ˆì–´ìš”: ${item.title}`);
        }
        
        // í† ìŠ¤íŠ¸ í‘œì‹œ
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }
        
        // íƒ­ ì „í™˜
        function showTab(tab) {
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => item.classList.remove('active'));
            event.currentTarget.classList.add('active');
            
            if (tab === 'categories') {
                showToast('ì¹´í…Œê³ ë¦¬ ê´€ë¦¬ ê¸°ëŠ¥ì€ ê³§ ì¶”ê°€ë  ì˜ˆì •ì´ì—ìš”!');
            } else if (tab === 'settings') {
                showToast('ì„¤ì • ê¸°ëŠ¥ì€ ê³§ ì¶”ê°€ë  ì˜ˆì •ì´ì—ìš”!');
            }
        }
    </script>
</body>
</html>
