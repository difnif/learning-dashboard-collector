<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>íŒ€í”Œ ìœ í˜• í•™ìŠµ ì‹œìŠ¤í…œ</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Apple SD Gothic Neo', sans-serif;
      background: #f5f5f5;
      padding-bottom: 80px;
      overflow-x: hidden;
    }

    /* ================== í•˜ë‹¨ íƒ­ ë„¤ë¹„ê²Œì´ì…˜ ================== */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: white;
      border-top: 1px solid #e0e0e0;
      display: flex;
      justify-content: space-around;
      align-items: flex-end;
      height: 70px;
      z-index: 1000;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
    }

    .tab-button {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 10px;
      background: none;
      border: none;
      cursor: pointer;
      transition: all 0.3s;
      position: relative;
      height: 60px;
    }

    .tab-button.board {
      height: 80px;
      margin-bottom: 10px;
      background: #FF6B35;
      border-radius: 50%;
      width: 70px;
      box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
    }

    .tab-button.board .tab-icon {
      font-size: 28px;
    }

    .tab-button.board .tab-label {
      display: none;
    }

    .tab-button.board.active {
      background: #E85A2B;
      transform: scale(1.05);
    }

    .tab-icon {
      font-size: 24px;
      margin-bottom: 4px;
      transition: all 0.2s;
    }

    .tab-label {
      font-size: 11px;
      color: #666;
      transition: all 0.2s;
    }

    .tab-button.active .tab-label {
      color: #FF6B35;
      font-weight: 600;
    }

    .tab-button.active .tab-icon {
      color: #FF6B35;
      transform: scale(1.1);
    }

    .tab-button.board .tab-icon,
    .tab-button.board .tab-label {
      color: white;
    }

    /* ================== ë©”ì¸ ì»¨í…ì¸  ================== */
    .content {
      display: none;
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
      animation: fadeIn 0.3s;
    }

    .content.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .content-header {
      margin-bottom: 24px;
    }

    .content-title {
      font-size: 28px;
      font-weight: 700;
      color: #222;
      margin-bottom: 8px;
    }

    .content-subtitle {
      font-size: 14px;
      color: #666;
    }

    /* ================== ê³µí†µ ì»´í¬ë„ŒíŠ¸ ================== */
    .section {
      background: white;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .section-title {
      font-size: 18px;
      font-weight: 700;
      color: #222;
    }

    .more-button {
      background: none;
      border: none;
      color: #FF6B35;
      font-size: 14px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 4px;
      font-weight: 600;
    }

    .more-button:hover {
      text-decoration: underline;
    }

    /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .btn-primary {
      background: #FF6B35;
      color: white;
    }

    .btn-primary:hover {
      background: #E85A2B;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
    }

    .btn-secondary {
      background: #f0f0f0;
      color: #666;
    }

    .btn-secondary:hover {
      background: #e0e0e0;
    }

    .btn-danger {
      background: #FFEBEE;
      color: #C62828;
    }

    .btn-danger:hover {
      background: #FFCDD2;
    }

    /* ================== DB íƒ­ ìŠ¤íƒ€ì¼ ================== */
    .case-card {
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 12px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .case-card:hover {
      border-color: #FF6B35;
      box-shadow: 0 2px 8px rgba(255, 107, 53, 0.1);
      transform: translateY(-2px);
    }

    .case-title {
      font-size: 16px;
      font-weight: 600;
      color: #222;
      margin-bottom: 8px;
      line-height: 1.4;
    }

    .case-meta {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .meta-badge {
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 500;
    }

    .meta-badge.actor {
      background: #FFF3E0;
      color: #F57C00;
    }

    .meta-badge.type {
      background: #E8F5E9;
      color: #2E7D32;
    }

    .meta-badge.source {
      background: #E3F2FD;
      color: #1565C0;
    }

    .meta-badge.date {
      background: #F3E5F5;
      color: #7B1FA2;
    }

    /* í•« í”Œë ˆì´ì–´ */
    .hot-player-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .hot-player-item {
      display: flex;
      align-items: center;
      padding: 12px;
      background: #f8f8f8;
      border-radius: 8px;
      transition: all 0.2s;
    }

    .hot-player-item:hover {
      background: #FFF3E0;
      cursor: pointer;
      transform: translateX(4px);
    }

    .hot-player-rank {
      font-size: 18px;
      font-weight: 700;
      color: #FF6B35;
      width: 40px;
      text-align: center;
    }

    .hot-player-name {
      flex: 1;
      font-size: 15px;
      font-weight: 600;
      color: #222;
    }

    .hot-player-count {
      font-size: 14px;
      color: #666;
      background: white;
      padding: 4px 12px;
      border-radius: 12px;
    }

    /* í† í”½ ê·¸ë¦¬ë“œ */
    .topic-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 12px;
    }

    .topic-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      border-radius: 12px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
    }

    .topic-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 16px rgba(0,0,0,0.2);
    }

    .topic-card.hot {
      background: linear-gradient(135deg, #FF6B35 0%, #F7931E 100%);
      box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
    }

    .topic-name {
      font-size: 16px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .topic-count {
      font-size: 12px;
      opacity: 0.9;
    }

    /* ìœ í˜• í´ë¼ìš°ë“œ */
    .type-cloud {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
      gap: 12px;
      padding: 20px;
      min-height: 200px;
    }

    .type-bubble {
      padding: 12px 24px;
      border-radius: 24px;
      background: white;
      border: 2px solid #FF6B35;
      color: #FF6B35;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      white-space: nowrap;
    }

    .type-bubble:hover {
      background: #FF6B35;
      color: white;
      transform: scale(1.1);
    }

    .type-bubble.size-1 { font-size: 12px; }
    .type-bubble.size-2 { font-size: 14px; }
    .type-bubble.size-3 { font-size: 16px; }
    .type-bubble.size-4 { font-size: 18px; }
    .type-bubble.size-5 { font-size: 22px; font-weight: 700; }

    /* ê²€ìƒ‰ì°½ */
    .search-bar {
      display: flex;
      gap: 8px;
      margin-bottom: 20px;
    }

    .search-select {
      padding: 10px 16px;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      font-size: 14px;
      background: white;
      cursor: pointer;
    }

    .search-input {
      flex: 1;
      padding: 10px 16px;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      font-size: 14px;
    }

    .search-button {
      padding: 10px 24px;
      background: #FF6B35;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
    }

    /* ================== ê²€í†  íƒ­ ìŠ¤íƒ€ì¼ ================== */
    .review-container {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: calc(100vh - 200px);
      padding: 20px;
    }

    .review-card {
      background: white;
      border-radius: 16px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.1);
      max-width: 600px;
      width: 100%;
      overflow: hidden;
      transition: all 0.3s;
    }

    .review-card.slide-out-left {
      animation: slideOutLeft 0.3s forwards;
    }

    .review-card.slide-out-right {
      animation: slideOutRight 0.3s forwards;
    }

    .review-card.slide-out-down {
      animation: slideOutDown 0.3s forwards;
    }

    @keyframes slideOutLeft {
      to { transform: translateX(-150%) rotate(-10deg); opacity: 0; }
    }

    @keyframes slideOutRight {
      to { transform: translateX(150%) rotate(10deg); opacity: 0; }
    }

    @keyframes slideOutDown {
      to { transform: translateY(100%); opacity: 0; }
    }

    .review-card-header {
      padding: 20px;
      border-bottom: 2px solid #f0f0f0;
    }

    .review-type-badge {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 600;
      margin-bottom: 12px;
    }

    .review-type-badge.actor {
      background: #FFF3E0;
      color: #F57C00;
      border: 2px solid #F57C00;
    }

    .review-type-badge.type {
      background: #E8F5E9;
      color: #2E7D32;
      border: 2px solid #2E7D32;
    }

    .review-type-badge.both {
      background: #E3F2FD;
      color: #1565C0;
      border: 2px solid #1565C0;
    }

    .review-card-title {
      font-size: 18px;
      font-weight: 700;
      color: #222;
      line-height: 1.4;
      margin-bottom: 8px;
    }

    .review-card-body {
      padding: 20px;
    }

    .review-section {
      margin-bottom: 20px;
    }

    .review-label {
      font-size: 12px;
      font-weight: 600;
      color: #666;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 8px;
    }

    .review-content {
      font-size: 14px;
      line-height: 1.6;
      color: #333;
      background: #f8f8f8;
      padding: 12px;
      border-radius: 8px;
    }

    .review-excerpt {
      background: #FFF9F5;
      border-left: 4px solid #FF6B35;
      padding: 12px;
      font-style: italic;
      margin: 12px 0;
    }

    .review-options {
      display: flex;
      gap: 8px;
      margin-top: 12px;
    }

    .option-chip {
      padding: 8px 16px;
      background: #f0f0f0;
      border: 2px solid transparent;
      border-radius: 20px;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .option-chip:hover {
      border-color: #FF6B35;
      background: #FFF3E0;
    }

    .review-card-footer {
      padding: 20px;
      background: #fafafa;
      display: flex;
      gap: 8px;
    }

    .footer-button {
      flex: 1;
      padding: 14px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .footer-button.option-a {
      background: #E3F2FD;
      color: #1565C0;
    }

    .footer-button.option-b {
      background: #F3E5F5;
      color: #7B1FA2;
    }

    .footer-button.refresh {
      background: #FFF3E0;
      color: #F57C00;
      flex: 0.5;
    }

    .footer-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .refresh-count {
      font-size: 11px;
      opacity: 0.7;
      margin-top: 2px;
    }

    /* ================== ë³´ë“œ íƒ­ ìŠ¤íƒ€ì¼ ================== */
    .manual-collect-section {
      background: linear-gradient(135deg, #FF6B35 0%, #F7931E 100%);
      border-radius: 12px;
      padding: 24px;
      text-align: center;
      margin-bottom: 24px;
      color: white;
      box-shadow: 0 4px 16px rgba(255, 107, 53, 0.3);
    }

    .manual-collect-title {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 12px;
    }

    .manual-collect-button {
      background: white;
      color: #FF6B35;
      padding: 14px 32px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .manual-collect-button:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 16px rgba(255,255,255,0.3);
    }

    .manual-collect-button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-bottom: 24px;
    }

    .stat-card {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      text-align: center;
    }

    .stat-value {
      font-size: 36px;
      font-weight: 700;
      color: #FF6B35;
      margin-bottom: 8px;
    }

    .stat-label {
      font-size: 14px;
      color: #666;
      font-weight: 600;
    }

    .chart-container {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }

    /* ================== í¸ì§‘ íƒ­ ìŠ¤íƒ€ì¼ ================== */
    .edit-section {
      background: white;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 20px;
    }

    .category-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .category-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px;
      background: #f8f8f8;
      border-radius: 8px;
      transition: all 0.2s;
    }

    .category-item:hover {
      background: #f0f0f0;
    }

    .category-info {
      flex: 1;
    }

    .category-name {
      font-size: 16px;
      font-weight: 600;
      color: #222;
      margin-bottom: 4px;
    }

    .category-keywords {
      font-size: 13px;
      color: #666;
    }

    .category-actions {
      display: flex;
      gap: 8px;
    }

    .icon-button {
      width: 36px;
      height: 36px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
      font-size: 16px;
    }

    .icon-button.edit {
      background: #E3F2FD;
      color: #1565C0;
    }

    .icon-button.delete {
      background: #FFEBEE;
      color: #C62828;
    }

    .icon-button:hover {
      transform: scale(1.1);
    }

    .add-category-form {
      display: flex;
      gap: 8px;
      margin-top: 16px;
    }

    .add-category-input {
      flex: 1;
      padding: 12px;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      font-size: 14px;
    }

    /* ================== ë¡œê·¸ íƒ­ ìŠ¤íƒ€ì¼ ================== */
    .log-filters {
      display: flex;
      gap: 8px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .filter-chip {
      padding: 8px 16px;
      background: #f0f0f0;
      border: 2px solid transparent;
      border-radius: 20px;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .filter-chip.active {
      background: #FF6B35;
      color: white;
      border-color: #FF6B35;
    }

    .log-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .log-item {
      background: white;
      padding: 16px;
      border-radius: 8px;
      border-left: 4px solid #e0e0e0;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    .log-item.collection {
      border-left-color: #4CAF50;
    }

    .log-item.review {
      border-left-color: #FF6B35;
    }

    .log-item.delete {
      border-left-color: #F44336;
    }

    .log-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .log-action {
      font-size: 14px;
      font-weight: 600;
      color: #222;
    }

    .log-time {
      font-size: 12px;
      color: #999;
    }

    .log-details {
      font-size: 13px;
      color: #666;
      line-height: 1.5;
    }

    /* ================== ëª¨ë‹¬ ================== */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      z-index: 2000;
      padding: 20px;
      overflow-y: auto;
    }

    .modal.active {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-content {
      background: white;
      border-radius: 12px;
      padding: 24px;
      max-width: 800px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      animation: modalSlideIn 0.3s;
    }

    @keyframes modalSlideIn {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 16px;
      border-bottom: 2px solid #f0f0f0;
    }

    .modal-title {
      font-size: 20px;
      font-weight: 700;
      color: #222;
    }

    .modal-close {
      background: none;
      border: none;
      font-size: 28px;
      color: #999;
      cursor: pointer;
      padding: 0;
      width: 32px;
      height: 32px;
      line-height: 1;
    }

    .modal-close:hover {
      color: #666;
    }

    .modal-section {
      margin-bottom: 24px;
    }

    .modal-section-title {
      font-size: 14px;
      font-weight: 600;
      color: #666;
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .modal-section-content {
      font-size: 15px;
      line-height: 1.6;
      color: #333;
    }

    .modal-excerpt {
      background: #FFF9F5;
      border-left: 4px solid #FF6B35;
      padding: 16px;
      border-radius: 4px;
      font-style: italic;
      margin: 12px 0;
    }

    .modal-actions {
      display: flex;
      gap: 8px;
      margin-top: 20px;
    }

    .action-button {
      flex: 1;
      padding: 12px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .action-button.delete {
      background: #FFEBEE;
      color: #C62828;
    }

    .action-button.delete:hover {
      background: #FFCDD2;
    }

    .action-button.review {
      background: #FFF3E0;
      color: #F57C00;
    }

    .action-button.review:hover {
      background: #FFE0B2;
    }

    .action-button.history {
      background: #E3F2FD;
      color: #1565C0;
    }

    .action-button.history:hover {
      background: #BBDEFB;
    }

    .external-link {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      color: #FF6B35;
      text-decoration: none;
      font-weight: 600;
      margin-top: 8px;
    }

    .external-link:hover {
      text-decoration: underline;
    }

    /* ================== ìœ í‹¸ë¦¬í‹° ================== */
    .loading {
      text-align: center;
      padding: 40px;
      color: #999;
    }

    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 4px solid #f0f0f0;
      border-top-color: #FF6B35;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 16px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #999;
    }

    .empty-state-icon {
      font-size: 48px;
      margin-bottom: 16px;
      opacity: 0.5;
    }

    .empty-state-text {
      font-size: 16px;
    }

    /* ================== ë°˜ì‘í˜• ================== */
    @media (max-width: 768px) {
      .content {
        padding: 16px;
      }

      .content-title {
        font-size: 24px;
      }

      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .topic-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .review-card {
        max-width: 100%;
      }
    }
  </style>
</head>
<body>

  <!-- DB íƒ­ ì»¨í…ì¸  -->
  <div id="db-content" class="content">
    <div class="content-header">
      <h1 class="content-title">ğŸ“š ë°ì´í„°ë² ì´ìŠ¤</h1>
      <p class="content-subtitle">ìˆ˜ì§‘ëœ íŒ€í”Œë ˆì´ ì¼€ì´ìŠ¤ ì•„ì¹´ì´ë¸Œ</p>
    </div>

    <!-- ì „ì²´ ì„¹ì…˜ -->
    <div class="section">
      <div class="section-header">
        <h2 class="section-title">ğŸ—‚ï¸ ì „ì²´</h2>
        <button class="more-button" onclick="showAllCases()">
          ì „ì²´ë³´ê¸° â†’
        </button>
      </div>
      <div id="recent-cases">
        <div class="loading">
          <div class="loading-spinner"></div>
          <div>ë°ì´í„° ë¡œë”© ì¤‘...</div>
        </div>
      </div>
    </div>

    <!-- í•« í”Œë ˆì´ì–´ ì„¹ì…˜ -->
    <div class="section">
      <div class="section-header">
        <h2 class="section-title">ğŸ”¥ í•« í”Œë ˆì´ì–´ (ìµœê·¼ 1ì£¼ì¼)</h2>
        <button class="more-button" onclick="showHotPlayersDetail()">
          TOP 20 ë³´ê¸° â†’
        </button>
      </div>
      <div id="hot-players">
        <div class="loading">
          <div class="loading-spinner"></div>
          <div>ë¶„ì„ ì¤‘...</div>
        </div>
      </div>
    </div>

    <!-- í† í”½ë³„ ì„¹ì…˜ -->
    <div class="section">
      <div class="section-header">
        <h2 class="section-title">ğŸ·ï¸ í† í”½ë³„</h2>
      </div>
      <div id="topics" class="topic-grid">
        <div class="loading">
          <div class="loading-spinner"></div>
          <div>ì¹´í…Œê³ ë¦¬ ë¡œë”© ì¤‘...</div>
        </div>
      </div>
    </div>

    <!-- ìœ í˜•ë³„ ì„¹ì…˜ -->
    <div class="section">
      <div class="section-header">
        <h2 class="section-title">â­ ìœ í˜•ë³„</h2>
      </div>
      <div id="types" class="type-cloud">
        <div class="loading">
          <div class="loading-spinner"></div>
          <div>ìœ í˜• ë¶„ì„ ì¤‘...</div>
        </div>
      </div>
    </div>
  </div>

  <!-- ê²€í†  íƒ­ ì»¨í…ì¸  -->
  <div id="review-content" class="content">
    <div class="content-header">
      <h1 class="content-title">âœ… ê²€í† </h1>
      <p class="content-subtitle">ë¶„ë¥˜ ê²€í† ê°€ í•„ìš”í•œ ì¼€ì´ìŠ¤ <span id="review-count"></span></p>
    </div>

    <div id="review-container" class="review-container">
      <div class="loading">
        <div class="loading-spinner"></div>
        <div>ê²€í†  ì¼€ì´ìŠ¤ ë¡œë”© ì¤‘...</div>
      </div>
    </div>
  </div>

  <!-- ë³´ë“œ íƒ­ ì»¨í…ì¸  -->
  <div id="board-content" class="content active">
    <div class="content-header">
      <h1 class="content-title">ğŸ“Š ëŒ€ì‹œë³´ë“œ</h1>
      <p class="content-subtitle">ìˆ˜ì§‘ í˜„í™© í•œëˆˆì— ë³´ê¸°</p>
    </div>

    <!-- ìˆ˜ë™ ìˆ˜ì§‘ ì„¹ì…˜ -->
    <div class="manual-collect-section">
      <div class="manual-collect-title">ğŸš€ ë°ì´í„° ìˆ˜ì§‘ ì‹¤í–‰</div>
      <button id="manual-collect-btn" class="manual-collect-button" onclick="manualCollect()">
        <span>â–¶ï¸</span>
        <span>ìˆ˜ë™ ìˆ˜ì§‘ ì‹œì‘</span>
      </button>
      <div id="collect-status" style="margin-top: 12px; font-size: 13px;"></div>
    </div>

    <!-- í†µê³„ ì¹´ë“œ -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-value" id="stat-total">-</div>
        <div class="stat-label">ì´ ìˆ˜ì§‘</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="stat-pending">-</div>
        <div class="stat-label">ê²€í†  ëŒ€ê¸°</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="stat-approved">-</div>
        <div class="stat-label">ìŠ¹ì¸</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="stat-rejected">-</div>
        <div class="stat-label">ê±°ì ˆ</div>
      </div>
    </div>

    <!-- ìµœê·¼ í™œë™ -->
    <div class="section">
      <div class="section-header">
        <h2 class="section-title">ğŸ“‹ ìµœê·¼ í™œë™</h2>
      </div>
      <div id="recent-logs">
        <div class="loading">
          <div class="loading-spinner"></div>
          <div>ë¡œê·¸ ë¡œë”© ì¤‘...</div>
        </div>
      </div>
    </div>
  </div>

  <!-- í¸ì§‘ íƒ­ ì»¨í…ì¸  -->
  <div id="edit-content" class="content">
    <div class="content-header">
      <h1 class="content-title">âš™ï¸ í¸ì§‘</h1>
      <p class="content-subtitle">ì¹´í…Œê³ ë¦¬ ë° ìœ í˜• ê´€ë¦¬</p>
    </div>

    <!-- ì¹´í…Œê³ ë¦¬ ê´€ë¦¬ -->
    <div class="edit-section">
      <h2 class="section-title">ğŸ·ï¸ 1ì°¨ ì¹´í…Œê³ ë¦¬ ê´€ë¦¬</h2>
      <div id="primary-categories" class="category-list">
        <div class="loading">
          <div class="loading-spinner"></div>
          <div>ì¹´í…Œê³ ë¦¬ ë¡œë”© ì¤‘...</div>
        </div>
      </div>
      <div class="add-category-form">
        <input type="text" id="new-category-name" class="add-category-input" placeholder="ìƒˆ ì¹´í…Œê³ ë¦¬ ì´ë¦„">
        <input type="text" id="new-category-keywords" class="add-category-input" placeholder="í‚¤ì›Œë“œ (ì‰¼í‘œë¡œ êµ¬ë¶„)">
        <button class="btn btn-primary" onclick="addCategory()">ì¶”ê°€</button>
      </div>
    </div>

    <!-- ìœ í˜• ë³‘í•© -->
    <div class="edit-section">
      <h2 class="section-title">â­ ìœ í˜• ë³‘í•©</h2>
      <div style="display: flex; gap: 12px; margin-bottom: 16px;">
        <select id="merge-from" class="search-select" style="flex: 1;">
          <option value="">ë³‘í•©í•  ìœ í˜• ì„ íƒ</option>
        </select>
        <span style="display: flex; align-items: center;">â†’</span>
        <select id="merge-to" class="search-select" style="flex: 1;">
          <option value="">ë³‘í•© ëŒ€ìƒ ìœ í˜•</option>
        </select>
        <button class="btn btn-primary" onclick="mergeTypes()">ë³‘í•©</button>
      </div>
      <p style="font-size: 13px; color: #666;">â€» ë³‘í•©í•˜ë©´ ëª¨ë“  ì¼€ì´ìŠ¤ì˜ ìœ í˜•ì´ ë³€ê²½ë˜ë©°, ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
    </div>

    <!-- 2ì°¨ ì¹´í…Œê³ ë¦¬ ìŠ¹ê²© ì œì•ˆ -->
    <div class="edit-section">
      <h2 class="section-title">ğŸ“ˆ 2ì°¨ â†’ 1ì°¨ ìŠ¹ê²© ì œì•ˆ</h2>
      <div id="promotion-suggestions">
        <div class="empty-state">
          <div class="empty-state-text">ìŠ¹ê²© ì œì•ˆ ê¸°ëŠ¥ ì¤€ë¹„ ì¤‘...</div>
        </div>
      </div>
    </div>
  </div>

  <!-- ë¡œê·¸ íƒ­ ì»¨í…ì¸  -->
  <div id="log-content" class="content">
    <div class="content-header">
      <h1 class="content-title">ğŸ“‹ ë¡œê·¸</h1>
      <p class="content-subtitle">í™œë™ ê¸°ë¡</p>
    </div>

    <!-- í•„í„° -->
    <div class="log-filters">
      <div class="filter-chip active" data-filter="all" onclick="filterLogs('all')">ì „ì²´</div>
      <div class="filter-chip" data-filter="collection" onclick="filterLogs('collection')">ìˆ˜ì§‘</div>
      <div class="filter-chip" data-filter="review" onclick="filterLogs('review')">ê²€í† </div>
      <div class="filter-chip" data-filter="delete" onclick="filterLogs('delete')">ì‚­ì œ</div>
      <div class="filter-chip" data-filter="manual" onclick="filterLogs('manual')">ìˆ˜ë™ ì‹¤í–‰</div>
    </div>

    <!-- ë¡œê·¸ ë¦¬ìŠ¤íŠ¸ -->
    <div id="log-list" class="log-list">
      <div class="loading">
        <div class="loading-spinner"></div>
        <div>ë¡œê·¸ ë¡œë”© ì¤‘...</div>
      </div>
    </div>
  </div>

  <!-- ì¼€ì´ìŠ¤ ìƒì„¸ ëª¨ë‹¬ -->
  <div id="case-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="modal-title">ì¼€ì´ìŠ¤ ìƒì„¸</h3>
        <button class="modal-close" onclick="closeModal()">Ã—</button>
      </div>

      <div class="modal-section">
        <div class="modal-section-title">ë°œì·Œ ë‚´ìš©</div>
        <div class="modal-excerpt" id="modal-excerpt"></div>
      </div>

      <div class="modal-section">
        <div class="modal-section-title">í–‰ìœ„ ì£¼ì²´</div>
        <div class="modal-section-content" id="modal-actor"></div>
      </div>

      <div class="modal-section">
        <div class="modal-section-title">íŒ€í”Œë ˆì´ ìœ í˜•</div>
        <div class="modal-section-content" id="modal-type"></div>
      </div>

      <div class="modal-section">
        <div class="modal-section-title">ë¶„ë¥˜ ê·¼ê±°</div>
        <div class="modal-section-content" id="modal-reason"></div>
      </div>

      <div class="modal-section">
        <div class="modal-section-title">ì›ë¬¸ ë§í¬</div>
        <a id="modal-link" class="external-link" href="#" target="_blank">
          ì›ë¬¸ ë³´ê¸° â†’
        </a>
      </div>

      <div class="modal-actions">
        <button class="action-button delete" onclick="deleteCase()">
          ğŸ—‘ï¸ ì‚­ì œ
        </button>
        <button class="action-button review" onclick="moveToReviewFromModal()">
          âœï¸ ê²€í† ë¡œ ì´ë™
        </button>
        <button class="action-button history" onclick="showHistory()">
          ğŸ“„ ìŠ¹ì¸ ê¸°ë¡
        </button>
      </div>
    </div>
  </div>

  <!-- í•˜ë‹¨ íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
  <nav class="bottom-nav">
    <button class="tab-button" onclick="switchTab('db')">
      <div class="tab-icon">ğŸ“š</div>
      <div class="tab-label">DB</div>
    </button>
    <button class="tab-button" onclick="switchTab('review')">
      <div class="tab-icon">âœ…</div>
      <div class="tab-label">ê²€í† </div>
    </button>
    <button class="tab-button board active" onclick="switchTab('board')">
      <div class="tab-icon">ğŸ“Š</div>
    </button>
    <button class="tab-button" onclick="switchTab('edit')">
      <div class="tab-icon">âš™ï¸</div>
      <div class="tab-label">í¸ì§‘</div>
    </button>
    <button class="tab-button" onclick="switchTab('log')">
      <div class="tab-icon">ğŸ“‹</div>
      <div class="tab-label">ë¡œê·¸</div>
    </button>
  </nav>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getFirestore, collection, query, orderBy, limit, getDocs, where, doc, getDoc, updateDoc, deleteDoc, addDoc, Timestamp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

    // Firebase ì„¤ì • (ì‹¤ì œ ê°’ìœ¼ë¡œ êµì²´í•˜ì„¸ìš”)
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // ì „ì—­ ë³€ìˆ˜
    window.db = db;
    window.currentCaseId = null;
    window.currentReviewCase = null;
    window.reviewQueue = [];
    window.reviewIndex = 0;
    window.refreshCount = 0;
    window.currentLogFilter = 'all';

    // ==================== íƒ­ ì „í™˜ ====================
    window.switchTab = function(tabName) {
      // ëª¨ë“  íƒ­ ë²„íŠ¼ ë¹„í™œì„±í™”
      document.querySelectorAll('.tab-button').forEach(btn => {
        btn.classList.remove('active');
      });
      
      // ëª¨ë“  ì»¨í…ì¸  ìˆ¨ê¸°ê¸°
      document.querySelectorAll('.content').forEach(content => {
        content.classList.remove('active');
      });
      
      // ì„ íƒëœ íƒ­ í™œì„±í™”
      event.target.closest('.tab-button').classList.add('active');
      document.getElementById(`${tabName}-content`).classList.add('active');

      // íƒ­ë³„ ë¡œë“œ í•¨ìˆ˜ ì‹¤í–‰
      if (tabName === 'db') {
        loadDBTab();
      } else if (tabName === 'review') {
        loadReviewTab();
      } else if (tabName === 'board') {
        loadBoardTab();
      } else if (tabName === 'edit') {
        loadEditTab();
      } else if (tabName === 'log') {
        loadLogTab();
      }

      // ë§ˆì§€ë§‰ íƒ­ ì €ì¥
      localStorage.setItem('lastTab', tabName);
    };

    // ==================== DB íƒ­ ====================
    async function loadDBTab() {
      await loadRecentCases();
      await loadHotPlayers();
      await loadTopics();
      await loadTypes();
    }

    async function loadRecentCases() {
      try {
        const casesRef = collection(db, 'cases');
        const q = query(casesRef, orderBy('collectedAt', 'desc'), limit(5));
        const snapshot = await getDocs(q);
        
        const container = document.getElementById('recent-cases');
        
        if (snapshot.empty) {
          container.innerHTML = `
            <div class="empty-state">
              <div class="empty-state-icon">ğŸ“­</div>
              <div class="empty-state-text">ì•„ì§ ìˆ˜ì§‘ëœ ì¼€ì´ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤</div>
            </div>
          `;
          return;
        }
        
        let html = '';
        snapshot.forEach(doc => {
          const data = doc.data();
          html += `
            <div class="case-card" onclick="openCaseModal('${doc.id}')">
              <div class="case-title">${data.title}</div>
              <div class="case-meta">
                <span class="meta-badge actor">${data.actor?.label || 'ë¯¸ë¶„ë¥˜'}</span>
                <span class="meta-badge type">${data.teamType?.label || 'ë¯¸ë¶„ë¥˜'}</span>
                <span class="meta-badge source">${data.source === 'blog' ? 'ë¸”ë¡œê·¸' : 'ë‰´ìŠ¤'}</span>
                <span class="meta-badge date">${formatDate(data.postDate)}</span>
              </div>
            </div>
          `;
        });
        
        container.innerHTML = html;
      } catch (error) {
        console.error('ì¼€ì´ìŠ¤ ë¡œë“œ ì˜¤ë¥˜:', error);
        document.getElementById('recent-cases').innerHTML = `
          <div class="empty-state">
            <div class="empty-state-text">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</div>
          </div>
        `;
      }
    }

    async function loadHotPlayers() {
      try {
        const casesRef = collection(db, 'cases');
        const oneWeekAgo = new Date();
        oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
        
        const q = query(casesRef);
        const snapshot = await getDocs(q);
        
        // í–‰ìœ„ ì£¼ì²´ ë¹ˆë„ ê³„ì‚° (ìµœê·¼ 1ì£¼ì¼)
        const actorCount = {};
        snapshot.forEach(doc => {
          const data = doc.data();
          const collectedDate = new Date(data.collectedAt);
          if (collectedDate >= oneWeekAgo && data.actor?.label) {
            const actor = data.actor.label;
            actorCount[actor] = (actorCount[actor] || 0) + 1;
          }
        });
        
        // ìƒìœ„ 5ê°œ
        const sorted = Object.entries(actorCount)
          .sort((a, b) => b[1] - a[1])
          .slice(0, 5);
        
        const container = document.getElementById('hot-players');
        
        if (sorted.length === 0) {
          container.innerHTML = `
            <div class="empty-state">
              <div class="empty-state-text">ì•„ì§ ë°ì´í„°ê°€ ì¶©ë¶„í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤</div>
            </div>
          `;
          return;
        }
        
        let html = '<div class="hot-player-list">';
        sorted.forEach(([actor, count], index) => {
          html += `
            <div class="hot-player-item" onclick="filterByActor('${actor}')">
              <div class="hot-player-rank">${index + 1}</div>
              <div class="hot-player-name">${actor}</div>
              <div class="hot-player-count">${count}ê±´</div>
            </div>
          `;
        });
        html += '</div>';
        
        container.innerHTML = html;
      } catch (error) {
        console.error('í•« í”Œë ˆì´ì–´ ë¡œë“œ ì˜¤ë¥˜:', error);
      }
    }

    async function loadTopics() {
      try {
        const casesRef = collection(db, 'cases');
        const snapshot = await getDocs(casesRef);
        
        // ì¹´í…Œê³ ë¦¬ ë¹ˆë„ ê³„ì‚°
        const categoryCount = {};
        snapshot.forEach(doc => {
          const data = doc.data();
          if (data.primaryCategory?.label) {
            const category = data.primaryCategory.label;
            categoryCount[category] = (categoryCount[category] || 0) + 1;
          }
        });
        
        // ë¹ˆë„ìˆœ ì •ë ¬
        const sorted = Object.entries(categoryCount)
          .sort((a, b) => b[1] - a[1]);
        
        const container = document.getElementById('topics');
        
        if (sorted.length === 0) {
          container.innerHTML = `
            <div class="empty-state">
              <div class="empty-state-text">ì¹´í…Œê³ ë¦¬ ë°ì´í„° ì—†ìŒ</div>
            </div>
          `;
          return;
        }
        
        let html = '';
        sorted.forEach(([category, count], index) => {
          const isHot = index < 4;
          html += `
            <div class="topic-card ${isHot ? 'hot' : ''}" onclick="filterByCategory('${category}')">
              <div class="topic-name">${category}</div>
              <div class="topic-count">${count}ê±´</div>
            </div>
          `;
        });
        
        container.innerHTML = html;
      } catch (error) {
        console.error('í† í”½ ë¡œë“œ ì˜¤ë¥˜:', error);
      }
    }

    async function loadTypes() {
      try {
        const casesRef = collection(db, 'cases');
        const snapshot = await getDocs(casesRef);
        
        // ìœ í˜• ë¹ˆë„ ê³„ì‚°
        const typeCount = {};
        snapshot.forEach(doc => {
          const data = doc.data();
          if (data.teamType?.label) {
            const type = data.teamType.label;
            typeCount[type] = (typeCount[type] || 0) + 1;
          }
        });
        
        // ë¹ˆë„ìˆœ ì •ë ¬
        const sorted = Object.entries(typeCount)
          .sort((a, b) => b[1] - a[1]);
        
        const container = document.getElementById('types');
        
        if (sorted.length === 0) {
          container.innerHTML = `
            <div class="empty-state">
              <div class="empty-state-text">ìœ í˜• ë°ì´í„° ì—†ìŒ</div>
            </div>
          `;
          return;
        }
        
        // í¬ê¸° ê²°ì •
        const maxCount = sorted[0][1];
        let html = '';
        sorted.forEach(([type, count]) => {
          const size = Math.ceil((count / maxCount) * 5);
          html += `
            <div class="type-bubble size-${size}" onclick="filterByType('${type}')">${type}</div>
          `;
        });
        
        container.innerHTML = html;
      } catch (error) {
        console.error('ìœ í˜• ë¡œë“œ ì˜¤ë¥˜:', error);
      }
    }

    // ==================== ê²€í†  íƒ­ ====================
    async function loadReviewTab() {
      try {
        const casesRef = collection(db, 'cases');
        const q = query(casesRef, where('status', 'in', ['pending-actor', 'pending-type', 'pending-both']));
        const snapshot = await getDocs(q);
        
        window.reviewQueue = [];
        snapshot.forEach(doc => {
          window.reviewQueue.push({ id: doc.id, data: doc.data() });
        });
        
        document.getElementById('review-count').textContent = `(${window.reviewQueue.length}ê±´)`;
        
        if (window.reviewQueue.length === 0) {
          document.getElementById('review-container').innerHTML = `
            <div class="empty-state">
              <div class="empty-state-icon">âœ…</div>
              <div class="empty-state-text">ê²€í† í•  ì¼€ì´ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤!</div>
            </div>
          `;
          return;
        }
        
        window.reviewIndex = 0;
        window.refreshCount = 0;
        showReviewCard();
      } catch (error) {
        console.error('ê²€í†  ë¡œë“œ ì˜¤ë¥˜:', error);
      }
    }

    function showReviewCard() {
      if (window.reviewIndex >= window.reviewQueue.length) {
        document.getElementById('review-container').innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">ğŸ‰</div>
            <div class="empty-state-text">ëª¨ë“  ê²€í†  ì™„ë£Œ!</div>
          </div>
        `;
        return;
      }
      
      const current = window.reviewQueue[window.reviewIndex];
      const data = current.data;
      
      let reviewType = '';
      let reviewTypeClass = '';
      if (data.status === 'pending-actor') {
        reviewType = 'í–‰ìœ„ ì£¼ì²´ ê²€í† ';
        reviewTypeClass = 'actor';
      } else if (data.status === 'pending-type') {
        reviewType = 'íŒ€í”Œ ìœ í˜• ê²€í† ';
        reviewTypeClass = 'type';
      } else {
        reviewType = 'ì£¼ì²´ & ìœ í˜• ê²€í† ';
        reviewTypeClass = 'both';
      }
      
      let optionsHtml = '';
      if (data.status === 'pending-actor' || data.status === 'pending-both') {
        const options = [data.actor.label, ...(data.actor.options || [])];
        optionsHtml += '<div class="review-section">';
        optionsHtml += '<div class="review-label">í–‰ìœ„ ì£¼ì²´ ì˜µì…˜</div>';
        optionsHtml += '<div class="review-options">';
        options.forEach((opt, i) => {
          optionsHtml += `<div class="option-chip" data-type="actor" data-value="${opt}">A${i + 1}: ${opt}</div>`;
        });
        optionsHtml += '</div></div>';
      }
      
      if (data.status === 'pending-type' || data.status === 'pending-both') {
        const options = [data.teamType.label, ...(data.teamType.options || [])];
        optionsHtml += '<div class="review-section">';
        optionsHtml += '<div class="review-label">íŒ€í”Œ ìœ í˜• ì˜µì…˜</div>';
        optionsHtml += '<div class="review-options">';
        options.forEach((opt, i) => {
          optionsHtml += `<div class="option-chip" data-type="type" data-value="${opt}">B${i + 1}: ${opt}</div>`;
        });
        optionsHtml += '</div></div>';
      }
      
      const html = `
        <div class="review-card" id="current-review-card">
          <div class="review-card-header">
            <div class="review-type-badge ${reviewTypeClass}">${reviewType}</div>
            <div class="review-card-title">${data.title}</div>
          </div>
          <div class="review-card-body">
            <div class="review-section">
              <div class="review-label">ë°œì·Œ</div>
              <div class="review-excerpt">${data.excerpt || data.content?.substring(0, 150) + '...'}</div>
            </div>
            
            ${optionsHtml}
            
            <div class="review-section">
              <div class="review-label">ë¶„ë¥˜ ê·¼ê±°</div>
              <div class="review-content">${data.classificationReason?.actorReason || ''}</div>
              <div class="review-content">${data.classificationReason?.typeReason || ''}</div>
            </div>
          </div>
          <div class="review-card-footer">
            <button class="footer-button option-a" onclick="selectOption('A')">Aì•ˆ</button>
            <button class="footer-button option-b" onclick="selectOption('B')">Bì•ˆ</button>
            <button class="footer-button refresh" onclick="refreshOptions()">
              ğŸ”„
              <div class="refresh-count">${window.refreshCount}/3</div>
            </button>
          </div>
        </div>
      `;
      
      document.getElementById('review-container').innerHTML = html;
    }

    window.selectOption = function(option) {
      // TODO: ì˜µì…˜ ì„ íƒ ë¡œì§
      const card = document.getElementById('current-review-card');
      card.classList.add('slide-out-down');
      
      setTimeout(() => {
        window.reviewIndex++;
        window.refreshCount = 0;
        showReviewCard();
      }, 300);
    };

    window.refreshOptions = function() {
      if (window.refreshCount >= 3) {
        // ì§ì ‘ ìˆ˜ì • ëª¨ë“œë¡œ ì „í™˜
        alert('ì§ì ‘ ìˆ˜ì • ê¸°ëŠ¥ êµ¬í˜„ ì˜ˆì •');
        return;
      }
      
      window.refreshCount++;
      // TODO: AIë¡œ ìƒˆ ì˜µì…˜ ìƒì„±
      showReviewCard();
    };

    // ==================== ë³´ë“œ íƒ­ ====================
    async function loadBoardTab() {
      await loadStats();
      await loadRecentLogs();
    }

    async function loadStats() {
      try {
        const casesRef = collection(db, 'cases');
        const snapshot = await getDocs(casesRef);
        
        let total = 0;
        let pending = 0;
        let approved = 0;
        let rejected = 0;
        
        snapshot.forEach(doc => {
          const data = doc.data();
          total++;
          
          if (data.status === 'auto-approved') {
            approved++;
          } else if (data.status?.startsWith('pending')) {
            pending++;
          } else if (data.status === 'rejected') {
            rejected++;
          }
        });
        
        document.getElementById('stat-total').textContent = total;
        document.getElementById('stat-pending').textContent = pending;
        document.getElementById('stat-approved').textContent = approved;
        document.getElementById('stat-rejected').textContent = rejected;
      } catch (error) {
        console.error('í†µê³„ ë¡œë“œ ì˜¤ë¥˜:', error);
      }
    }

    async function loadRecentLogs() {
      try {
        const logsRef = collection(db, 'logs');
        const q = query(logsRef, orderBy('timestamp', 'desc'), limit(5));
        const snapshot = await getDocs(q);
        
        const container = document.getElementById('recent-logs');
        
        if (snapshot.empty) {
          container.innerHTML = `
            <div class="empty-state">
              <div class="empty-state-text">í™œë™ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</div>
            </div>
          `;
          return;
        }
        
        let html = '<div class="log-list">';
        snapshot.forEach(doc => {
          const data = doc.data();
          html += `
            <div class="log-item ${data.action}">
              <div class="log-header">
                <div class="log-action">${getActionLabel(data.action)}</div>
                <div class="log-time">${formatTime(data.timestamp)}</div>
              </div>
              <div class="log-details">${data.caseTitle || data.details || '-'}</div>
            </div>
          `;
        });
        html += '</div>';
        
        container.innerHTML = html;
      } catch (error) {
        console.error('ë¡œê·¸ ë¡œë“œ ì˜¤ë¥˜:', error);
      }
    }

    window.manualCollect = async function() {
      const btn = document.getElementById('manual-collect-btn');
      const status = document.getElementById('collect-status');
      
      btn.disabled = true;
      status.textContent = 'â³ GitHub Actions ì›Œí¬í”Œë¡œìš° ì‹¤í–‰ ì¤‘...';
      
      // GitHub Actions APIë¡œ ì›Œí¬í”Œë¡œìš° íŠ¸ë¦¬ê±°
      // TODO: ì‹¤ì œ êµ¬í˜„ í•„ìš”
      
      setTimeout(() => {
        btn.disabled = false;
        status.textContent = 'âœ… ìˆ˜ì§‘ ì™„ë£Œ! (ì‹œë®¬ë ˆì´ì…˜)';
        loadBoardTab();
      }, 3000);
    };

    // ==================== í¸ì§‘ íƒ­ ====================
    async function loadEditTab() {
      await loadCategories();
      await loadTypesForMerge();
    }

    async function loadCategories() {
      try {
        const casesRef = collection(db, 'cases');
        const snapshot = await getDocs(casesRef);
        
        // ì¹´í…Œê³ ë¦¬ë³„ í‚¤ì›Œë“œ ìˆ˜ì§‘
        const categories = {};
        snapshot.forEach(doc => {
          const data = doc.data();
          if (data.primaryCategory?.label) {
            const label = data.primaryCategory.label;
            if (!categories[label]) {
              categories[label] = new Set();
            }
            if (data.primaryCategory.keywords) {
              data.primaryCategory.keywords.forEach(k => categories[label].add(k));
            }
          }
        });
        
        const container = document.getElementById('primary-categories');
        let html = '';
        
        Object.entries(categories).forEach(([name, keywordsSet]) => {
          const keywords = Array.from(keywordsSet).join(', ');
          html += `
            <div class="category-item">
              <div class="category-info">
                <div class="category-name">${name}</div>
                <div class="category-keywords">${keywords || 'í‚¤ì›Œë“œ ì—†ìŒ'}</div>
              </div>
              <div class="category-actions">
                <button class="icon-button edit" onclick="editCategory('${name}')">âœï¸</button>
                <button class="icon-button delete" onclick="deleteCategory('${name}')">ğŸ—‘ï¸</button>
              </div>
            </div>
          `;
        });
        
        container.innerHTML = html || '<div class="empty-state"><div class="empty-state-text">ì¹´í…Œê³ ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤</div></div>';
      } catch (error) {
        console.error('ì¹´í…Œê³ ë¦¬ ë¡œë“œ ì˜¤ë¥˜:', error);
      }
    }

    async function loadTypesForMerge() {
      try {
        const casesRef = collection(db, 'cases');
        const snapshot = await getDocs(casesRef);
        
        const types = new Set();
        snapshot.forEach(doc => {
          const data = doc.data();
          if (data.teamType?.label) {
            types.add(data.teamType.label);
          }
        });
        
        const mergeFrom = document.getElementById('merge-from');
        const mergeTo = document.getElementById('merge-to');
        
        let options = '<option value="">ì„ íƒ</option>';
        Array.from(types).sort().forEach(type => {
          options += `<option value="${type}">${type}</option>`;
        });
        
        mergeFrom.innerHTML = options;
        mergeTo.innerHTML = options;
      } catch (error) {
        console.error('ìœ í˜• ë¡œë“œ ì˜¤ë¥˜:', error);
      }
    }

    window.addCategory = function() {
      const name = document.getElementById('new-category-name').value.trim();
      const keywords = document.getElementById('new-category-keywords').value.trim();
      
      if (!name) {
        alert('ì¹´í…Œê³ ë¦¬ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”');
        return;
      }
      
      // TODO: Firestoreì— ì¹´í…Œê³ ë¦¬ ì¶”ê°€
      alert('ì¹´í…Œê³ ë¦¬ ì¶”ê°€ ê¸°ëŠ¥ êµ¬í˜„ ì˜ˆì •');
    };

    window.editCategory = function(name) {
      alert(`ì¹´í…Œê³ ë¦¬ í¸ì§‘: ${name} (êµ¬í˜„ ì˜ˆì •)`);
    };

    window.deleteCategory = function(name) {
      if (confirm(`"${name}" ì¹´í…Œê³ ë¦¬ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
        alert('ì¹´í…Œê³ ë¦¬ ì‚­ì œ ê¸°ëŠ¥ êµ¬í˜„ ì˜ˆì •');
      }
    };

    window.mergeTypes = function() {
      const from = document.getElementById('merge-from').value;
      const to = document.getElementById('merge-to').value;
      
      if (!from || !to) {
        alert('ë³‘í•©í•  ìœ í˜•ê³¼ ëŒ€ìƒ ìœ í˜•ì„ ëª¨ë‘ ì„ íƒí•˜ì„¸ìš”');
        return;
      }
      
      if (from === to) {
        alert('ê°™ì€ ìœ í˜•ì€ ë³‘í•©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
        return;
      }
      
      if (confirm(`"${from}"ì„(ë¥¼) "${to}"(ìœ¼)ë¡œ ë³‘í•©í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`)) {
        alert('ìœ í˜• ë³‘í•© ê¸°ëŠ¥ êµ¬í˜„ ì˜ˆì •');
      }
    };

    // ==================== ë¡œê·¸ íƒ­ ====================
    async function loadLogTab() {
      await loadAllLogs();
    }

    async function loadAllLogs() {
      try {
        const logsRef = collection(db, 'logs');
        const q = query(logsRef, orderBy('timestamp', 'desc'), limit(50));
        const snapshot = await getDocs(q);
        
        const container = document.getElementById('log-list');
        
        if (snapshot.empty) {
          container.innerHTML = `
            <div class="empty-state">
              <div class="empty-state-text">ë¡œê·¸ê°€ ì—†ìŠµë‹ˆë‹¤</div>
            </div>
          `;
          return;
        }
        
        let html = '';
        snapshot.forEach(doc => {
          const data = doc.data();
          
          // í•„í„°ë§
          if (window.currentLogFilter !== 'all' && data.action !== window.currentLogFilter) {
            return;
          }
          
          html += `
            <div class="log-item ${data.action}">
              <div class="log-header">
                <div class="log-action">${getActionLabel(data.action)}</div>
                <div class="log-time">${formatTime(data.timestamp)}</div>
              </div>
              <div class="log-details">${data.caseTitle || data.details || '-'}</div>
            </div>
          `;
        });
        
        container.innerHTML = html || '<div class="empty-state"><div class="empty-state-text">í•„í„° ì¡°ê±´ì— ë§ëŠ” ë¡œê·¸ê°€ ì—†ìŠµë‹ˆë‹¤</div></div>';
      } catch (error) {
        console.error('ë¡œê·¸ ë¡œë“œ ì˜¤ë¥˜:', error);
      }
    }

    window.filterLogs = function(filter) {
      window.currentLogFilter = filter;
      
      // í•„í„° ì¹© í™œì„±í™”
      document.querySelectorAll('.filter-chip').forEach(chip => {
        chip.classList.remove('active');
      });
      event.target.classList.add('active');
      
      loadAllLogs();
    };

    // ==================== ì¼€ì´ìŠ¤ ìƒì„¸ ëª¨ë‹¬ ====================
    window.openCaseModal = async function(caseId) {
      window.currentCaseId = caseId;
      
      try {
        const docRef = doc(db, 'cases', caseId);
        const docSnap = await getDoc(docRef);
        
        if (!docSnap.exists()) {
          alert('ì¼€ì´ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
          return;
        }
        
        const data = docSnap.data();
        
        document.getElementById('modal-title').textContent = data.title;
        document.getElementById('modal-excerpt').textContent = data.excerpt || data.content?.substring(0, 200);
        document.getElementById('modal-actor').innerHTML = `
          <strong>${data.actor?.label || 'ë¯¸ë¶„ë¥˜'}</strong> (ì‹ ë¢°ë„: ${data.actor?.confidence || 0}%)
        `;
        document.getElementById('modal-type').innerHTML = `
          <strong>${data.teamType?.label || 'ë¯¸ë¶„ë¥˜'}</strong> (${data.teamType?.category || '-'}) - ì‹ ë¢°ë„: ${data.teamType?.confidence || 0}%
        `;
        document.getElementById('modal-reason').innerHTML = `
          <p><strong>ì£¼ì²´ íŒë‹¨ ê·¼ê±°:</strong> ${data.classificationReason?.actorReason || '-'}</p>
          <p><strong>ìœ í˜• íŒë‹¨ ê·¼ê±°:</strong> ${data.classificationReason?.typeReason || '-'}</p>
        `;
        document.getElementById('modal-link').href = data.link || '#';
        
        document.getElementById('case-modal').classList.add('active');
      } catch (error) {
        console.error('ì¼€ì´ìŠ¤ ë¡œë“œ ì˜¤ë¥˜:', error);
        alert('ì¼€ì´ìŠ¤ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
      }
    };

    window.closeModal = function() {
      document.getElementById('case-modal').classList.remove('active');
    };

    window.deleteCase = async function() {
      if (!confirm('ì •ë§ ì´ ì¼€ì´ìŠ¤ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
      
      try {
        await deleteDoc(doc(db, 'cases', window.currentCaseId));
        
        // ë¡œê·¸ ì¶”ê°€
        await addDoc(collection(db, 'logs'), {
          action: 'delete',
          caseId: window.currentCaseId,
          timestamp: new Date().toISOString()
        });
        
        closeModal();
        loadDBTab();
        alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
      } catch (error) {
        console.error('ì‚­ì œ ì˜¤ë¥˜:', error);
        alert('ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
      }
    };

    window.moveToReviewFromModal = function() {
      window.currentReviewCase = window.currentCaseId;
      closeModal();
      switchTab('review');
    };

    window.showHistory = function() {
      alert('ìŠ¹ì¸ ê¸°ë¡ ê¸°ëŠ¥ êµ¬í˜„ ì˜ˆì •');
    };

    // ==================== í•„í„° í•¨ìˆ˜ ====================
    window.filterByActor = function(actor) {
      alert(`"${actor}" í•„í„°ë§ ê¸°ëŠ¥ êµ¬í˜„ ì˜ˆì •`);
    };

    window.filterByCategory = function(category) {
      alert(`"${category}" ì¹´í…Œê³ ë¦¬ í•„í„°ë§ ê¸°ëŠ¥ êµ¬í˜„ ì˜ˆì •`);
    };

    window.filterByType = function(type) {
      alert(`"${type}" ìœ í˜• í•„í„°ë§ ê¸°ëŠ¥ êµ¬í˜„ ì˜ˆì •`);
    };

    window.showAllCases = function() {
      alert('ì „ì²´ ì¼€ì´ìŠ¤ ëª©ë¡ (í˜ì´ì§•) ê¸°ëŠ¥ êµ¬í˜„ ì˜ˆì •');
    };

    window.showHotPlayersDetail = function() {
      alert('TOP 20 í•« í”Œë ˆì´ì–´ ê¸°ëŠ¥ êµ¬í˜„ ì˜ˆì •');
    };

    // ==================== ìœ í‹¸ë¦¬í‹° ====================
    function formatDate(dateStr) {
      if (!dateStr) return '';
      const year = dateStr.substring(0, 4);
      const month = dateStr.substring(4, 6);
      const day = dateStr.substring(6, 8);
      return `${year}.${month}.${day}`;
    }

    function formatTime(timestamp) {
      if (!timestamp) return '';
      const date = new Date(timestamp);
      const now = new Date();
      const diff = now - date;
      
      const minutes = Math.floor(diff / 60000);
      const hours = Math.floor(diff / 3600000);
      const days = Math.floor(diff / 86400000);
      
      if (minutes < 1) return 'ë°©ê¸ˆ ì „';
      if (minutes < 60) return `${minutes}ë¶„ ì „`;
      if (hours < 24) return `${hours}ì‹œê°„ ì „`;
      if (days < 7) return `${days}ì¼ ì „`;
      
      return date.toLocaleDateString('ko-KR');
    }

    function getActionLabel(action) {
      const labels = {
        'collection': 'ğŸ“¥ ë°ì´í„° ìˆ˜ì§‘',
        'review': 'âœ… ê²€í†  ì™„ë£Œ',
        'delete': 'ğŸ—‘ï¸ ì‚­ì œ',
        'manual': 'ğŸš€ ìˆ˜ë™ ì‹¤í–‰'
      };
      return labels[action] || action;
    }

    // ==================== ì´ˆê¸°í™” ====================
    window.addEventListener('DOMContentLoaded', () => {
      // ë§ˆì§€ë§‰ íƒ­ ë³µì› ë˜ëŠ” ê¸°ë³¸ íƒ­ (ë³´ë“œ)
      const lastTab = localStorage.getItem('lastTab') || 'board';
      
      // UI ì´ˆê¸°í™”
      document.querySelectorAll('.tab-button').forEach(btn => {
        btn.classList.remove('active');
      });
      document.querySelectorAll('.content').forEach(content => {
        content.classList.remove('active');
      });
      
      // ê¸°ë³¸ íƒ­ í™œì„±í™”
      document.querySelector(`.tab-button.${lastTab === 'board' ? 'board' : ''}`).classList.add('active');
      if (lastTab !== 'board') {
        document.querySelector(`[onclick="switchTab('${lastTab}')"]`).classList.add('active');
      }
      document.getElementById(`${lastTab}-content`).classList.add('active');
      
      // ë³´ë“œ íƒ­ ë¡œë“œ
      loadBoardTab();
    });

    // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
    document.getElementById('case-modal').addEventListener('click', function(e) {
      if (e.target === this) {
        closeModal();
      }
    });
  </script>
</body>
</html>
