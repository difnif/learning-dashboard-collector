<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>íŒ€í”Œ ìœ í˜• í•™ìŠµ ì‹œìŠ¤í…œ</title>
  <style>
    /* ================== ê¸°ë³¸ ë¦¬ì…‹ ================== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    /* ================== ë‹¤í¬ëª¨ë“œ/ë¼ì´íŠ¸ëª¨ë“œ ================== */
    :root {
      /* ë¼ì´íŠ¸ ëª¨ë“œ ìƒ‰ìƒ */
      --bg-primary: #f5f5f5;
      --bg-secondary: #ffffff;
      --text-primary: #222;
      --text-secondary: #666;
      --text-tertiary: #999;
      --border-color: #e0e0e0;
      --card-shadow: rgba(0,0,0,0.05);
      --accent-color: #FF6B35;
    }

    body.dark-mode {
      /* ë‹¤í¬ ëª¨ë“œ ìƒ‰ìƒ */
      --bg-primary: #1a1a1a;
      --bg-secondary: #2d2d2d;
      --text-primary: #e0e0e0;
      --text-secondary: #b0b0b0;
      --text-tertiary: #808080;
      --border-color: #404040;
      --card-shadow: rgba(0,0,0,0.3);
      --accent-color: #FF6B35;
    }

    html, body {
  overflow-x: hidden;
  max-width: 100vw;
  position: relative;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Apple SD Gothic Neo', sans-serif;
  background: var(--bg-primary);
  color: var(--text-primary);
  padding-bottom: 80px;
  transition: background 0.3s, color 0.3s;
  margin: 0;
  width: 100%;
}

    /* ================== í…Œë§ˆ í† ê¸€ ë²„íŠ¼ ================== */
    .theme-toggle {
      position: fixed;
      top: 20px;
      right: 20px;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: var(--bg-secondary);
      border: 2px solid var(--border-color);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      transition: all 0.3s;
      z-index: 1001;
      box-shadow: 0 2px 8px var(--card-shadow);
    }

    .theme-toggle:hover {
      transform: scale(1.1);
      box-shadow: 0 4px 12px var(--card-shadow);
    }

    .theme-toggle:active {
      transform: scale(0.95);
    }

    /* ================== í•˜ë‹¨ íƒ­ ë„¤ë¹„ê²Œì´ì…˜ ================== */
    /* ================== í•˜ë‹¨ íƒ­ ë„¤ë¹„ê²Œì´ì…˜ ================== */
.bottom-nav {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: var(--bg-secondary);
  border-top: 1px solid var(--border-color);
  display: flex;
  justify-content: space-around;
  align-items: flex-end;
  height: 70px;
  z-index: 1000;
  box-shadow: 0 -2px 10px var(--card-shadow);
  width: 100%;
  max-width: 100vw;
}

.tab-button {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 10px;
  background: none;
  border: none;
  cursor: pointer;
  transition: all 0.3s;
  position: relative;
  height: 60px;
}

.tab-button.board {
  height: 80px;
  margin-bottom: 10px;
  background: #FF6B35;
  border-radius: 50%;
  width: 70px;
  box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
}

.tab-button.board .tab-icon {
  margin-bottom: 0;
}

.tab-button.board .tab-label {
  display: none;
}

.tab-button.board.active {
  background: #E85A2B;
  transform: scale(1.05);
}

.tab-icon {
  margin-bottom: 4px;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  justify-content: center;
}

.tab-icon svg {
  transition: all 0.2s;
}

.tab-label {
  font-size: 11px;
  color: var(--text-secondary);
  transition: all 0.2s;
}

.tab-button.active .tab-label {
  color: #FF6B35;
  font-weight: 600;
}

.tab-button.active .tab-icon svg {
  stroke: #FF6B35;
  transform: scale(1.1);
}

.tab-button .tab-icon svg {
  stroke: #666;
}

.tab-button.board .tab-icon svg {
  stroke: white;
}

.tab-button.board .tab-label {
  color: white;
}

/* ë‹¤í¬ëª¨ë“œ ì „ìš© íƒ­ ìŠ¤íƒ€ì¼ */
body.dark-mode .bottom-nav {
  background: var(--bg-secondary);
  border-top: 1px solid var(--border-color);
}

body.dark-mode .tab-button {
  color: var(--text-secondary);
}

body.dark-mode .tab-icon svg {
  stroke: var(--text-secondary);
  opacity: 0.7;
}

body.dark-mode .tab-label {
  color: var(--text-secondary);
}

body.dark-mode .tab-button.active .tab-icon svg {
  stroke: #FF6B35;
  opacity: 1;
}

body.dark-mode .tab-button.active .tab-label {
  color: #FF6B35;
}

body.dark-mode .tab-button.board {
  background: #FF6B35;
  box-shadow: 0 4px 12px rgba(255, 107, 53, 0.4);
}

body.dark-mode .tab-button.board .tab-icon svg {
  stroke: white;
  opacity: 1;
}

body.dark-mode .tab-button.board.active {
  background: #E85A2B;
}
```
    .tab-button {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 10px;
      background: none;
      border: none;
      cursor: pointer;
      transition: all 0.3s;
      position: relative;
      height: 60px;
    }

    .tab-button.board {
      height: 80px;
      margin-bottom: 10px;
      background: #FF6B35;
      border-radius: 50%;
      width: 70px;
      box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
    }

    .tab-button.board .tab-icon {
      font-size: 28px;
    }

    .tab-button.board .tab-label {
      display: none;
    }

    .tab-button.board.active {
      background: #E85A2B;
      transform: scale(1.05);
    }

    .tab-icon {
      font-size: 24px;
      margin-bottom: 4px;
      transition: all 0.2s;
    }

    .tab-label {
      font-size: 11px;
      color: var(--text-secondary);
      transition: all 0.2s;
    }

    .tab-button.active .tab-label {
      color: #FF6B35;
      font-weight: 600;
    }

    .tab-button.active .tab-icon {
      color: #FF6B35;
      transform: scale(1.1);
    }

    .tab-button.board .tab-icon,
    .tab-button.board .tab-label {
      color: white;
    }

    /* ================== ë©”ì¸ ì»¨í…ì¸  ================== */
    .content {
  display: none;
  padding: 20px;
  max-width: 1200px;
  margin: 0 auto;
  animation: fadeIn 0.3s;
  width: 100%;
  box-sizing: border-box;
  overflow-x: hidden;
}

    .content.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .content-header {
      margin-bottom: 24px;
    }

    .content-title {
      font-size: 28px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 8px;
    }

    .content-subtitle {
      font-size: 14px;
      color: var(--text-secondary);
    }

    /* ================== ê³µí†µ ì»´í¬ë„ŒíŠ¸ ================== */
    .section {
      background: var(--bg-secondary);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px var(--card-shadow);
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .section-title {
      font-size: 18px;
      font-weight: 700;
      color: var(--text-primary);
    }

    .more-button {
      background: none;
      border: none;
      color: #FF6B35;
      font-size: 14px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 4px;
      font-weight: 600;
    }

    .more-button:hover {
      text-decoration: underline;
    }

    /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .btn-primary {
      background: #FF6B35;
      color: white;
    }

    .btn-primary:hover {
      background: #E85A2B;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
    }

    .btn-secondary {
      background: #f0f0f0;
      color: #666;
    }

    .btn-secondary:hover {
      background: #e0e0e0;
    }

    .btn-danger {
      background: #FFEBEE;
      color: #C62828;
    }

    .btn-danger:hover {
      background: #FFCDD2;
    }

    /* ================== Toast ì•Œë¦¼ ================== */
    .toast {
      position: fixed;
      bottom: 100px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--bg-secondary);
      color: var(--text-primary);
      padding: 16px 24px;
      border-radius: 8px;
      box-shadow: 0 4px 16px var(--card-shadow);
      z-index: 2001;
      animation: slideUp 0.3s;
    }

    .toast.error {
      background: #C62828;
      color: white;
    }

    .toast.success {
      background: #2E7D32;
      color: white;
    }

    @keyframes slideUp {
      from { opacity: 0; transform: translate(-50%, 20px); }
      to { opacity: 1; transform: translate(-50%, 0); }
    }

    /* ================== DB íƒ­ ìŠ¤íƒ€ì¼ ================== */
    .case-card {
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 12px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .case-card:hover {
      border-color: #FF6B35;
      box-shadow: 0 2px 8px rgba(255, 107, 53, 0.1);
      transform: translateY(-2px);
    }

    .case-title {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 8px;
      line-height: 1.4;
    }

    .case-meta {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .meta-badge {
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 500;
    }

    .meta-badge.actor {
      background: #FFF3E0;
      color: #F57C00;
    }

    .meta-badge.type {
      background: #E8F5E9;
      color: #2E7D32;
    }

    .meta-badge.source {
      background: #E3F2FD;
      color: #1565C0;
    }

    .meta-badge.date {
      background: #F3E5F5;
      color: #7B1FA2;
    }

    /* ë‹¤í¬ëª¨ë“œìš© ë°°ì§€ */
    body.dark-mode .meta-badge.actor {
      background: rgba(245, 124, 0, 0.2);
      color: #FFB74D;
    }

    body.dark-mode .meta-badge.type {
      background: rgba(46, 125, 50, 0.2);
      color: #81C784;
    }

    body.dark-mode .meta-badge.source {
      background: rgba(21, 101, 192, 0.2);
      color: #64B5F6;
    }

    body.dark-mode .meta-badge.date {
      background: rgba(123, 31, 162, 0.2);
      color: #BA68C8;
    }

    /* í•« í”Œë ˆì´ì–´ */
    .hot-player-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .hot-player-item {
      display: flex;
      align-items: center;
      padding: 12px;
      background: var(--bg-primary);
      border-radius: 8px;
      transition: all 0.2s;
    }

    .hot-player-item:hover {
      background: #FFF3E0;
      cursor: pointer;
      transform: translateX(4px);
    }

    body.dark-mode .hot-player-item:hover {
      background: rgba(245, 124, 0, 0.2);
    }

    .hot-player-rank {
      font-size: 18px;
      font-weight: 700;
      color: #FF6B35;
      width: 40px;
      text-align: center;
    }

    .hot-player-name {
      flex: 1;
      font-size: 15px;
      font-weight: 600;
      color: var(--text-primary);
    }

    .hot-player-count {
      font-size: 14px;
      color: var(--text-secondary);
      background: var(--bg-secondary);
      padding: 4px 12px;
      border-radius: 12px;
    }

    /* í† í”½ ê·¸ë¦¬ë“œ */
    .topic-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 12px;
    }

    .topic-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      border-radius: 12px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
    }

    .topic-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 16px rgba(0,0,0,0.2);
    }

    .topic-card.hot {
      background: linear-gradient(135deg, #FF6B35 0%, #F7931E 100%);
      box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
    }

    .topic-name {
      font-size: 16px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .topic-count {
      font-size: 12px;
      opacity: 0.9;
    }

    /* ìœ í˜• í´ë¼ìš°ë“œ */
    .type-cloud {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
      gap: 12px;
      padding: 20px;
      min-height: 200px;
    }

    .type-bubble {
      padding: 12px 24px;
      border-radius: 24px;
      background: var(--bg-secondary);
      border: 2px solid #FF6B35;
      color: #FF6B35;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      white-space: nowrap;
    }

    .type-bubble:hover {
      background: #FF6B35;
      color: white;
      transform: scale(1.1);
    }

    .type-bubble.size-1 { font-size: 12px; }
    .type-bubble.size-2 { font-size: 14px; }
    .type-bubble.size-3 { font-size: 16px; }
    .type-bubble.size-4 { font-size: 18px; }
    .type-bubble.size-5 { font-size: 22px; font-weight: 700; }

    /* ê²€ìƒ‰ì°½ */
    .search-bar {
      display: flex;
      gap: 8px;
      margin-bottom: 20px;
    }

    .search-select {
      padding: 10px 16px;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      font-size: 14px;
      background: var(--bg-secondary);
      color: var(--text-primary);
      cursor: pointer;
    }

    .search-input {
      flex: 1;
      padding: 10px 16px;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      font-size: 14px;
      background: var(--bg-secondary);
      color: var(--text-primary);
    }

    .search-button {
      padding: 10px 24px;
      background: #FF6B35;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
    }

/* ================== ê²€í†  íƒ­ ìŠ¤íƒ€ì¼ ================== */
.review-container {
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: calc(100vh - 250px);
  padding: 20px;
  position: relative;
  perspective: 1000px;
}

.review-card {
  background: var(--bg-secondary);
  border-radius: 20px;
  box-shadow: 0 10px 40px var(--card-shadow);
  max-width: 500px;
  width: 100%;
  overflow: visible;
  position: absolute;
  transition: none;
  cursor: grab;
  user-select: none;
  touch-action: pan-y;
}

.review-card:active {
  cursor: grabbing;
}

.review-card.dragging {
  transition: none !important;
}

.review-card.swiping-left {
  border: 3px solid #C62828;
  box-shadow: 0 10px 40px rgba(198, 40, 40, 0.4);
}

.review-card.swiping-right {
  border: 3px solid #FF6B35;
  box-shadow: 0 10px 40px rgba(255, 107, 53, 0.4);
}

.review-card.swipe-out-left {
  animation: swipeOutLeft 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards;
}

.review-card.swipe-out-right {
  animation: swipeOutRight 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards;
}

@keyframes swipeOutLeft {
  to { 
    transform: translateX(-150%) rotate(-30deg); 
    opacity: 0; 
  }
}

@keyframes swipeOutRight {
  to { 
    transform: translateX(150%) rotate(30deg); 
    opacity: 0; 
  }
}

.review-card.reset {
  animation: resetCard 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes resetCard {
  0% { transform: translateX(var(--drag-x)) rotate(var(--drag-rotate)); }
  100% { transform: translateX(0) rotate(0); }
}

.review-card-header {
  padding: 24px 24px 16px 24px;
  border-bottom: 2px solid var(--border-color);
}

.review-type-badge {
  display: inline-block;
  padding: 6px 12px;
  border-radius: 16px;
  font-size: 12px;
  font-weight: 600;
  margin-bottom: 12px;
}

.review-type-badge.actor {
  background: #FFF3E0;
  color: #F57C00;
  border: 2px solid #F57C00;
}

.review-type-badge.type {
  background: #E8F5E9;
  color: #2E7D32;
  border: 2px solid #2E7D32;
}

.review-type-badge.both {
  background: #E3F2FD;
  color: #1565C0;
  border: 2px solid #1565C0;
}

.review-card-title {
  font-size: 18px;
  font-weight: 700;
  color: var(--text-primary);
  line-height: 1.5;
  margin-bottom: 0;
}

.review-card-body {
  padding: 20px 24px;
  max-height: 300px;
  overflow: hidden;
  position: relative;
  transition: max-height 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.review-card-body.expanded {
  max-height: 600px;
  overflow-y: auto;
}

.review-card-body.expanded::after {
  display: none;
}

.review-card-body::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 60px;
  background: linear-gradient(to bottom, transparent, var(--bg-secondary));
  pointer-events: none;
}

.review-section {
  margin-bottom: 16px;
}

.review-label {
  font-size: 11px;
  font-weight: 700;
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 8px;
}

.review-content {
  font-size: 14px;
  line-height: 1.6;
  color: var(--text-primary);
  background: var(--bg-primary);
  padding: 12px;
  border-radius: 8px;
  margin-bottom: 8px;
}

.review-excerpt {
  background: #FFF9F5;
  border-left: 4px solid #FF6B35;
  padding: 12px;
  font-size: 14px;
  line-height: 1.6;
  margin: 12px 0;
  color: var(--text-primary);
  border-radius: 4px;
}

body.dark-mode .review-excerpt {
  background: rgba(255, 107, 53, 0.1);
}

.review-options {
  display: flex;
  gap: 8px;
  margin-top: 12px;
  flex-wrap: wrap;
}

.option-chip {
  padding: 8px 16px;
  background: var(--bg-primary);
  border: 2px solid transparent;
  border-radius: 20px;
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
}

.option-chip:hover {
  border-color: #FF6B35;
  background: #FFF3E0;
}

body.dark-mode .option-chip:hover {
  background: rgba(255, 107, 53, 0.2);
}

.expand-button {
  width: 100%;
  padding: 12px;
  margin-top: 12px;
  background: var(--bg-primary);
  border: 2px solid var(--border-color);
  border-radius: 8px;
  color: var(--text-primary);
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
}

.expand-button:hover {
  background: var(--border-color);
}

.expand-button svg {
  transition: transform 0.3s;
}

.expand-button.expanded svg {
  transform: rotate(180deg);
}

.review-card-footer {
  padding: 16px 24px 24px 24px;
  background: var(--bg-primary);
  display: flex;
  gap: 12px;
  border-top: 2px solid var(--border-color);
}

.footer-button {
  flex: 1;
  padding: 14px;
  border: none;
  border-radius: 12px;
  font-size: 14px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
}

.footer-button.option-a {
  background: #E3F2FD;
  color: #1565C0;
}

.footer-button.option-a:hover {
  background: #BBDEFB;
}

.footer-button.option-b {
  background: #F3E5F5;
  color: #7B1FA2;
}

.footer-button.option-b:hover {
  background: #E1BEE7;
}

.footer-button.refresh {
  background: #FFF3E0;
  color: #F57C00;
  flex: 0.7;
}

.footer-button.refresh:hover {
  background: #FFE0B2;
}

.footer-button:active {
  transform: scale(0.95);
}

.refresh-count {
  font-size: 11px;
  opacity: 0.7;
  margin-top: 2px;
}

/* ìŠ¤ì™€ì´í”„ ê°€ì´ë“œ */
.swipe-guide {
  position: fixed;
  bottom: 90px;
  left: 50%;
  transform: translateX(-50%);
  background: var(--bg-secondary);
  padding: 16px 24px;
  border-radius: 12px;
  box-shadow: 0 4px 16px var(--card-shadow);
  z-index: 999;
  animation: fadeIn 0.3s;
}

@media (max-width: 768px) {
  .review-container {
    min-height: calc(100vh - 200px);
    padding: 12px;
  }

  .review-card {
    max-width: 100%;
  }

  .review-card-header {
    padding: 20px 16px 12px 16px;
  }

  .review-card-body {
    padding: 16px;
    max-height: 250px;
  }

  .review-card-body.expanded {
    max-height: 500px;
  }

  .review-card-footer {
    padding: 12px 16px 20px 16px;
    flex-wrap: wrap;
  }

  .footer-button {
    font-size: 13px;
    padding: 12px;
  }

  .footer-button.refresh {
    flex: 1;
  }
}

    /* ================== ë³´ë“œ íƒ­ ìŠ¤íƒ€ì¼ ================== */
    .manual-collect-section {
      background: linear-gradient(135deg, #FF6B35 0%, #F7931E 100%);
      border-radius: 12px;
      padding: 24px;
      text-align: center;
      margin-bottom: 24px;
      color: white;
      box-shadow: 0 4px 16px rgba(255, 107, 53, 0.3);
    }

    .manual-collect-title {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 12px;
    }

    .manual-collect-button {
      background: white;
      color: #FF6B35;
      padding: 14px 32px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .manual-collect-button:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 16px rgba(255,255,255,0.3);
    }

    .manual-collect-button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-bottom: 24px;
    }

    .stat-card {
      background: var(--bg-secondary);
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 8px var(--card-shadow);
      text-align: center;
    }

    .stat-value {
      font-size: 36px;
      font-weight: 700;
      color: #FF6B35;
      margin-bottom: 8px;
    }

    .stat-label {
      font-size: 14px;
      color: var(--text-secondary);
      font-weight: 600;
    }

    /* ================== í¸ì§‘ íƒ­ ìŠ¤íƒ€ì¼ ================== */
/* ================== í¸ì§‘ íƒ­ ìŠ¤íƒ€ì¼ ================== */
/* ìœ í˜• ë³‘í•© ì»¨í…Œì´ë„ˆ */
.edit-section > div[style*="display: flex"] {
  display: flex;
  gap: 8px;
  margin-bottom: 12px;
  flex-wrap: wrap;
}

.edit-section .search-select {
  flex: 1;
  min-width: 0;
  box-sizing: border-box;
}

.edit-section .btn-primary {
  flex-shrink: 0;
  white-space: nowrap;
}

.edit-section .section-title {
  font-size: 18px;
  font-weight: 700;
  color: var(--text-primary);
  margin-bottom: 12px;
}

.category-list {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.category-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px;
  background: var(--bg-primary);
  border-radius: 8px;
  transition: all 0.2s;
}

.category-item:hover {
  background: var(--border-color);
}

.category-info {
  flex: 1;
}

.category-name {
  font-size: 16px;
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: 4px;
}

.category-keywords {
  font-size: 13px;
  color: var(--text-secondary);
}

.category-actions {
  display: flex;
  gap: 8px;
}

.icon-button {
  width: 36px;
  height: 36px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;
  font-size: 16px;
}

.icon-button.edit {
  background: #E3F2FD;
  color: #1565C0;
}

.icon-button.delete {
  background: #FFEBEE;
  color: #C62828;
}

.icon-button:hover {
  transform: scale(1.1);
}

.add-category-form {
  display: flex;
  gap: 8px;
  margin-top: 12px;
  flex-wrap: wrap;
}

.add-category-input {
  flex: 1;
  min-width: 0;
  padding: 12px;
  border: 1px solid var(--border-color);
  border-radius: 8px;
  font-size: 14px;
  background: var(--bg-secondary);
  color: var(--text-primary);
  box-sizing: border-box;
}

.add-category-form .btn {
  flex-shrink: 0;
  white-space: nowrap;
}

    /* ================== ë¡œê·¸ íƒ­ ìŠ¤íƒ€ì¼ ================== */
    .log-filters {
      display: flex;
      gap: 8px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .filter-chip {
      padding: 8px 16px;
      background: var(--bg-primary);
      border: 2px solid transparent;
      border-radius: 20px;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .filter-chip.active {
      background: #FF6B35;
      color: white;
      border-color: #FF6B35;
    }

    .log-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .log-item {
      background: var(--bg-secondary);
      padding: 16px;
      border-radius: 8px;
      border-left: 4px solid var(--border-color);
      box-shadow: 0 2px 4px var(--card-shadow);
    }

    .log-item.collection {
      border-left-color: #4CAF50;
    }

    .log-item.review {
      border-left-color: #FF6B35;
    }

    .log-item.delete {
      border-left-color: #F44336;
    }

    .log-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .log-action {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
    }

    .log-time {
      font-size: 12px;
      color: var(--text-tertiary);
    }

    .log-details {
      font-size: 13px;
      color: var(--text-secondary);
      line-height: 1.5;
    }

    /* ================== ëª¨ë‹¬ ================== */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      z-index: 2000;
      padding: 20px;
      overflow-y: auto;
    }

    .modal.active {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-content {
      background: var(--bg-secondary);
      border-radius: 12px;
      padding: 24px;
      max-width: 800px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      animation: modalSlideIn 0.3s;
    }

    @keyframes modalSlideIn {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 16px;
      border-bottom: 2px solid var(--border-color);
    }

    .modal-title {
      font-size: 20px;
      font-weight: 700;
      color: var(--text-primary);
    }

    .modal-close {
      background: none;
      border: none;
      font-size: 28px;
      color: var(--text-tertiary);
      cursor: pointer;
      padding: 0;
      width: 32px;
      height: 32px;
      line-height: 1;
    }

    .modal-close:hover {
      color: var(--text-secondary);
    }

    .modal-section {
      margin-bottom: 24px;
    }

    .modal-section-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-secondary);
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .modal-section-content {
      font-size: 15px;
      line-height: 1.6;
      color: var(--text-primary);
    }

    .modal-excerpt {
      background: #FFF9F5;
      border-left: 4px solid #FF6B35;
      padding: 16px;
      border-radius: 4px;
      font-style: italic;
      margin: 12px 0;
      color: var(--text-primary);
    }

    body.dark-mode .modal-excerpt {
      background: rgba(255, 107, 53, 0.1);
    }

    .modal-actions {
      display: flex;
      gap: 8px;
      margin-top: 20px;
    }

    .action-button {
      flex: 1;
      padding: 12px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .action-button.delete {
      background: #FFEBEE;
      color: #C62828;
    }

    .action-button.delete:hover {
      background: #FFCDD2;
    }

    .action-button.review {
      background: #FFF3E0;
      color: #F57C00;
    }

    .action-button.review:hover {
      background: #FFE0B2;
    }

    .action-button.history {
      background: #E3F2FD;
      color: #1565C0;
    }

    .action-button.history:hover {
      background: #BBDEFB;
    }

    .external-link {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      color: #FF6B35;
      text-decoration: none;
      font-weight: 600;
      margin-top: 8px;
    }

    .external-link:hover {
      text-decoration: underline;
    }

    /* ================== ìœ í‹¸ë¦¬í‹° ================== */
    .loading {
      text-align: center;
      padding: 40px;
      color: var(--text-tertiary);
    }

    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 4px solid var(--border-color);
      border-top-color: #FF6B35;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 16px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-tertiary);
    }

    .empty-state-icon {
      font-size: 48px;
      margin-bottom: 16px;
      opacity: 0.5;
    }

    .empty-state-text {
      font-size: 16px;
    }

    /* ================== ë°˜ì‘í˜• ================== */
  @media (max-width: 768px) {
  .content {
    padding: 12px;
    width: 100%;
    overflow-x: hidden;
  }

  .content-title {
    font-size: 24px;
  }

  /* í¸ì§‘ íƒ­ ëª¨ë°”ì¼ ìµœì í™” */
  .edit-section {
    padding: 12px;
    margin-bottom: 12px;
    width: 100%;
    box-sizing: border-box;
  }

  .category-item {
    padding: 10px;
  }

  .category-name {
    font-size: 15px;
  }

  .category-keywords {
    font-size: 12px;
  }

  .icon-button {
    width: 32px;
    height: 32px;
    font-size: 14px;
  }

  /* ì¹´í…Œê³ ë¦¬ ì¶”ê°€ í¼ - ì„¸ë¡œ ë°°ì¹˜ */
  .add-category-form {
    flex-direction: column;
    gap: 8px;
    width: 100%;
  }

  .add-category-input {
    width: 100%;
    flex: none;
    min-width: auto;
  }

  .add-category-form .btn {
    width: 100%;
  }

  /* ìœ í˜• ë³‘í•© - ì„¸ë¡œ ë°°ì¹˜ */
  .edit-section > div[style*="display: flex"] {
    flex-direction: column;
    gap: 8px;
  }

  .edit-section > div[style*="display: flex"] > span {
    display: none; /* í™”ì‚´í‘œ ìˆ¨ê¹€ */
  }

  .edit-section .search-select {
    width: 100%;
    flex: none;
  }

  .edit-section .btn-primary {
    width: 100%;
  }

  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }

  .topic-grid {
    grid-template-columns: repeat(2, 1fr);
  }

  .review-card {
    max-width: 100%;
  }

  .theme-toggle {
    top: 15px;
    right: 15px;
    width: 45px;
    height: 45px;
    font-size: 20px;
  }
}

@media (max-width: 480px) {
  .content {
    padding: 8px;
  }

  .stats-grid {
    grid-template-columns: 1fr;
  }

  .modal-content {
    padding: 16px;
    margin: 10px;
  }

  .review-options {
    flex-direction: column;
  }

  .option-chip {
    width: 100%;
  }

  /* í¸ì§‘ íƒ­ ì´ˆì†Œí˜• ëª¨ë°”ì¼ */
  .edit-section {
    padding: 8px;
  }

  .category-item {
    padding: 8px;
  }
}
  </style>
</head>
<body>

  <!-- í…Œë§ˆ í† ê¸€ ë²„íŠ¼ -->
  <button class="theme-toggle" onclick="toggleTheme()" aria-label="í…Œë§ˆ ë³€ê²½">
    <span id="theme-icon">â˜€ï¸</span>
  </button>

  <!-- DB íƒ­ ì»¨í…ì¸  -->
  <div id="db-content" class="content">
    <div class="content-header">
      <h1 class="content-title">ğŸ“š ë°ì´í„°ë² ì´ìŠ¤</h1>
      <p class="content-subtitle">ìˆ˜ì§‘ëœ íŒ€í”Œë ˆì´ ì¼€ì´ìŠ¤ ì•„ì¹´ì´ë¸Œ</p>
    </div>

    <!-- ì „ì²´ ì„¹ì…˜ -->
    <div class="section">
      <div class="section-header">
        <h2 class="section-title">ğŸ—‚ï¸ ì „ì²´</h2>
        <button class="more-button" onclick="showAllCases()">
          ì „ì²´ë³´ê¸° â†’
        </button>
      </div>
      <div id="recent-cases">
        <div class="loading">
          <div class="loading-spinner"></div>
          <div>ë°ì´í„° ë¡œë”© ì¤‘...</div>
        </div>
      </div>
    </div>

    <!-- í•« í”Œë ˆì´ì–´ ì„¹ì…˜ -->
    <div class="section">
      <div class="section-header">
        <h2 class="section-title">ğŸ”¥ í•« í”Œë ˆì´ì–´ (ìµœê·¼ 1ì£¼ì¼)</h2>
        <button class="more-button" onclick="showHotPlayersDetail()">
          TOP 20 ë³´ê¸° â†’
        </button>
      </div>
      <div id="hot-players">
        <div class="loading">
          <div class="loading-spinner"></div>
          <div>ë¶„ì„ ì¤‘...</div>
        </div>
      </div>
    </div>

    <!-- í† í”½ë³„ ì„¹ì…˜ -->
    <div class="section">
      <div class="section-header">
        <h2 class="section-title">ğŸ·ï¸ í† í”½ë³„</h2>
      </div>
      <div id="topics" class="topic-grid">
        <div class="loading">
          <div class="loading-spinner"></div>
          <div>ì¹´í…Œê³ ë¦¬ ë¡œë”© ì¤‘...</div>
        </div>
      </div>
    </div>

    <!-- ìœ í˜•ë³„ ì„¹ì…˜ -->
    <div class="section">
      <div class="section-header">
        <h2 class="section-title">â­ ìœ í˜•ë³„</h2>
      </div>
      <div id="types" class="type-cloud">
        <div class="loading">
          <div class="loading-spinner"></div>
          <div>ìœ í˜• ë¶„ì„ ì¤‘...</div>
        </div>
      </div>
    </div>
  </div>

 <!-- ê²€í†  íƒ­ ì»¨í…ì¸  -->
<div id="review-content" class="content">
  <div class="content-header">
    <h1 class="content-title">âœ… ê²€í† </h1>
    <p class="content-subtitle">ë¶„ë¥˜ ê²€í† ê°€ í•„ìš”í•œ ì¼€ì´ìŠ¤ <span id="review-count"></span></p>
  </div>

  <div id="review-container" class="review-container">
    <div class="loading">
      <div class="loading-spinner"></div>
      <div>ê²€í†  ì¼€ì´ìŠ¤ ë¡œë”© ì¤‘...</div>
    </div>
  </div>
  
  <!-- ìŠ¤ì™€ì´í”„ ê°€ì´ë“œ -->
  <div id="swipe-guide" class="swipe-guide" style="display: none;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
      <div style="text-align: left;">
        <div style="font-size: 24px; margin-bottom: 4px;">ğŸ‘ˆ</div>
        <div style="font-size: 12px; font-weight: 600;">ì‚­ì œ</div>
      </div>
      <div style="text-align: center; color: var(--text-secondary);">
        <div style="font-size: 14px;">â† ìŠ¤ì™€ì´í”„ â†’</div>
      </div>
      <div style="text-align: right;">
        <div style="font-size: 24px; margin-bottom: 4px;">ğŸ‘‰</div>
        <div style="font-size: 12px; font-weight: 600;">ë³´ë¥˜</div>
      </div>
    </div>
  </div>
</div>

  <!-- ë³´ë“œ íƒ­ ì»¨í…ì¸  -->
  <div id="board-content" class="content active">
    <div class="content-header">
      <h1 class="content-title">ğŸ“Š ëŒ€ì‹œë³´ë“œ</h1>
      <p class="content-subtitle">ìˆ˜ì§‘ í˜„í™© í•œëˆˆì— ë³´ê¸°</p>
    </div>

    <!-- ìˆ˜ë™ ìˆ˜ì§‘ ì„¹ì…˜ -->
    <div class="manual-collect-section">
      <div class="manual-collect-title">ğŸš€ ë°ì´í„° ìˆ˜ì§‘ ì‹¤í–‰</div>
      <button id="manual-collect-btn" class="manual-collect-button" onclick="manualCollect()">
        <span>â–¶ï¸</span>
        <span>ìˆ˜ë™ ìˆ˜ì§‘ ì‹œì‘</span>
      </button>
      <div id="collect-status" style="margin-top: 12px; font-size: 13px;"></div>
    </div>

    <!-- í†µê³„ ì¹´ë“œ -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-value" id="stat-total">-</div>
        <div class="stat-label">ì´ ìˆ˜ì§‘</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="stat-pending">-</div>
        <div class="stat-label">ê²€í†  ëŒ€ê¸°</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="stat-approved">-</div>
        <div class="stat-label">ìŠ¹ì¸</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="stat-rejected">-</div>
        <div class="stat-label">ê±°ì ˆ</div>
      </div>
    </div>

    <!-- ìµœê·¼ í™œë™ -->
    <div class="section">
      <div class="section-header">
        <h2 class="section-title">ğŸ“‹ ìµœê·¼ í™œë™</h2>
      </div>
      <div id="recent-logs">
        <div class="loading">
          <div class="loading-spinner"></div>
          <div>ë¡œê·¸ ë¡œë”© ì¤‘...</div>
        </div>
      </div>
    </div>
  </div>

  <!-- í¸ì§‘ íƒ­ ì»¨í…ì¸  -->
  <div id="edit-content" class="content">
    <div class="content-header">
      <h1 class="content-title">âš™ï¸ í¸ì§‘</h1>
      <p class="content-subtitle">ì¹´í…Œê³ ë¦¬ ë° ìœ í˜• ê´€ë¦¬</p>
    </div>

    <!-- ì¹´í…Œê³ ë¦¬ ê´€ë¦¬ -->
    <div class="edit-section">
      <h2 class="section-title">ğŸ·ï¸ 1ì°¨ ì¹´í…Œê³ ë¦¬ ê´€ë¦¬</h2>
      <div id="primary-categories" class="category-list">
        <div class="loading">
          <div class="loading-spinner"></div>
          <div>ì¹´í…Œê³ ë¦¬ ë¡œë”© ì¤‘...</div>
        </div>
      </div>
      <div class="add-category-form">
        <input type="text" id="new-category-name" class="add-category-input" placeholder="ìƒˆ ì¹´í…Œê³ ë¦¬ ì´ë¦„">
        <input type="text" id="new-category-keywords" class="add-category-input" placeholder="í‚¤ì›Œë“œ (ì‰¼í‘œë¡œ êµ¬ë¶„)">
        <button class="btn btn-primary" onclick="addCategory()">ì¶”ê°€</button>
      </div>
    </div>

    <!-- ìœ í˜• ë³‘í•© -->
    <div class="edit-section">
      <h2 class="section-title">â­ ìœ í˜• ë³‘í•©</h2>
      <div style="display: flex; gap: 12px; margin-bottom: 16px;">
        <select id="merge-from" class="search-select" style="flex: 1;">
          <option value="">ë³‘í•©í•  ìœ í˜• ì„ íƒ</option>
        </select>
        <span style="display: flex; align-items: center;">â†’</span>
        <select id="merge-to" class="search-select" style="flex: 1;">
          <option value="">ë³‘í•© ëŒ€ìƒ ìœ í˜•</option>
        </select>
        <button class="btn btn-primary" onclick="mergeTypes()">ë³‘í•©</button>
      </div>
      <p style="font-size: 13px; color: var(--text-secondary);">â€» ë³‘í•©í•˜ë©´ ëª¨ë“  ì¼€ì´ìŠ¤ì˜ ìœ í˜•ì´ ë³€ê²½ë˜ë©°, ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
    </div>

    <!-- 2ì°¨ ì¹´í…Œê³ ë¦¬ ìŠ¹ê²© ì œì•ˆ -->
    <div class="edit-section">
      <h2 class="section-title">ğŸ“ˆ 2ì°¨ â†’ 1ì°¨ ìŠ¹ê²© ì œì•ˆ</h2>
      <div id="promotion-suggestions">
        <div class="empty-state">
          <div class="empty-state-text">ìŠ¹ê²© ì œì•ˆ ê¸°ëŠ¥ ì¤€ë¹„ ì¤‘...</div>
        </div>
      </div>
    </div>
  </div>

  <!-- ë¡œê·¸ íƒ­ ì»¨í…ì¸  -->
  <div id="log-content" class="content">
    <div class="content-header">
      <h1 class="content-title">ğŸ“‹ ë¡œê·¸</h1>
      <p class="content-subtitle">í™œë™ ê¸°ë¡</p>
      <div style="margin-top: 16px; display: flex; gap: 8px; flex-wrap: wrap;">
      <button class="btn btn-danger" onclick="testAIDataSave()">
        ğŸ§ª AI ë°ì´í„° ì €ì¥ í…ŒìŠ¤íŠ¸
      </button>
      <button class="btn btn-secondary" onclick="exportAITrainingData()">
        ğŸ’¾ AI í•™ìŠµ ë°ì´í„° ë‚´ë³´ë‚´ê¸°
      </button>
     </div>
    </div>

    <!-- í•„í„° -->
    <div class="log-filters">
      <div class="filter-chip active" data-filter="all" onclick="filterLogs('all', event)">ì „ì²´</div>
      <div class="filter-chip" data-filter="collection" onclick="filterLogs('collection', event)">ìˆ˜ì§‘</div>
      <div class="filter-chip" data-filter="review" onclick="filterLogs('review', event)">ê²€í† </div>
      <div class="filter-chip" data-filter="delete" onclick="filterLogs('delete', event)">ì‚­ì œ</div>
      <div class="filter-chip" data-filter="manual" onclick="filterLogs('manual', event)">ìˆ˜ë™ ì‹¤í–‰</div>
    </div>

    <!-- ë¡œê·¸ ë¦¬ìŠ¤íŠ¸ -->
    <div id="log-list" class="log-list">
      <div class="loading">
        <div class="loading-spinner"></div>
        <div>ë¡œê·¸ ë¡œë”© ì¤‘...</div>
      </div>
    </div>
  </div>

  <!-- ì¼€ì´ìŠ¤ ìƒì„¸ ëª¨ë‹¬ -->
  <div id="case-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="modal-title">ì¼€ì´ìŠ¤ ìƒì„¸</h3>
        <button class="modal-close" onclick="closeModal()">Ã—</button>
      </div>

      <div class="modal-section">
        <div class="modal-section-title">ë°œì·Œ ë‚´ìš©</div>
        <div class="modal-excerpt" id="modal-excerpt"></div>
      </div>

      <div class="modal-section">
        <div class="modal-section-title">í–‰ìœ„ ì£¼ì²´</div>
        <div class="modal-section-content" id="modal-actor"></div>
      </div>

      <div class="modal-section">
        <div class="modal-section-title">íŒ€í”Œë ˆì´ ìœ í˜•</div>
        <div class="modal-section-content" id="modal-type"></div>
      </div>

      <div class="modal-section">
        <div class="modal-section-title">ë¶„ë¥˜ ê·¼ê±°</div>
        <div class="modal-section-content" id="modal-reason"></div>
      </div>

      <div class="modal-section">
        <div class="modal-section-title">ì›ë¬¸ ë§í¬</div>
        <a id="modal-link" class="external-link" href="#" target="_blank">
          ì›ë¬¸ ë³´ê¸° â†’
        </a>
      </div>

      <div class="modal-actions">
        <button class="action-button delete" onclick="deleteCase()">
          ğŸ—‘ï¸ ì‚­ì œ
        </button>
        <button class="action-button review" onclick="moveToReviewFromModal()">
          âœï¸ ê²€í† ë¡œ ì´ë™
        </button>
        <button class="action-button history" onclick="showHistory()">
          ğŸ“„ ìŠ¹ì¸ ê¸°ë¡
        </button>
      </div>
    </div>
  </div>

  <!-- í•˜ë‹¨ íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
  <nav class="bottom-nav" role="navigation">
    <button class="tab-button" onclick="switchTab('db', event)" aria-label="ë°ì´í„°ë² ì´ìŠ¤ íƒ­" role="tab">
      <div class="tab-icon" aria-hidden="true">ğŸ“š</div>
      <div class="tab-label">DB</div>
    </button>
    <button class="tab-button" onclick="switchTab('review', event)" aria-label="ê²€í†  íƒ­" role="tab">
      <div class="tab-icon" aria-hidden="true">âœ…</div>
      <div class="tab-label">ê²€í† </div>
    </button>
    <button class="tab-button board active" onclick="switchTab('board', event)" aria-label="ëŒ€ì‹œë³´ë“œ íƒ­" role="tab" aria-selected="true">
      <div class="tab-icon" aria-hidden="true">ğŸ“Š</div>
    </button>
    <button class="tab-button" onclick="switchTab('edit', event)" aria-label="í¸ì§‘ íƒ­" role="tab">
      <div class="tab-icon" aria-hidden="true">âš™ï¸</div>
      <div class="tab-label">í¸ì§‘</div>
    </button>
    <button class="tab-button" onclick="switchTab('log', event)" aria-label="ë¡œê·¸ íƒ­" role="tab">
      <div class="tab-icon" aria-hidden="true">ğŸ“‹</div>
      <div class="tab-label">ë¡œê·¸</div>
    </button>
  </nav>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getFirestore, collection, query, orderBy, limit, getDocs, where, doc, getDoc, updateDoc, deleteDoc, addDoc, Timestamp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

    // Firebase ì„¤ì • - ì—¬ê¸°ì— ìƒˆë¡œ ë°œê¸‰ë°›ì€ í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”
const firebaseConfig = {
  apiKey: "AIzaSyAmv5MlHGbzrZBw8lsMxt4vXYTwcetRcxI",
  authDomain: "tpt-learning-49601.firebaseapp.com",
  projectId: "tpt-learning-49601",
  storageBucket: "tpt-learning-49601.firebasestorage.app",
  messagingSenderId: "602423446232",
  appId: "1:602423446232:web:3bfc2783050a35c97225ad"
};

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // ==================== ì „ì—­ ë³€ìˆ˜ ====================
    window.db = db;
    window.currentCaseId = null;
    window.currentReviewCase = null;
    window.reviewQueue = [];
    window.reviewIndex = 0;
    window.refreshCount = 0;
    window.currentLogFilter = 'all';

    // ìºì‹œ ê°ì²´
    const dataCache = {
      cases: { data: null, timestamp: null, docs: [] },
      logs: { data: null, timestamp: null, docs: [] },
      maxAge: 5 * 60 * 1000 // 5ë¶„
    };

    // ==================== ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ====================
    
    // Toast ì•Œë¦¼ í‘œì‹œ
    function showToast(message, type = 'info') {
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.textContent = message;
      document.body.appendChild(toast);
      
      setTimeout(() => {
        toast.style.opacity = '0';
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }

    // ì—ëŸ¬ ì²˜ë¦¬
    function handleError(message, error) {
      console.error(message, error);
      showToast(message, 'error');
    }

    // ìºì‹œëœ ì¼€ì´ìŠ¤ ê°€ì ¸ì˜¤ê¸°
    async function getCachedCases() {
      const now = Date.now();
      if (dataCache.cases.data && (now - dataCache.cases.timestamp) < dataCache.maxAge) {
        return dataCache.cases.docs;
      }
      
      try {
        const casesRef = collection(db, 'cases');
        const snapshot = await getDocs(casesRef);
        
        dataCache.cases = {
          data: snapshot,
          timestamp: now,
          docs: snapshot.docs
        };
        
        return snapshot.docs;
      } catch (error) {
        handleError('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤', error);
        return [];
      }
    }

    // ìºì‹œ ë¬´íš¨í™”
    function invalidateCache() {
      dataCache.cases.data = null;
      dataCache.logs.data = null;
    }

    function formatDate(dateStr) {
      if (!dateStr) return '';
      const year = dateStr.substring(0, 4);
      const month = dateStr.substring(4, 6);
      const day = dateStr.substring(6, 8);
      return `${year}.${month}.${day}`;
    }

    function formatTime(timestamp) {
      if (!timestamp) return '';
      const date = new Date(timestamp);
      const now = new Date();
      const diff = now - date;
      
      const minutes = Math.floor(diff / 60000);
      const hours = Math.floor(diff / 3600000);
      const days = Math.floor(diff / 86400000);
      
      if (minutes < 1) return 'ë°©ê¸ˆ ì „';
      if (minutes < 60) return `${minutes}ë¶„ ì „`;
      if (hours < 24) return `${hours}ì‹œê°„ ì „`;
      if (days < 7) return `${days}ì¼ ì „`;
      
      return date.toLocaleDateString('ko-KR');
    }

    function getActionLabel(action) {
      const labels = {
        'collection': 'ğŸ“¥ ë°ì´í„° ìˆ˜ì§‘',
        'review': 'âœ… ê²€í†  ì™„ë£Œ',
        'delete': 'ğŸ—‘ï¸ ì‚­ì œ',
        'manual': 'ğŸš€ ìˆ˜ë™ ì‹¤í–‰'
      };
      return labels[action] || action;
    }

    // ==================== íƒ­ ì „í™˜ ====================
    window.switchTab = function(tabName, event) {
      // ëª¨ë“  íƒ­ ë²„íŠ¼ ë¹„í™œì„±í™”
      document.querySelectorAll('.tab-button').forEach(btn => {
        btn.classList.remove('active');
        btn.setAttribute('aria-selected', 'false');
      });
      
      // ëª¨ë“  ì»¨í…ì¸  ìˆ¨ê¸°ê¸°
      document.querySelectorAll('.content').forEach(content => {
        content.classList.remove('active');
      });
      
      // ì„ íƒëœ íƒ­ í™œì„±í™”
      if (event) {
        const targetButton = event.target.closest('.tab-button');
        if (targetButton) {
          targetButton.classList.add('active');
          targetButton.setAttribute('aria-selected', 'true');
        }
      } else {
        // eventê°€ ì—†ëŠ” ê²½ìš° (ì´ˆê¸°í™” ì‹œ)
        const targetButton = document.querySelector(`[onclick*="switchTab('${tabName}',"]`);
        if (targetButton) {
          targetButton.classList.add('active');
          targetButton.setAttribute('aria-selected', 'true');
        }
      }
      
      document.getElementById(`${tabName}-content`).classList.add('active');

      // íƒ­ë³„ ë¡œë“œ í•¨ìˆ˜ ì‹¤í–‰
      if (tabName === 'db') {
        loadDBTab();
      } else if (tabName === 'review') {
        loadReviewTab();
      } else if (tabName === 'board') {
        loadBoardTab();
      } else if (tabName === 'edit') {
        loadEditTab();
      } else if (tabName === 'log') {
        loadLogTab();
      }

      // ë§ˆì§€ë§‰ íƒ­ ì €ì¥
      localStorage.setItem('lastTab', tabName);
    };

    // ==================== DB íƒ­ ====================
    async function loadDBTab() {
      await Promise.all([
        loadRecentCases(),
        loadHotPlayers(),
        loadTopics(),
        loadTypes()
      ]);
    }

    async function loadRecentCases() {
      try {
        const casesRef = collection(db, 'cases');
        const q = query(casesRef, orderBy('collectedAt', 'desc'), limit(5));
        const snapshot = await getDocs(q);
        
        const container = document.getElementById('recent-cases');
        
        if (snapshot.empty) {
          container.innerHTML = `
            <div class="empty-state">
              <div class="empty-state-icon">ğŸ“­</div>
              <div class="empty-state-text">ì•„ì§ ìˆ˜ì§‘ëœ ì¼€ì´ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤</div>
            </div>
          `;
          return;
        }
        
        let html = '';
        snapshot.forEach(doc => {
          const data = doc.data();
          html += `
            <div class="case-card" onclick="openCaseModal('${doc.id}')">
              <div class="case-title">${data.title || 'ì œëª© ì—†ìŒ'}</div>
              <div class="case-meta">
                <span class="meta-badge actor">${data.actor?.label || 'ë¯¸ë¶„ë¥˜'}</span>
                <span class="meta-badge type">${data.teamType?.label || 'ë¯¸ë¶„ë¥˜'}</span>
                <span class="meta-badge source">${data.source === 'blog' ? 'ë¸”ë¡œê·¸' : 'ë‰´ìŠ¤'}</span>
                <span class="meta-badge date">${formatDate(data.postDate)}</span>
              </div>
            </div>
          `;
        });
        
        container.innerHTML = html;
      } catch (error) {
        handleError('ì¼€ì´ìŠ¤ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤', error);
        document.getElementById('recent-cases').innerHTML = `
          <div class="empty-state">
            <div class="empty-state-text">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</div>
          </div>
        `;
      }
    }

    async function loadHotPlayers() {
      try {
        const docs = await getCachedCases();
        const oneWeekAgo = new Date();
        oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
        
        // í–‰ìœ„ ì£¼ì²´ ë¹ˆë„ ê³„ì‚° (ìµœê·¼ 1ì£¼ì¼)
        const actorCount = {};
        docs.forEach(doc => {
          const data = doc.data();
          const collectedDate = data.collectedAt ? new Date(data.collectedAt) : null;
          if (collectedDate && collectedDate >= oneWeekAgo && data.actor?.label) {
            const actor = data.actor.label;
            actorCount[actor] = (actorCount[actor] || 0) + 1;
          }
        });
        
        // ìƒìœ„ 5ê°œ
        const sorted = Object.entries(actorCount)
          .sort((a, b) => b[1] - a[1])
          .slice(0, 5);
        
        const container = document.getElementById('hot-players');
        
        if (sorted.length === 0) {
          container.innerHTML = `
            <div class="empty-state">
              <div class="empty-state-text">ì•„ì§ ë°ì´í„°ê°€ ì¶©ë¶„í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤</div>
            </div>
          `;
          return;
        }
        
        let html = '<div class="hot-player-list">';
        sorted.forEach(([actor, count], index) => {
          html += `
            <div class="hot-player-item" onclick="filterByActor('${actor}')">
              <div class="hot-player-rank">${index + 1}</div>
              <div class="hot-player-name">${actor}</div>
              <div class="hot-player-count">${count}ê±´</div>
            </div>
          `;
        });
        html += '</div>';
        
        container.innerHTML = html;
      } catch (error) {
        handleError('í•« í”Œë ˆì´ì–´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤', error);
      }
    }

    async function loadTopics() {
      try {
        const docs = await getCachedCases();
        
        // ì¹´í…Œê³ ë¦¬ ë¹ˆë„ ê³„ì‚°
        const categoryCount = {};
        docs.forEach(doc => {
          const data = doc.data();
          if (data.primaryCategory?.label) {
            const category = data.primaryCategory.label;
            categoryCount[category] = (categoryCount[category] || 0) + 1;
          }
        });
        
        // ë¹ˆë„ìˆœ ì •ë ¬
        const sorted = Object.entries(categoryCount)
          .sort((a, b) => b[1] - a[1]);
        
        const container = document.getElementById('topics');
        
        if (sorted.length === 0) {
          container.innerHTML = `
            <div class="empty-state">
              <div class="empty-state-text">ì¹´í…Œê³ ë¦¬ ë°ì´í„° ì—†ìŒ</div>
            </div>
          `;
          return;
        }
        
        let html = '';
        sorted.forEach(([category, count], index) => {
          const isHot = index < 4;
          html += `
            <div class="topic-card ${isHot ? 'hot' : ''}" onclick="filterByCategory('${category}')">
              <div class="topic-name">${category}</div>
              <div class="topic-count">${count}ê±´</div>
            </div>
          `;
        });
        
        container.innerHTML = html;
      } catch (error) {
        handleError('í† í”½ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤', error);
      }
    }

    async function loadTypes() {
      try {
        const docs = await getCachedCases();
        
        // ìœ í˜• ë¹ˆë„ ê³„ì‚°
        const typeCount = {};
        docs.forEach(doc => {
          const data = doc.data();
          if (data.teamType?.label) {
            const type = data.teamType.label;
            typeCount[type] = (typeCount[type] || 0) + 1;
          }
        });
        
        // ë¹ˆë„ìˆœ ì •ë ¬
        const sorted = Object.entries(typeCount)
          .sort((a, b) => b[1] - a[1]);
        
        const container = document.getElementById('types');
        
        if (sorted.length === 0) {
          container.innerHTML = `
            <div class="empty-state">
              <div class="empty-state-text">ìœ í˜• ë°ì´í„° ì—†ìŒ</div>
            </div>
          `;
          return;
        }
        
        // í¬ê¸° ê²°ì •
        const maxCount = sorted[0][1];
        let html = '';
        sorted.forEach(([type, count]) => {
          const size = Math.min(Math.ceil((count / maxCount) * 5), 5);
          html += `
            <div class="type-bubble size-${size}" onclick="filterByType('${type}')">${type}</div>
          `;
        });
        
        container.innerHTML = html;
      } catch (error) {
        handleError('ìœ í˜•ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤', error);
      }
    }

    // ==================== ê²€í†  íƒ­ ====================
    async function loadReviewTab() {
      try {
        const casesRef = collection(db, 'cases');
        const q = query(casesRef, where('status', 'in', ['pending-actor', 'pending-type', 'pending-both']));
        const snapshot = await getDocs(q);
        
        window.reviewQueue = [];
        snapshot.forEach(doc => {
          window.reviewQueue.push({ id: doc.id, data: doc.data() });
        });
        
        document.getElementById('review-count').textContent = `(${window.reviewQueue.length}ê±´)`;
        
        if (window.reviewQueue.length === 0) {
          document.getElementById('review-container').innerHTML = `
            <div class="empty-state">
              <div class="empty-state-icon">âœ…</div>
              <div class="empty-state-text">ê²€í† í•  ì¼€ì´ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤!</div>
            </div>
          `;
          document.getElementById('swipe-guide').style.display = 'none';
          return;
        }
        
        window.reviewIndex = 0;
        window.refreshCount = 0;
        window.reviewStartTime = Date.now();
        showReviewCard();
        
        // ìŠ¤ì™€ì´í”„ ê°€ì´ë“œ í‘œì‹œ
        document.getElementById('swipe-guide').style.display = 'block';
      } catch (error) {
        handleError('ê²€í†  ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤', error);
      }
    }

    function showReviewCard() {
      if (window.reviewIndex >= window.reviewQueue.length) {
        document.getElementById('review-container').innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">ğŸ‰</div>
            <div class="empty-state-text">ëª¨ë“  ê²€í†  ì™„ë£Œ!</div>
          </div>
        `;
        document.getElementById('swipe-guide').style.display = 'none';
        return;
      }
      
      const current = window.reviewQueue[window.reviewIndex];
      const data = current.data;
      
      let reviewType = '';
      let reviewTypeClass = '';
      if (data.status === 'pending-actor') {
        reviewType = 'í–‰ìœ„ ì£¼ì²´ ê²€í† ';
        reviewTypeClass = 'actor';
      } else if (data.status === 'pending-type') {
        reviewType = 'íŒ€í”Œ ìœ í˜• ê²€í† ';
        reviewTypeClass = 'type';
      } else {
        reviewType = 'ì£¼ì²´ & ìœ í˜• ê²€í† ';
        reviewTypeClass = 'both';
      }
      
      let optionsHtml = '';
      if (data.status === 'pending-actor' || data.status === 'pending-both') {
        const options = [data.actor?.label || 'ë¯¸ë¶„ë¥˜', ...(data.actor?.options || [])];
        optionsHtml += '<div class="review-section">';
        optionsHtml += '<div class="review-label">í–‰ìœ„ ì£¼ì²´ ì˜µì…˜</div>';
        optionsHtml += '<div class="review-options">';
        options.forEach((opt, i) => {
          optionsHtml += `<div class="option-chip">A${i + 1}: ${opt}</div>`;
        });
        optionsHtml += '</div></div>';
      }
      
      if (data.status === 'pending-type' || data.status === 'pending-both') {
        const options = [data.teamType?.label || 'ë¯¸ë¶„ë¥˜', ...(data.teamType?.options || [])];
        optionsHtml += '<div class="review-section">';
        optionsHtml += '<div class="review-label">íŒ€í”Œ ìœ í˜• ì˜µì…˜</div>';
        optionsHtml += '<div class="review-options">';
        options.forEach((opt, i) => {
          optionsHtml += `<div class="option-chip">B${i + 1}: ${opt}</div>`;
        });
        optionsHtml += '</div></div>';
      }
      
      const html = `
        <div class="review-card" id="current-review-card">
          <div class="review-card-header">
            <div class="review-type-badge ${reviewTypeClass}">${reviewType}</div>
            <div class="review-card-title">${data.title || 'ì œëª© ì—†ìŒ'}</div>
          </div>
          <div class="review-card-body" id="review-card-body">
            <div class="review-section">
              <div class="review-label">ë°œì·Œ</div>
              <div class="review-excerpt">${data.excerpt || data.content?.substring(0, 150) + '...' || 'ë‚´ìš© ì—†ìŒ'}</div>
            </div>
            
            ${optionsHtml}
            
            <div class="review-section">
              <div class="review-label">ë¶„ë¥˜ ê·¼ê±°</div>
              ${data.classificationReason?.actorReason ? `<div class="review-content">${data.classificationReason.actorReason}</div>` : ''}
              ${data.classificationReason?.typeReason ? `<div class="review-content">${data.classificationReason.typeReason}</div>` : ''}
            </div>
            
            <button class="expand-button" onclick="toggleExpand()">
              <span id="expand-text">ë”ë³´ê¸°</span>
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="6 9 12 15 18 9"></polyline>
              </svg>
            </button>
          </div>
          <div class="review-card-footer">
            <button class="footer-button option-a" onclick="selectOption('A')">Aì•ˆ</button>
            <button class="footer-button option-b" onclick="selectOption('B')">Bì•ˆ</button>
            <button class="footer-button refresh" onclick="refreshOptions()">
              ğŸ”„
              <div class="refresh-count">${window.refreshCount}/3</div>
            </button>
          </div>
        </div>
      `;
      
      document.getElementById('review-container').innerHTML = html;
      
      // ìŠ¤ì™€ì´í”„ ì´ë²¤íŠ¸ ë“±ë¡
      setTimeout(() => {
        initSwipe();
      }, 100);
    }
    
    // ë”ë³´ê¸°/ì ‘ê¸° í† ê¸€
    window.toggleExpand = function() {
      const body = document.getElementById('review-card-body');
      const button = event.currentTarget;
      const text = document.getElementById('expand-text');
      
      if (body.classList.contains('expanded')) {
        body.classList.remove('expanded');
        button.classList.remove('expanded');
        text.textContent = 'ë”ë³´ê¸°';
      } else {
        body.classList.add('expanded');
        button.classList.add('expanded');
        text.textContent = 'ì ‘ê¸°';
      }
    };
    
    // ìŠ¤ì™€ì´í”„ ì´ˆê¸°í™”
    function initSwipe() {
      const card = document.getElementById('current-review-card');
      if (!card) return;
      
      let startX = 0;
      let startY = 0;
      let currentX = 0;
      let currentY = 0;
      let isDragging = false;
      
      const onStart = (e) => {
        const touch = e.type.includes('touch') ? e.touches[0] : e;
        startX = touch.clientX;
        startY = touch.clientY;
        isDragging = true;
        card.classList.add('dragging');
      };
      
      const onMove = (e) => {
        if (!isDragging) return;
        
        e.preventDefault();
        const touch = e.type.includes('touch') ? e.touches[0] : e;
        currentX = touch.clientX - startX;
        currentY = touch.clientY - startY;
        
        // ì¢Œìš° ì´ë™ë§Œ í—ˆìš© (ì„¸ë¡œ ìŠ¤í¬ë¡¤ ë°©ì§€)
        if (Math.abs(currentX) > Math.abs(currentY)) {
          const rotation = currentX / 20;
          card.style.transform = `translateX(${currentX}px) rotate(${rotation}deg)`;
          card.style.setProperty('--drag-x', `${currentX}px`);
          card.style.setProperty('--drag-rotate', `${rotation}deg`);
          
          // ìŠ¤ì™€ì´í”„ ë°©í–¥ í‘œì‹œ
          if (currentX < -50) {
            card.classList.add('swiping-left');
            card.classList.remove('swiping-right');
          } else if (currentX > 50) {
            card.classList.add('swiping-right');
            card.classList.remove('swiping-left');
          } else {
            card.classList.remove('swiping-left', 'swiping-right');
          }
        }
      };
      
      const onEnd = () => {
        if (!isDragging) return;
        isDragging = false;
        card.classList.remove('dragging', 'swiping-left', 'swiping-right');
        
        // ìŠ¤ì™€ì´í”„ íŒì •
        if (currentX < -100) {
          // ì¢Œì¸¡ ìŠ¤ì™€ì´í”„: ì‚­ì œ
          swipeLeft();
        } else if (currentX > 100) {
          // ìš°ì¸¡ ìŠ¤ì™€ì´í”„: ë³´ë¥˜ (ë§¨ ë’¤ë¡œ)
          swipeRight();
        } else {
          // ì›ìœ„ì¹˜
          card.classList.add('reset');
          card.style.transform = '';
          setTimeout(() => card.classList.remove('reset'), 300);
        }
        
        currentX = 0;
        currentY = 0;
      };
      
      // í„°ì¹˜ ì´ë²¤íŠ¸
      card.addEventListener('touchstart', onStart, { passive: true });
      card.addEventListener('touchmove', onMove, { passive: false });
      card.addEventListener('touchend', onEnd);
      
      // ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸ (PCìš©)
      card.addEventListener('mousedown', onStart);
      document.addEventListener('mousemove', onMove);
      document.addEventListener('mouseup', onEnd);
    }
    
    // ì¢Œì¸¡ ìŠ¤ì™€ì´í”„: ì‚­ì œ
    async function swipeLeft() {
      const card = document.getElementById('current-review-card');
      card.classList.add('swipe-out-left');
      
      showToast('ì¼€ì´ìŠ¤ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
      
      const current = window.reviewQueue[window.reviewIndex];
      
      try {
        // AI í•™ìŠµ ë°ì´í„° ì €ì¥ (ë¶€ì • ìƒ˜í”Œ)
        if (window.saveAITrainingData) {
          await saveAITrainingData('case_rejected', {
            caseId: current.id,
            caseInfo: {
              title: current.data.title,
              content: current.data.content,
              excerpt: current.data.excerpt
            },
            rejectionMethod: 'swipe_left',
            rejectedAt: new Date().toISOString()
          });
        }
        
        // Firestoreì—ì„œ ì‚­ì œ
        await deleteDoc(doc(db, 'cases', current.id));
      } catch (error) {
        console.error('ì‚­ì œ ì‹¤íŒ¨:', error);
      }
      
      setTimeout(() => {
        window.reviewIndex++;
        window.refreshCount = 0;
        window.reviewStartTime = Date.now();
        showReviewCard();
      }, 400);
    }
    
    // ìš°ì¸¡ ìŠ¤ì™€ì´í”„: ë³´ë¥˜ (ë§¨ ë’¤ë¡œ)
    function swipeRight() {
      const card = document.getElementById('current-review-card');
      card.classList.add('swipe-out-right');
      
      showToast('ë³´ë¥˜ë˜ì—ˆìŠµë‹ˆë‹¤ (ë§¨ ë’¤ë¡œ ì´ë™)', 'info');
      
      const current = window.reviewQueue[window.reviewIndex];
      window.reviewQueue.push(current);  // ë§¨ ë’¤ì— ì¶”ê°€
      
      setTimeout(() => {
        window.reviewIndex++;
        window.refreshCount = 0;
        window.reviewStartTime = Date.now();
        showReviewCard();
      }, 400);
    }

    window.selectOption = async function(option) {
      const card = document.getElementById('current-review-card');
      if (!card) return;
      
      card.style.transform = 'scale(0.9)';
      card.style.opacity = '0';
      card.style.transition = 'all 0.3s';
      
      const current = window.reviewQueue[window.reviewIndex];
      if (!current) return;
      
      const startTime = window.reviewStartTime || Date.now();
      const timeSpent = (Date.now() - startTime) / 1000;

    try {
      await addDoc(collection(db, 'logs'), {
        action: 'review',
        caseId: current.id,
        caseTitle: current.data.title || 'ì œëª© ì—†ìŒ',
        optionSelected: option,
        status: current.data.status,
        timestamp: new Date().toISOString(),
        details: `${option}ì•ˆ ì„ íƒ (${current.data.status})`
      });
      console.log('âœ… ê²€í†  ë¡œê·¸ ì €ì¥ ì™„ë£Œ');
    } catch (error) {
      console.error('âŒ ê²€í†  ë¡œê·¸ ì €ì¥ ì‹¤íŒ¨:', error);
    }
      
      // AI í•™ìŠµ ë°ì´í„° ì €ì¥
      if (window.saveAITrainingData) {
        await saveAITrainingData('review', {
          caseId: current.id,
          caseInfo: {
            title: current.data.title || '',
            content: current.data.content || '',
            excerpt: current.data.excerpt || '',
            source: current.data.source || ''
          },
          originalPrediction: {
            actor: current.data.actor || {},
            teamType: current.data.teamType || {},
            primaryCategory: current.data.primaryCategory || {}
          },
          humanReview: {
            optionSelected: option,
            refreshCount: window.refreshCount || 0,
            timeSpent: timeSpent,
            reviewedAt: new Date().toISOString()
          },
          reasoning: current.data.classificationReason || {},
          status: current.data.status || ''
        });
      }
      
      showToast(`${option}ì•ˆì´ ì„ íƒë˜ì—ˆìŠµë‹ˆë‹¤`, 'success');
      
      setTimeout(() => {
        window.reviewIndex++;
        window.refreshCount = 0;
        window.reviewStartTime = Date.now();
        showReviewCard();
      }, 300);
    };

    window.refreshOptions = function() {
      if (window.refreshCount >= 3) {
        showToast('ì§ì ‘ ìˆ˜ì • ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤', 'info');
        return;
      }
      
      window.refreshCount++;
      showToast('ìƒˆ ì˜µì…˜ì„ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤...', 'info');
      showReviewCard();
    };

    // ==================== ë³´ë“œ íƒ­ ====================
    async function loadBoardTab() {
      await Promise.all([
        loadStats(),
        loadRecentLogs()
      ]);
    }

    async function loadStats() {
      try {
        const docs = await getCachedCases();
        
        let total = 0;
        let pending = 0;
        let approved = 0;
        let rejected = 0;
        
        docs.forEach(doc => {
          const data = doc.data();
          total++;
          
          if (data.status === 'auto-approved') {
            approved++;
          } else if (data.status?.startsWith('pending')) {
            pending++;
          } else if (data.status === 'rejected') {
            rejected++;
          }
        });
        
        document.getElementById('stat-total').textContent = total;
        document.getElementById('stat-pending').textContent = pending;
        document.getElementById('stat-approved').textContent = approved;
        document.getElementById('stat-rejected').textContent = rejected;
      } catch (error) {
        handleError('í†µê³„ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤', error);
      }
    }

    async function loadRecentLogs() {
      try {
        const logsRef = collection(db, 'logs');
        const q = query(logsRef, orderBy('timestamp', 'desc'), limit(5));
        const snapshot = await getDocs(q);
        
        const container = document.getElementById('recent-logs');
        
        if (snapshot.empty) {
          container.innerHTML = `
            <div class="empty-state">
              <div class="empty-state-text">í™œë™ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</div>
            </div>
          `;
          return;
        }
        
        let html = '<div class="log-list">';
        snapshot.forEach(doc => {
          const data = doc.data();
          html += `
            <div class="log-item ${data.action}">
              <div class="log-header">
                <div class="log-action">${getActionLabel(data.action)}</div>
                <div class="log-time">${formatTime(data.timestamp)}</div>
              </div>
              <div class="log-details">${data.caseTitle || data.details || '-'}</div>
            </div>
          `;
        });
        html += '</div>';
        
        container.innerHTML = html;
      } catch (error) {
        handleError('ë¡œê·¸ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤', error);
      }
    }

    window.manualCollect = async function() {
      const btn = document.getElementById('manual-collect-btn');
      const status = document.getElementById('collect-status');
      
      btn.disabled = true;
      status.textContent = 'â³ GitHub Actions ì›Œí¬í”Œë¡œìš° ì‹¤í–‰ ì¤‘...';
      
      // GitHub Actions APIë¡œ ì›Œí¬í”Œë¡œìš° íŠ¸ë¦¬ê±°
      // TODO: ì‹¤ì œ êµ¬í˜„ í•„ìš”
      
      setTimeout(() => {
        btn.disabled = false;
        status.textContent = 'âœ… ìˆ˜ì§‘ ì™„ë£Œ! (ì‹œë®¬ë ˆì´ì…˜)';
        showToast('ë°ì´í„° ìˆ˜ì§‘ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
        invalidateCache();
        loadBoardTab();
      }, 3000);
    };

    // ==================== í¸ì§‘ íƒ­ ====================
    async function loadEditTab() {
      await Promise.all([
        loadCategories(),
        loadTypesForMerge()
      ]);
    }

    async function loadCategories() {
      try {
        const docs = await getCachedCases();
        
        // ì¹´í…Œê³ ë¦¬ë³„ í‚¤ì›Œë“œ ìˆ˜ì§‘
        const categories = {};
        docs.forEach(doc => {
          const data = doc.data();
          if (data.primaryCategory?.label) {
            const label = data.primaryCategory.label;
            if (!categories[label]) {
              categories[label] = new Set();
            }
            if (data.primaryCategory.keywords) {
              data.primaryCategory.keywords.forEach(k => categories[label].add(k));
            }
          }
        });
        
        const container = document.getElementById('primary-categories');
        let html = '';
        
        Object.entries(categories).forEach(([name, keywordsSet]) => {
          const keywords = Array.from(keywordsSet).join(', ');
          html += `
            <div class="category-item">
              <div class="category-info">
                <div class="category-name">${name}</div>
                <div class="category-keywords">${keywords || 'í‚¤ì›Œë“œ ì—†ìŒ'}</div>
              </div>
              <div class="category-actions">
                <button class="icon-button edit" onclick="editCategory('${name}')">âœï¸</button>
                <button class="icon-button delete" onclick="deleteCategory('${name}')">ğŸ—‘ï¸</button>
              </div>
            </div>
          `;
        });
        
        container.innerHTML = html || '<div class="empty-state"><div class="empty-state-text">ì¹´í…Œê³ ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤</div></div>';
      } catch (error) {
        handleError('ì¹´í…Œê³ ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤', error);
      }
    }

    async function loadTypesForMerge() {
      try {
        const docs = await getCachedCases();
        
        const types = new Set();
        docs.forEach(doc => {
          const data = doc.data();
          if (data.teamType?.label) {
            types.add(data.teamType.label);
          }
        });
        
        const mergeFrom = document.getElementById('merge-from');
        const mergeTo = document.getElementById('merge-to');
        
        let options = '<option value="">ì„ íƒ</option>';
        Array.from(types).sort().forEach(type => {
          options += `<option value="${type}">${type}</option>`;
        });
        
        mergeFrom.innerHTML = options;
        mergeTo.innerHTML = options;
      } catch (error) {
        handleError('ìœ í˜• ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤', error);
      }
    }

    window.addCategory = function() {
      const name = document.getElementById('new-category-name').value.trim();
      const keywords = document.getElementById('new-category-keywords').value.trim();
      
      if (!name) {
        showToast('ì¹´í…Œê³ ë¦¬ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”', 'error');
        return;
      }
      
      // TODO: Firestoreì— ì¹´í…Œê³ ë¦¬ ì¶”ê°€
      showToast('ì¹´í…Œê³ ë¦¬ ì¶”ê°€ ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤', 'info');
    };

    window.editCategory = function(name) {
      showToast(`ì¹´í…Œê³ ë¦¬ í¸ì§‘: ${name} (ì¤€ë¹„ ì¤‘)`, 'info');
    };

    window.deleteCategory = function(name) {
      if (confirm(`"${name}" ì¹´í…Œê³ ë¦¬ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
        // TODO: ì‹¤ì œ ì‚­ì œ ë¡œì§
        showToast('ì¹´í…Œê³ ë¦¬ ì‚­ì œ ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤', 'info');
      }
    };

    window.mergeTypes = function() {
      const from = document.getElementById('merge-from').value;
      const to = document.getElementById('merge-to').value;
      
      if (!from || !to) {
        showToast('ë³‘í•©í•  ìœ í˜•ê³¼ ëŒ€ìƒ ìœ í˜•ì„ ëª¨ë‘ ì„ íƒí•˜ì„¸ìš”', 'error');
        return;
      }
      
      if (from === to) {
        showToast('ê°™ì€ ìœ í˜•ì€ ë³‘í•©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤', 'error');
        return;
      }
      
      if (confirm(`"${from}"ì„(ë¥¼) "${to}"(ìœ¼)ë¡œ ë³‘í•©í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`)) {
        // TODO: ì‹¤ì œ ë³‘í•© ë¡œì§
        showToast('ìœ í˜• ë³‘í•© ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤', 'info');
      }
    };

    // ==================== ë¡œê·¸ íƒ­ ====================
    async function loadLogTab() {
      await loadAllLogs();
    }

    async function loadAllLogs() {
      try {
        const logsRef = collection(db, 'logs');
        const q = query(logsRef, orderBy('timestamp', 'desc'), limit(50));
        const snapshot = await getDocs(q);
        
        const container = document.getElementById('log-list');
        
        if (snapshot.empty) {
          container.innerHTML = `
            <div class="empty-state">
              <div class="empty-state-text">ë¡œê·¸ê°€ ì—†ìŠµë‹ˆë‹¤</div>
            </div>
          `;
          return;
        }
        
        let html = '';
        snapshot.forEach(doc => {
          const data = doc.data();
          
          // í•„í„°ë§
          if (window.currentLogFilter !== 'all' && data.action !== window.currentLogFilter) {
            return;
          }
          
          html += `
            <div class="log-item ${data.action}">
              <div class="log-header">
                <div class="log-action">${getActionLabel(data.action)}</div>
                <div class="log-time">${formatTime(data.timestamp)}</div>
              </div>
              <div class="log-details">${data.caseTitle || data.details || '-'}</div>
            </div>
          `;
        });
        
        container.innerHTML = html || '<div class="empty-state"><div class="empty-state-text">í•„í„° ì¡°ê±´ì— ë§ëŠ” ë¡œê·¸ê°€ ì—†ìŠµë‹ˆë‹¤</div></div>';
      } catch (error) {
        handleError('ë¡œê·¸ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤', error);
      }
    }

    window.filterLogs = function(filter, event) {
      window.currentLogFilter = filter;
      
      // í•„í„° ì¹© í™œì„±í™”
      document.querySelectorAll('.filter-chip').forEach(chip => {
        chip.classList.remove('active');
      });
      if (event) {
        event.target.classList.add('active');
      }
      
      loadAllLogs();
    };

    // ==================== ì¼€ì´ìŠ¤ ìƒì„¸ ëª¨ë‹¬ ====================
    window.openCaseModal = async function(caseId) {
      window.currentCaseId = caseId;
      
      try {
        const docRef = doc(db, 'cases', caseId);
        const docSnap = await getDoc(docRef);
        
        if (!docSnap.exists()) {
          showToast('ì¼€ì´ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤', 'error');
          return;
        }
        
        const data = docSnap.data();
        
        document.getElementById('modal-title').textContent = data.title || 'ì œëª© ì—†ìŒ';
        document.getElementById('modal-excerpt').textContent = data.excerpt || data.content?.substring(0, 200) || 'ë‚´ìš© ì—†ìŒ';
        document.getElementById('modal-actor').innerHTML = `
          <strong>${data.actor?.label || 'ë¯¸ë¶„ë¥˜'}</strong> (ì‹ ë¢°ë„: ${data.actor?.confidence || 0}%)
        `;
        document.getElementById('modal-type').innerHTML = `
          <strong>${data.teamType?.label || 'ë¯¸ë¶„ë¥˜'}</strong> (${data.teamType?.category || '-'}) - ì‹ ë¢°ë„: ${data.teamType?.confidence || 0}%
        `;
        document.getElementById('modal-reason').innerHTML = `
          <p><strong>ì£¼ì²´ íŒë‹¨ ê·¼ê±°:</strong> ${data.classificationReason?.actorReason || '-'}</p>
          <p><strong>ìœ í˜• íŒë‹¨ ê·¼ê±°:</strong> ${data.classificationReason?.typeReason || '-'}</p>
        `;
        document.getElementById('modal-link').href = data.link || '#';
        
        document.getElementById('case-modal').classList.add('active');
      } catch (error) {
        handleError('ì¼€ì´ìŠ¤ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤', error);
      }
    };

    window.closeModal = function() {
      document.getElementById('case-modal').classList.remove('active');
    };

    window.deleteCase = async function() {
      if (!confirm('ì •ë§ ì´ ì¼€ì´ìŠ¤ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
      
      try {
        await deleteDoc(doc(db, 'cases', window.currentCaseId));
        
        // ë¡œê·¸ ì¶”ê°€
        await addDoc(collection(db, 'logs'), {
          action: 'delete',
          caseId: window.currentCaseId,
          timestamp: new Date().toISOString()
        });
        
        invalidateCache();
        closeModal();
        loadDBTab();
        showToast('ì¼€ì´ìŠ¤ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
      } catch (error) {
        handleError('ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤', error);
      }
    };

    window.moveToReviewFromModal = function() {
      window.currentReviewCase = window.currentCaseId;
      closeModal();
      switchTab('review');
    };

    window.showHistory = function() {
      showToast('ìŠ¹ì¸ ê¸°ë¡ ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤', 'info');
    };

    // ==================== í•„í„° í•¨ìˆ˜ ====================
    window.filterByActor = function(actor) {
      showToast(`"${actor}" í•„í„°ë§ ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤`, 'info');
    };

    window.filterByCategory = function(category) {
      showToast(`"${category}" ì¹´í…Œê³ ë¦¬ í•„í„°ë§ ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤`, 'info');
    };

    window.filterByType = function(type) {
      showToast(`"${type}" ìœ í˜• í•„í„°ë§ ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤`, 'info');
    };

    window.showAllCases = function() {
      showToast('ì „ì²´ ì¼€ì´ìŠ¤ ëª©ë¡ ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤', 'info');
    };

    window.showHotPlayersDetail = function() {
      showToast('TOP 20 í•« í”Œë ˆì´ì–´ ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤', 'info');
    };

    // ==================== í…Œë§ˆ í† ê¸€ ====================
    window.toggleTheme = function() {
      const body = document.body;
      const icon = document.getElementById('theme-icon');
      
      body.classList.toggle('dark-mode');
      
      if (body.classList.contains('dark-mode')) {
        icon.textContent = 'ğŸŒ™';
        localStorage.setItem('theme', 'dark');
      } else {
        icon.textContent = 'â˜€ï¸';
        localStorage.setItem('theme', 'light');
      }
    };
    
    function loadTheme() {
      const savedTheme = localStorage.getItem('theme');
      const icon = document.getElementById('theme-icon');
      
      if (savedTheme === 'dark') {
        document.body.classList.add('dark-mode');
        icon.textContent = 'ğŸŒ™';
      } else {
        icon.textContent = 'â˜€ï¸';
      }
    }

    // ==================== ì´ˆê¸°í™” ====================
    window.addEventListener('DOMContentLoaded', () => {
      // í…Œë§ˆ ë¡œë“œ
      loadTheme();

      // ë§ˆì§€ë§‰ íƒ­ ë³µì› ë˜ëŠ” ê¸°ë³¸ íƒ­ (ë³´ë“œ)
      const lastTab = localStorage.getItem('lastTab') || 'board';
      
      // ëª¨ë“  íƒ­ ë²„íŠ¼ ë¹„í™œì„±í™”
      document.querySelectorAll('.tab-button').forEach(btn => {
        btn.classList.remove('active');
        btn.setAttribute('aria-selected', 'false');
      });
      
      // ëª¨ë“  ì»¨í…ì¸  ìˆ¨ê¸°ê¸°
      document.querySelectorAll('.content').forEach(content => {
        content.classList.remove('active');
      });
      
      // ì €ì¥ëœ íƒ­ í™œì„±í™”
      const targetButton = lastTab === 'board' 
        ? document.querySelector('.tab-button.board')
        : document.querySelector(`[onclick*="switchTab('${lastTab}',"]`);
      
      if (targetButton) {
        targetButton.classList.add('active');
        targetButton.setAttribute('aria-selected', 'true');
      }
      
      document.getElementById(`${lastTab}-content`).classList.add('active');
      
      // í•´ë‹¹ íƒ­ ë¡œë“œ
      if (lastTab === 'board') {
        loadBoardTab();
      } else if (lastTab === 'db') {
        loadDBTab();
      } else if (lastTab === 'review') {
        loadReviewTab();
      } else if (lastTab === 'edit') {
        loadEditTab();
      } else if (lastTab === 'log') {
        loadLogTab();
      }
    });

    // AI í•™ìŠµ ë°ì´í„° ë‚´ë³´ë‚´ê¸° (í•„ìš”í•  ë•Œë§Œ ì‚¬ìš©)
window.exportAITrainingData = async function() {
  try {
    showToast('AI í•™ìŠµ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘...', 'info');
    
    const aiTrainingRef = collection(db, 'ai_training');
    const q = query(aiTrainingRef, orderBy('timestamp', 'desc'));
    const snapshot = await getDocs(q);
    
    if (snapshot.empty) {
      showToast('ì €ì¥ëœ í•™ìŠµ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤', 'error');
      return;
    }
    
    const trainingData = [];
    snapshot.forEach(doc => {
      trainingData.push({
        id: doc.id,
        ...doc.data()
      });
    });
    
    const jsonStr = JSON.stringify(trainingData, null, 2);
    const blob = new Blob([jsonStr], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    
    const a = document.createElement('a');
    a.href = url;
    a.download = `ai-training-data-${new Date().toISOString().split('T')[0]}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    showToast(`${trainingData.length}ê°œì˜ í•™ìŠµ ë°ì´í„°ë¥¼ ë‹¤ìš´ë¡œë“œí–ˆìŠµë‹ˆë‹¤`, 'success');
  } catch (error) {
    handleError('ë‚´ë³´ë‚´ê¸° ì‹¤íŒ¨', error);
  }
};

// ==================== AI í•™ìŠµ ë°ì´í„° ìë™ ì €ì¥ ====================
    
    // AI í•™ìŠµìš© ë°ì´í„° ì €ì¥ í•¨ìˆ˜
    async function saveAITrainingData(type, data) {
      try {
        const aiTrainingRef = collection(db, 'ai_training');
        
        const trainingDoc = {
          timestamp: new Date().toISOString(),
          type: type,
          data: data,
          metadata: {
            userAgent: navigator.userAgent,
            deviceType: /Mobile|Android|iPhone/i.test(navigator.userAgent) ? 'mobile' : 'desktop',
            screenSize: `${window.screen.width}x${window.screen.height}`
          }
        };
        
        const docRef = await addDoc(aiTrainingRef, trainingDoc);
        console.log('âœ… AI í•™ìŠµ ë°ì´í„° ì €ì¥ ì„±ê³µ:', type, docRef.id);
        return docRef;
      } catch (error) {
        console.error('âŒ AI í•™ìŠµ ë°ì´í„° ì €ì¥ ì‹¤íŒ¨:', error);
        // ì—ëŸ¬ê°€ ë‚˜ë„ ì‚¬ìš©ì ê²½í—˜ì— ì˜í–¥ ì—†ë„ë¡ ì¡°ìš©íˆ ì²˜ë¦¬
        return null;
      }
    }
    
    // í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ - ë²„íŠ¼ìœ¼ë¡œ ë°”ë¡œ í…ŒìŠ¤íŠ¸
    window.testAIDataSave = async function() {
      showToast('í…ŒìŠ¤íŠ¸ ë°ì´í„° ì €ì¥ ì¤‘...', 'info');
      
      const testData = {
        testCase: 'test_case_' + Date.now(),
        message: 'AI í•™ìŠµ ë°ì´í„° ì €ì¥ í…ŒìŠ¤íŠ¸',
        timestamp: new Date().toISOString()
      };
      
      const result = await saveAITrainingData('test', testData);
      
      if (result) {
        showToast('âœ… í…ŒìŠ¤íŠ¸ ì„±ê³µ! Firebase Consoleì—ì„œ ai_training ì»¬ë ‰ì…˜ í™•ì¸í•˜ì„¸ìš”', 'success');
        console.log('Firebase Console í™•ì¸:', 'https://console.firebase.google.com/project/' + db.app.options.projectId + '/firestore/data/ai_training');
      } else {
        showToast('âŒ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨! ì½˜ì†”(F12)ì—ì„œ ì—ëŸ¬ í™•ì¸í•˜ì„¸ìš”', 'error');
      }
    };
    
    // AI í•™ìŠµ ë°ì´í„° ë‚´ë³´ë‚´ê¸°
    window.exportAITrainingData = async function() {
      try {
        showToast('AI í•™ìŠµ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘...', 'info');
        
        const aiTrainingRef = collection(db, 'ai_training');
        const q = query(aiTrainingRef, orderBy('timestamp', 'desc'));
        const snapshot = await getDocs(q);
        
        if (snapshot.empty) {
          showToast('ì €ì¥ëœ í•™ìŠµ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤', 'error');
          return;
        }
        
        const trainingData = {
          exportDate: new Date().toISOString(),
          totalRecords: snapshot.size,
          data: []
        };
        
        snapshot.forEach(doc => {
          trainingData.data.push({
            id: doc.id,
            ...doc.data()
          });
        });
        
        // íƒ€ì…ë³„ í†µê³„
        const stats = {};
        trainingData.data.forEach(item => {
          stats[item.type] = (stats[item.type] || 0) + 1;
        });
        trainingData.statistics = stats;
        
        const jsonStr = JSON.stringify(trainingData, null, 2);
        const blob = new Blob([jsonStr], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        
        const a = document.createElement('a');
        a.href = url;
        a.download = `ai-training-data-${new Date().toISOString().split('T')[0]}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        showToast(`${trainingData.totalRecords}ê°œì˜ í•™ìŠµ ë°ì´í„°ë¥¼ ë‹¤ìš´ë¡œë“œí–ˆìŠµë‹ˆë‹¤`, 'success');
        console.log('ë‚´ë³´ë‚¸ ë°ì´í„° í†µê³„:', stats);
      } catch (error) {
        handleError('ë‚´ë³´ë‚´ê¸° ì‹¤íŒ¨', error);
      }
    };
    
    // ê²€í†  ì™„ë£Œ ì‹œ AI í•™ìŠµ ë°ì´í„° ì €ì¥ (ê¸°ì¡´ selectOption í•¨ìˆ˜ ì°¾ì•„ì„œ êµì²´)
    window.selectOption = async function(option) {
      const card = document.getElementById('current-review-card');
      if (!card) return;
      
      card.classList.add('slide-out-down');
      
      const current = window.reviewQueue[window.reviewIndex];
      if (!current) return;
      
      const startTime = window.reviewStartTime || Date.now();
      const timeSpent = (Date.now() - startTime) / 1000;
      
      // AI í•™ìŠµ ë°ì´í„° ì €ì¥
      await saveAITrainingData('review', {
        caseId: current.id,
        caseInfo: {
          title: current.data.title || '',
          content: current.data.content || '',
          excerpt: current.data.excerpt || '',
          source: current.data.source || ''
        },
        originalPrediction: {
          actor: current.data.actor || {},
          teamType: current.data.teamType || {},
          primaryCategory: current.data.primaryCategory || {}
        },
        humanReview: {
          optionSelected: option,
          refreshCount: window.refreshCount || 0,
          timeSpent: timeSpent,
          reviewedAt: new Date().toISOString()
        },
        reasoning: current.data.classificationReason || {},
        status: current.data.status || ''
      });
      
      showToast(`${option}ì•ˆì´ ì„ íƒë˜ì—ˆìŠµë‹ˆë‹¤`, 'success');
      
      setTimeout(() => {
        window.reviewIndex++;
        window.refreshCount = 0;
        window.reviewStartTime = Date.now();
        showReviewCard();
      }, 300);
    };
    
    // ì¼€ì´ìŠ¤ ì‚­ì œ ì‹œ AI í•™ìŠµ ë°ì´í„° ì €ì¥ (ê¸°ì¡´ deleteCase í•¨ìˆ˜ ì°¾ì•„ì„œ êµì²´)
    window.deleteCase = async function() {
      if (!confirm('ì •ë§ ì´ ì¼€ì´ìŠ¤ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
      
      try {
        const docRef = doc(db, 'cases', window.currentCaseId);
        const docSnap = await getDoc(docRef);
        
        if (docSnap.exists()) {
          const caseData = docSnap.data();
          
          // ì‚­ì œëœ ì¼€ì´ìŠ¤ ì •ë³´ë¥¼ ë¶€ì • ìƒ˜í”Œë¡œ ì €ì¥
          await saveAITrainingData('case_rejected', {
            caseId: window.currentCaseId,
            caseInfo: {
              title: caseData.title || '',
              content: caseData.content || '',
              excerpt: caseData.excerpt || ''
            },
            classification: {
              actor: caseData.actor || {},
              teamType: caseData.teamType || {},
              primaryCategory: caseData.primaryCategory || {}
            },
            reasoning: caseData.classificationReason || {},
            rejectedAt: new Date().toISOString(),
            rejectionReason: 'ì‚¬ìš©ìê°€ ì¼€ì´ìŠ¤ ì‚­ì œ'
          });
        }
        
        await deleteDoc(docRef);
        
        await addDoc(collection(db, 'logs'), {
          action: 'delete',
          caseId: window.currentCaseId,
          timestamp: new Date().toISOString()
        });
        
        invalidateCache();
        closeModal();
        loadDBTab();
        showToast('ì¼€ì´ìŠ¤ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
      } catch (error) {
        handleError('ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤', error);
      }
    };
    
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ê²€í†  ì‹œì‘ ì‹œê°„ ê¸°ë¡
    window.reviewStartTime = Date.now();
    
    // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
    document.getElementById('case-modal').addEventListener('click', function(e) {
      if (e.target === this) {
        closeModal();
      }
    });
  </script>
</body>
</html>
